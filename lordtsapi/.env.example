# ============================================
# CONFIGURA√á√ÉO UNIFICADA - Projeto LOR0138
# ============================================
# IMPORTANTE: Use este .env.example como base
# ============================================

# ==================== SERVIDOR ====================
PORT=3000
NODE_ENV=development
API_PREFIX=/api

# ============================================
# DATABASE CONFIGURATION
# ============================================

# ==================== CONNECTION TYPE ====================
# Tipo de conex√£o: 'sqlserver' ou 'odbc'
# - 'sqlserver': Conex√£o direta via SQL Server (mssql package)
# - 'odbc': Conex√£o via ODBC (Progress OpenEdge, Informix)
DB_CONNECTION_TYPE=odbc

# ==================== LEGACY ODBC DSN CONFIGURATION (Deprecated) ====================
#
# ‚ö†Ô∏è DEPRECATED: Estas vari√°veis ainda s√£o suportadas para compatibilidade,
#    mas recomenda-se usar DATASUL_ENVIRONMENT e INFORMIX_ENVIRONMENT.
#
# Use estas vari√°veis se precisar especificar manualmente qual DSN usar:
#
ODBC_DSN_EMP=DtsPrdEmp
ODBC_DSN_MULT=DtsPrdMult
ODBC_CONNECTION_TIMEOUT=15000

# ODBC Direto (experimental - conex√£o direta ao Progress sem SQL Server)
# Usado pelo endpoint de teste /api/test/odbc-direto
# Este m√©todo elimina a camada do SQL Server Linked Server
ODBC_DSN_DIRECT=prd_emsfnd
ODBC_USER_DIRECT=sysprogress
ODBC_PASSWORD_DIRECT=sysprogress

# ==================== NEW ENVIRONMENT-BASED CONFIGURATION (Recommended) ====================
#
# üéØ RECOMENDADO: Use estas vari√°veis para selecionar o ambiente automaticamente.
#    O sistema carrega todas as 6 databases (ADT, EMP, ESP, MULT, EMS5, FND) do ambiente selecionado.
#
# ‚úÖ Benef√≠cios:
#    - Mudan√ßa de ambiente com uma √∫nica vari√°vel
#    - Garantia de consist√™ncia entre databases
#    - Configura√ß√£o simplificada
#    - Migra√ß√£o f√°cil entre ambientes (dev ‚Üí test ‚Üí production)
#
# üìå Como funciona:
#    1. Configure DATASUL_ENVIRONMENT com o ambiente desejado
#    2. Configure INFORMIX_ENVIRONMENT com o ambiente desejado
#    3. O sistema carrega automaticamente TODAS as databases daquele ambiente
#    4. N√£o precisa especificar DSNs individuais!
#

# --- Datasul Environment Selection ---
# Escolha qual ambiente Datasul usar como padr√£o
# Valores aceitos: production, test, homologation (ou hml)
# Padr√£o: production
DATASUL_ENVIRONMENT=production

# --- Informix Environment Selection ---
# Escolha qual ambiente Informix usar como padr√£o
# Valores aceitos: production, development (ou dev), atualiza√ß√£o (ou atu), new
# Padr√£o: production
INFORMIX_ENVIRONMENT=production

# --- PCFactory Environment Selection ---
# Escolha qual ambiente PCFactory usar como padr√£o
# Valores aceitos: production, development (ou dev)
# Padr√£o: production
PCFACTORY_ENVIRONMENT=production

# --- Corporativo Environment Selection ---
# Escolha qual ambiente Corporativo Lorenzetti usar como padr√£o
# Valores aceitos: production, development (ou dev)
# Padr√£o: production
CORPORATIVO_ENVIRONMENT=production

# ==================== AVAILABLE DATASUL ENVIRONMENTS & DSNs ====================
#
# üìã PRODUCTION (DATASUL_ENVIRONMENT=production)
#    Server: 189.126.146.38
#    ‚îú‚îÄ‚îÄ DtsPrdAdt  (port 40001) - ems2adt  - Auditoria
#    ‚îú‚îÄ‚îÄ DtsPrdEmp  (port 40002) - ems2emp  - Empresa (main business data)
#    ‚îú‚îÄ‚îÄ DtsPrdEsp  (port 40003) - ems2esp  - Especial
#    ‚îú‚îÄ‚îÄ DtsPrdMult (port 40004) - ems2mult - M√∫ltiplas Empresas
#    ‚îú‚îÄ‚îÄ DtsPrdEms5 (port 40006) - ems5     - EMS5
#    ‚îî‚îÄ‚îÄ DtsPrdFnd  (port 40007) - emsfnd   - Foundation
#
# üìã TEST (DATASUL_ENVIRONMENT=test)
#    Server: 189.126.146.71
#    ‚îú‚îÄ‚îÄ DtsTstAdt  (port 41001) - ems2adt  - Auditoria
#    ‚îú‚îÄ‚îÄ DtsTstEmp  (port 41002) - ems2emp  - Empresa (main business data)
#    ‚îú‚îÄ‚îÄ DtsTstEsp  (port 41003) - ems2esp  - Especial
#    ‚îú‚îÄ‚îÄ DtsTstMult (port 41004) - ems2mult - M√∫ltiplas Empresas
#    ‚îú‚îÄ‚îÄ DtsTstEms5 (port 41006) - ems5     - EMS5
#    ‚îî‚îÄ‚îÄ DtsTstFnd  (port 41007) - emsfnd   - Foundation
#
# üìã HOMOLOGATION (DATASUL_ENVIRONMENT=homologation)
#    Server: 189.126.146.135
#    ‚îú‚îÄ‚îÄ DtsHmlAdt  (port 42001) - ems2adt  - Auditoria
#    ‚îú‚îÄ‚îÄ DtsHmlEmp  (port 42002) - ems2emp  - Empresa (main business data)
#    ‚îú‚îÄ‚îÄ DtsHmlEsp  (port 42003) - ems2esp  - Especial
#    ‚îú‚îÄ‚îÄ DtsHmlMult (port 42004) - ems2mult - M√∫ltiplas Empresas
#    ‚îú‚îÄ‚îÄ DtsHmlEms5 (port 42006) - ems5     - EMS5
#    ‚îî‚îÄ‚îÄ DtsHmlFnd  (port 42007) - emsfnd   - Foundation
#
# üí° Dica: Configure DATASUL_ENVIRONMENT=test para usar todos os DSNs de teste

# ==================== AVAILABLE INFORMIX ENVIRONMENTS & DSNs ====================
#
# üìã PRODUCTION (INFORMIX_ENVIRONMENT=production)
#    ‚îú‚îÄ‚îÄ LgxPrd - Logix Production
#    ‚îÇ   Server: 10.105.0.39:5511
#    ‚îÇ   Database: logix
#    ‚îÇ   Instance: t_ifxprd_tcp
#
# üìã DEVELOPMENT (INFORMIX_ENVIRONMENT=development or dev)
#    ‚îú‚îÄ‚îÄ LgxDev - Logix Development
#    ‚îÇ   Server: 10.1.0.84:3515
#    ‚îÇ   Database: logix
#    ‚îÇ   Instance: lgxdev_tcp
#
# üìã ATUALIZA√á√ÉO (INFORMIX_ENVIRONMENT=atualiza√ß√£o or atu)
#    ‚îú‚îÄ‚îÄ LgxAtu - Logix Atualiza√ß√£o
#    ‚îÇ   Server: 10.1.0.84:3516
#    ‚îÇ   Database: logix
#    ‚îÇ   Instance: lgxatu_tcp
#
# üìã NEW (INFORMIX_ENVIRONMENT=new)
#    ‚îú‚îÄ‚îÄ LgxNew - Logix New
#    ‚îÇ   Server: 10.1.0.84:3517
#    ‚îÇ   Database: logix
#    ‚îÇ   Instance: lgxnew_tcp
#

# ==================== AVAILABLE SQL SERVER ENVIRONMENTS & DSNs ====================
#
# üìã PCFACTORY PRODUCTION (PCFACTORY_ENVIRONMENT=production)
#    Server: T-SRVSQL2022-01\mes
#    ‚îú‚îÄ‚îÄ PCF4_PRD - PCFactory Production - Sistema
#    ‚îÇ   Database: PCF4_PRD
#    ‚îÇ   User: sql_ppi / Password: pcf
#    ‚îú‚îÄ‚îÄ PCF_Integ_PRD - PCFactory Production - Integra√ß√£o
#    ‚îÇ   Database: PCF_Integ_PRD
#    ‚îÇ   User: sql_ppi / Password: pcf
#
# üìã PCFACTORY DEVELOPMENT (PCFACTORY_ENVIRONMENT=development)
#    Server: T-SRVSQL2022-01\mes
#    ‚îú‚îÄ‚îÄ PCF4_DEV - PCFactory Development - Sistema
#    ‚îÇ   Database: PCF4_DEV
#    ‚îÇ   User: sql_ppi / Password: pcf
#    ‚îú‚îÄ‚îÄ PCF_Integ_DEV - PCFactory Development - Integra√ß√£o
#    ‚îÇ   Database: PCF_Integ_DEV
#    ‚îÇ   User: sql_ppi / Password: pcf
#
# üìã CORPORATIVO PRODUCTION (CORPORATIVO_ENVIRONMENT=production)
#    ‚îú‚îÄ‚îÄ DATACORP_PRD - Corporativo Lorenzetti Production
#    ‚îÇ   Server: T-SRVSQL2022-01\LOREN
#    ‚îÇ   Database: DATACORP
#    ‚îÇ   User: dcloren / Password: #dcloren#
#
# üìã CORPORATIVO DEVELOPMENT (CORPORATIVO_ENVIRONMENT=development)
#    ‚îú‚îÄ‚îÄ DATACORP_DEV - Corporativo Lorenzetti Development
#    ‚îÇ   Server: T-SRVSQLDEV2022-01\LOREN
#    ‚îÇ   Database: DATACORP
#    ‚îÇ   User: dcloren / Password: #dclorendev#
#
# üí° Dica: Use PCFACTORY_ENVIRONMENT e CORPORATIVO_ENVIRONMENT para trocar entre ambientes
#

# ==================== DATABASE CREDENTIALS ====================
#
# Credenciais para conex√£o ODBC (compartilhadas entre todos os DSNs)
# Normalmente: sysprogress / sysprogress
#
DB_USER=sysprogress

# ‚úÖ SENHA COM CARACTERES ESPECIAIS: Use aspas simples!
# Se a senha tem #, ela DEVE estar entre aspas simples
DB_PASSWORD='sysprogress'

# ==================== SQL SERVER CONFIGURATION (se DB_CONNECTION_TYPE=sqlserver) ====================

# SQL Server - Conex√£o direta (alternativa ao ODBC)
DB_SERVER=10.105.0.4\LOREN
DB_PORT=1433

# ‚úÖ DATABASE VAZIO = Usa database padr√£o do SQL Server user
# Deixe vazio para conectar no database padr√£o configurado para o usu√°rio
# For√ßar um database espec√≠fico pode causar erro de permiss√£o
DB_DATABASE_EMP=
DB_DATABASE_MULT=

# ‚ùå N√ÉO USE MAIS ESTAS VARI√ÅVEIS (deprecated)
# DB_NAME_EMP=emp
# DB_NAME_MULT=mult

# SQL Server - Seguran√ßa
DB_ENCRYPT=false
DB_TRUST_SERVER_CERTIFICATE=true

# ‚úÖ TIMEOUTS: Aceita 3 formatos
# - N√∫mero puro: 30000 (milissegundos)
# - Com 's': 30s (segundos, convertido para ms)
# - Com 'ms': 30000ms (milissegundos expl√≠citos)
#
# RECOMENDADO: Use milissegundos puros para evitar confus√£o
DB_CONNECTION_TIMEOUT=15000  # 15 segundos para conectar
DB_REQUEST_TIMEOUT=30000     # 30 segundos para queries

# ==================== MIGRATION GUIDE: Legacy ‚Üí New Configuration ====================
#
# üîÑ Como migrar da configura√ß√£o antiga para a nova:
#
# ANTES (Legacy - Espec√≠fico):
#   ODBC_DSN_EMP=DtsPrdEmp
#   ODBC_DSN_MULT=DtsPrdMult
#
# DEPOIS (New - Environment-based):
#   DATASUL_ENVIRONMENT=production
#   # O sistema automaticamente usa:
#   # - DtsPrdEmp, DtsPrdMult, DtsPrdAdt, DtsPrdEsp, DtsPrdEms5, DtsPrdFnd
#
# üí° Vantagens:
#   1. Mudan√ßa de ambiente com uma vari√°vel (production ‚Üí test)
#   2. Todas as 6 databases mudam juntas (consist√™ncia)
#   3. Menos vari√°veis para gerenciar
#   4. Migra√ß√£o de ambiente simplificada
#
# üìå Cen√°rios de Uso:
#
#   Cen√°rio 1: Desenvolvimento local com dados de teste
#     DATASUL_ENVIRONMENT=test
#     INFORMIX_ENVIRONMENT=development
#
#   Cen√°rio 2: Homologa√ß√£o
#     DATASUL_ENVIRONMENT=homologation
#     INFORMIX_ENVIRONMENT=production
#
#   Cen√°rio 3: Produ√ß√£o
#     DATASUL_ENVIRONMENT=production
#     INFORMIX_ENVIRONMENT=production
#
#   Cen√°rio 4: Usar DSN espec√≠fico (override manual)
#     DATASUL_ENVIRONMENT=production
#     ODBC_DSN_EMP=DtsTstEmp  # Override: usa test EMP mas production para outras
#

# ==================== CIRCUIT BREAKER CONFIGURATION ====================

# Habilitar circuit breaker para conex√µes SQL Server
CIRCUIT_BREAKER_ENABLED=true

# N√∫mero de falhas antes de abrir o circuit (fail fast)
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Tempo em ms antes de tentar recupera√ß√£o (transi√ß√£o OPEN ‚Üí HALF_OPEN)
CIRCUIT_BREAKER_TIMEOUT=60000

# ==================== HEALTH CHECK & CONNECTION POOL ====================

# Health Check Configuration
# Intervalo para verifica√ß√£o de sa√∫de das conex√µes (em segundos)
HEALTH_CHECK_INTERVAL=60

# Connection Pool Configuration (ODBC)
# Tamanho m√≠nimo do pool de conex√µes
ODBC_POOL_MIN=2
# Tamanho m√°ximo do pool de conex√µes
ODBC_POOL_MAX=10
# Tempo m√°ximo de espera por uma conex√£o (ms)
ODBC_POOL_ACQUIRE_TIMEOUT=30000
# Tempo de vida m√°ximo de uma conex√£o (ms) - 0 = ilimitado
ODBC_POOL_MAX_LIFETIME=0
# Tempo m√°ximo de inatividade antes de fechar conex√£o (ms)
ODBC_POOL_IDLE_TIMEOUT=30000

# Mock Data (desenvolvimento/testes)
# Habilita uso de dados mockados para testes sem conex√£o real
USE_MOCK_DATA=false

# ==================== CORS ====================

# ‚úÖ VARI√ÅVEL CORRETA (n√£o CORS_ORIGIN)
# M√∫ltiplas origens separadas por v√≠rgula
CORS_ALLOWED_ORIGINS=http://lor0138.lorenzetti.ibe:3000,http://localhost:3000

# ‚ùå N√ÉO USE (deprecated)
# CORS_ORIGIN=http://localhost:3000

# ==================== TIMEOUTS HTTP ====================

# Timeout padr√£o de requisi√ß√µes HTTP
HTTP_REQUEST_TIMEOUT=30s

# Timeout para opera√ß√µes pesadas
HTTP_HEAVY_TIMEOUT=60s

# Timeout para health check (deve ser r√°pido)
HTTP_HEALTH_TIMEOUT=5s

# ==================== CACHE (Redis) ====================

# Habilitar cache
CACHE_ENABLED=true

# Estrat√©gia de cache:
# - 'memory': Cache apenas em mem√≥ria (servidor √∫nico)
# - 'redis': Cache apenas no Redis (m√∫ltiplos servidores)
# - 'layered': L1 (mem√≥ria) + L2 (Redis) - RECOMENDADO
CACHE_STRATEGY=layered

# URL do Redis (se CACHE_STRATEGY=redis ou layered)
CACHE_REDIS_URL=redis://localhost:6379

# TTL padr√£o do cache (pode usar 's', 'ms', ou 'm' para minutos)
CACHE_DEFAULT_TTL=5m  # 5 minutos (ou '300s' ou '300000ms' ou '300000')

# ==================== RETRY CONFIGURATION ====================

# Habilitar retry autom√°tico para queries de banco de dados
DB_RETRY_ENABLED=true

# N√∫mero m√°ximo de tentativas (default: 3)
# Produ√ß√£o: 5 (mais resili√™ncia)
# Desenvolvimento/Test: 2 (fail-fast para debugging)
DB_RETRY_MAX_ATTEMPTS=3

# Delay inicial entre tentativas em ms (default: 100ms)
# Valores menores = retry mais r√°pido
# Valores maiores = mais tempo entre tentativas
DB_RETRY_INITIAL_DELAY=100

# Delay m√°ximo entre tentativas em ms (default: 5000ms = 5s)
# Limita o delay exponencial para n√£o esperar muito tempo
DB_RETRY_MAX_DELAY=5000

# Multiplicador exponencial para backoff (default: 2)
# 2 = delay dobra a cada tentativa (100ms ‚Üí 200ms ‚Üí 400ms ‚Üí 800ms)
# 3 = delay triplica (100ms ‚Üí 300ms ‚Üí 900ms ‚Üí 2700ms)
DB_RETRY_BACKOFF_MULTIPLIER=2

# Jitter aleat√≥rio adicionado ao delay em ms (default: 50ms)
# Evita thundering herd (m√∫ltiplos clientes retrying ao mesmo tempo)
# Adiciona varia√ß√£o aleat√≥ria: delay = calculado + random(0, jitter)
DB_RETRY_JITTER=50

# ==================== LOGGING ====================

# N√≠vel de log: error, warn, info, http, debug
LOG_LEVEL=debug

# ==================== CHAOS ENGINEERING ====================

# ‚ö†Ô∏è WARNING: NEVER enable in production!
# Chaos Engineering is for testing resilience only
CHAOS_ENABLED=false

# Safety mode: requires explicit confirmation for high-probability chaos
CHAOS_SAFE_MODE=true

# Production override (dangerous!)
# Set to 'true' to explicitly allow chaos in production (NOT RECOMMENDED)
# CHAOS_PRODUCTION_OVERRIDE=false

# ==================== MULTI-REGION FAILOVER ====================

# Habilitar multi-region automatic failover
# REQUIRES: Database replicas configured in multiRegion.config.ts
MULTI_REGION_ENABLED=false

# Auto failback to primary when recovered
MULTI_REGION_AUTO_FAILBACK=true

# Interval to health check failed regions (in ms)
MULTI_REGION_HEALTH_CHECK_INTERVAL=30000

# ==================== ML ANOMALY DETECTION ====================

# Habilitar detec√ß√£o de anomalias com Machine Learning
ML_ANOMALY_DETECTION_ENABLED=true

# Intervalo de verifica√ß√£o em millisegundos (padr√£o: 60000 = 1 minuto)
ML_ANOMALY_CHECK_INTERVAL=60000

# Dura√ß√£o do baseline em millisegundos (padr√£o: 86400000 = 24 horas)
ML_ANOMALY_BASELINE_DURATION=86400000

# Threshold de confian√ßa para reportar anomalias (0-100, padr√£o: 66%)
# Anomalias s√≥ s√£o reportadas se 2+ algoritmos concordarem (66%+ confidence)
ML_ANOMALY_CONFIDENCE_THRESHOLD=66

# Storage backend (padr√£o: memory)
# memory: mais r√°pido, mas perde dados ao reiniciar
# redis: persistente, compartilhado entre inst√¢ncias (requer Redis)
ML_ANOMALY_STORAGE=memory

# ==================== ELASTICSEARCH ====================

# Habilitar envio de logs para Elasticsearch
ELASTICSEARCH_ENABLED=true

# URL do n√≥ Elasticsearch (use https:// se tiver SSL habilitado)
ELASTICSEARCH_NODE=http://localhost:9200

# Autentica√ß√£o (configure se o Elasticsearch tiver xpack.security.enabled=true)
ELASTICSEARCH_USERNAME=elastic
ELASTICSEARCH_PASSWORD=

# Prefixo do √≠ndice (ser√° criado com padr√£o: prefix-YYYY.MM.DD)
ELASTICSEARCH_INDEX_PREFIX=lordtsapi-logs

# Configura√ß√µes avan√ßadas
ELASTICSEARCH_MAX_RETRIES=3
ELASTICSEARCH_REQUEST_TIMEOUT=30000
ELASTICSEARCH_SNIFF_ON_START=false
ELASTICSEARCH_SNIFF_INTERVAL=300000

# ============================================
# OBSERVA√á√ïES IMPORTANTES
# ============================================
#
# 1. SENHAS COM #:
#    ‚úÖ DB_PASSWORD='#senha#'
#    ‚ùå DB_PASSWORD=#senha#  (# √© coment√°rio)
#    ‚ùå DB_PASSWORD="#senha#" (aspas duplas incluem nas senha)
#
# 2. DATABASE VAZIO:
#    ‚úÖ DB_DATABASE_EMP=  (usa default do user)
#    ‚ùå DB_DATABASE_EMP=emp (for√ßa database, pode n√£o ter permiss√£o)
#
# 3. TIMEOUTS:
#    ‚úÖ 30000 ou 30s ou 30000ms (todos funcionam)
#    ‚ùå N√£o misture formatos no mesmo projeto
#    üìå RECOMENDADO: Use apenas milissegundos (30000)
#
# 4. CACHE:
#    - 'memory': R√°pido, mas n√£o compartilha entre inst√¢ncias
#    - 'redis': Compartilhado, mas mais lento que mem√≥ria
#    - 'layered': Melhor dos dois mundos (L1 + L2)
#
# 5. CORS:
#    - Use CORS_ALLOWED_ORIGINS (plural)
#    - M√∫ltiplas origens: separadas por v√≠rgula
#    - N√£o use CORS_ORIGIN (deprecated)
#
# 6. ENVIRONMENT-BASED CONFIGURATION:
#    - Use DATASUL_ENVIRONMENT para trocar todo o ambiente Datasul
#    - Use INFORMIX_ENVIRONMENT para trocar todo o ambiente Informix
#    - Legacy ODBC_DSN_* ainda funciona mas √© deprecated
#    - Environment-based garante consist√™ncia entre databases
#
# 7. TOTAL DE CONEX√ïES DISPON√çVEIS:
#    - Datasul: 18 DSNs (3 ambientes √ó 6 databases) - ODBC
#    - Informix: 4 DSNs (4 ambientes √ó 1 database) - ODBC
#    - PCFactory: 4 conex√µes (2 ambientes √ó 2 databases) - SQL Server
#    - Corporativo: 2 conex√µes (2 ambientes √ó 1 database) - SQL Server
#    - Total: 28 conex√µes configuradas (22 ODBC + 6 SQL Server)
#
# ============================================
