8df4577457210d4cd93dc7880d4dab99
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.App = void 0;
// src/app.ts
const express_1 = __importDefault(require("express"));
const helmet_1 = __importDefault(require("helmet"));
const cors_1 = __importDefault(require("cors"));
const compression_1 = __importDefault(require("compression"));
const connect_timeout_1 = __importDefault(require("connect-timeout"));
const swagger_ui_express_1 = __importDefault(require("swagger-ui-express"));
const express_rate_limit_1 = require("express-rate-limit");
const logger_1 = require("@shared/utils/logger");
const swagger_config_1 = require("@config/swagger.config");
const correlationId_middleware_1 = require("@shared/middlewares/correlationId.middleware");
const informacoesGerais_routes_1 = __importDefault(require("./api/lor0138/item/dadosCadastrais/informacoesGerais/routes/informacoesGerais.routes"));
const DatabaseManager_1 = require("@infrastructure/database/DatabaseManager");
const cacheManager_1 = require("@shared/utils/cacheManager");
const admin_routes_1 = __importDefault(require("./api/admin/routes/admin.routes"));
// ✅ ÚNICA MUDANÇA: Importar classes de erro do sistema unificado
const errors_1 = require("@shared/errors");
// ✅ NOVO: Imports para métricas
const metrics_middleware_1 = require("@shared/middlewares/metrics.middleware");
const MetricsManager_1 = require("@infrastructure/metrics/MetricsManager");
const routes_1 = __importDefault(require("./api/metrics/routes"));
class App {
    constructor() {
        this.app = (0, express_1.default)();
        // ✅ NOVO: Inicializar métricas ANTES dos middlewares
        this.initializeMetrics();
        // Configura middlewares
        this.setupMiddlewares();
        // Configura rotas
        this.setupRoutes();
        // Configura tratamento de erros
        this.setupErrorHandling();
    }
    // ✅ NOVO: Método para inicializar métricas
    initializeMetrics() {
        try {
            MetricsManager_1.MetricsManager.getInstance();
            logger_1.log.info('✅ Sistema de métricas inicializado');
        }
        catch (error) {
            logger_1.log.error('Erro ao inicializar métricas', { error });
        }
    }
    setupMiddlewares() {
        // ✅ 1. Correlation ID - DEVE ser o PRIMEIRO middleware
        this.app.use(correlationId_middleware_1.correlationIdMiddleware);
        // ✅ NOVO: 2. Métricas - logo após Correlation ID
        this.app.use(metrics_middleware_1.metricsMiddleware);
        // 3. Logging de requisições
        this.app.use((req, res, next) => {
            // ✅ CORREÇÃO 2: Definir startTime
            req.startTime = Date.now();
            res.on('finish', () => {
                const duration = Date.now() - (req.startTime || 0);
                logger_1.log.info('HTTP Request', {
                    correlationId: req.id,
                    method: req.method,
                    url: req.url,
                    statusCode: res.statusCode,
                    duration: duration,
                    userAgent: req.get('user-agent'),
                });
            });
            next();
        });
        // 4. Security headers
        this.app.use((0, helmet_1.default)({
            contentSecurityPolicy: false, // Desabilita CSP para Swagger funcionar
        }));
        // 5. CORS
        this.app.use((0, cors_1.default)({
            origin: process.env.CORS_ALLOWED_ORIGINS || '*', // ✅ CORREÇÃO 1: CORS_ALLOWED_ORIGINS
            methods: ['GET', 'POST', 'PUT', 'DELETE'],
            allowedHeaders: ['Content-Type', 'Authorization', 'X-Correlation-ID', 'X-Request-ID'],
            exposedHeaders: ['X-Correlation-ID'], // Permite cliente ler o header
        }));
        // 6. Body parser
        this.app.use(express_1.default.json({ limit: '10mb' }));
        this.app.use(express_1.default.urlencoded({ extended: true, limit: '10mb' }));
        // 7. Compressão de resposta
        this.app.use((0, compression_1.default)());
        // 8. Request timeout
        this.app.use((0, connect_timeout_1.default)('30s'));
        this.app.use((req, res, next) => {
            if (!req.timedout)
                next();
        });
        // 9. Rate limiting
        const limiter = (0, express_rate_limit_1.rateLimit)({
            windowMs: 15 * 60 * 1000, // 15 minutos
            max: 100, // limite de 100 requisições por IP
            message: {
                error: 'Rate limit excedido',
                message: 'Muitas requisições deste IP. Tente novamente em alguns minutos.',
                retryAfter: '15 minutos'
            },
            standardHeaders: true,
            legacyHeaders: false,
            handler: (req, res) => {
                logger_1.log.warn('Rate limit excedido', {
                    correlationId: req.id,
                    ip: req.ip,
                    url: req.url
                });
                res.status(429).json({
                    error: 'Rate limit excedido',
                    message: 'Muitas requisições. Tente novamente em alguns minutos.',
                    timestamp: new Date().toISOString(),
                    path: req.url,
                    correlationId: req.id
                });
            }
        });
        this.app.use('/api/', limiter);
    }
    setupRoutes() {
        // ✅ NOVO: Rota de métricas (PRIMEIRO - antes de tudo)
        this.app.use('/metrics', routes_1.default);
        // Health check
        this.setupHealthCheck();
        // Configura rotas de cache
        this.setupCacheRoutes();
        // Documentação Swagger
        this.setupSwaggerDocs();
        this.setupAdminRoutes();
        // Rotas da API
        this.app.use('/api/lor0138/item/dadosCadastrais/informacoesGerais', informacoesGerais_routes_1.default);
        // Rota raiz com documentação
        this.setupRootRoute();
        // 404 - Rota não encontrada
        this.setup404Handler();
    }
    setupHealthCheck() {
        /**
         * @openapi
         * /health:
         *   get:
         *     summary: Health Check do Sistema
         *     description: |
         *       Verifica o status de saúde do sistema, incluindo:
         *       - Status geral (healthy/degraded/unhealthy)
         *       - Conectividade com banco de dados
         *       - Tempo de resposta do banco
         *       - Uso de memória da aplicação
         *       - Tempo de atividade (uptime)
         *       - **Correlation ID** para rastreamento
         *
         *       **Status possíveis:**
         *       - `healthy`: Sistema operacional (DB < 100ms)
         *       - `degraded`: Sistema lento (DB >= 100ms)
         *       - `unhealthy`: Sistema com falhas (DB não conectado)
         *     tags:
         *       - Health
         *     parameters:
         *       - in: header
         *         name: X-Correlation-ID
         *         schema:
         *           type: string
         *           format: uuid
         *         required: false
         *         description: Correlation ID para rastreamento (gerado automaticamente se não fornecido)
         *         example: '550e8400-e29b-41d4-a716-446655440000'
         *     responses:
         *       200:
         *         description: Sistema saudável ou degradado
         *         headers:
         *           X-Correlation-ID:
         *             description: Correlation ID da requisição
         *             schema:
         *               type: string
         *               format: uuid
         *         content:
         *           application/json:
         *             schema:
         *               $ref: '#/components/schemas/HealthCheck'
         *       503:
         *         description: Sistema não saudável
         *         headers:
         *           X-Correlation-ID:
         *             description: Correlation ID da requisição
         *             schema:
         *               type: string
         *               format: uuid
         *         content:
         *           application/json:
         *             schema:
         *               $ref: '#/components/schemas/HealthCheck'
         */
        this.app.get('/health', async (req, res) => {
            try {
                // Verificar banco de dados
                let dbConnected = false;
                let dbResponseTime = 0;
                let dbType = 'unknown';
                try {
                    const start = Date.now();
                    const connection = DatabaseManager_1.DatabaseManager.getConnection();
                    await connection.query('SELECT 1 as test');
                    dbResponseTime = Date.now() - start;
                    dbConnected = true;
                    const dbStatus = DatabaseManager_1.DatabaseManager.getConnectionStatus();
                    dbType = dbStatus.type;
                    // ✅ NOVO: Registrar métrica de health check do database
                    MetricsManager_1.metricsManager.healthCheckDuration.observe({ component: 'database' }, dbResponseTime / 1000);
                    MetricsManager_1.metricsManager.healthCheckStatus.set({ component: 'database' }, dbConnected ? 1 : 0);
                }
                catch (error) {
                    logger_1.log.error('Health check database error', { error });
                    dbConnected = false;
                    // ✅ NOVO: Registrar falha
                    MetricsManager_1.metricsManager.healthCheckStatus.set({ component: 'database' }, 0);
                }
                // Verificar cache
                const cacheEnabled = process.env.CACHE_ENABLED !== 'false';
                const cacheStrategy = process.env.CACHE_STRATEGY || 'memory';
                let cacheReady = false;
                if (cacheEnabled) {
                    try {
                        cacheReady = await cacheManager_1.CacheManager.isReady();
                    }
                    catch (error) {
                        logger_1.log.error('Health check cache error', { error });
                        cacheReady = false;
                    }
                }
                // Determinar status
                const isHealthy = dbConnected && (!cacheEnabled || cacheReady);
                const statusCode = isHealthy ? 200 : 503;
                // ✅ NOVO: Registrar status geral da API
                MetricsManager_1.metricsManager.healthCheckStatus.set({ component: 'api' }, isHealthy ? 1 : 0);
                res.status(statusCode).json({
                    status: isHealthy ? 'healthy' : 'unhealthy',
                    timestamp: new Date().toISOString(),
                    database: {
                        connected: dbConnected,
                        responseTime: dbResponseTime,
                        status: dbConnected ? 'healthy' : 'unhealthy',
                        type: dbType
                    },
                    cache: {
                        enabled: cacheEnabled,
                        strategy: cacheStrategy,
                        ready: cacheReady
                    },
                    // ✅ NOVO: Informação sobre métricas
                    metrics: {
                        enabled: MetricsManager_1.metricsManager.isReady(),
                        endpoint: '/metrics'
                    }
                });
            }
            catch (error) {
                logger_1.log.error('Health check fatal error', { error });
                // ✅ NOVO: Registrar falha total
                MetricsManager_1.metricsManager.healthCheckStatus.set({ component: 'api' }, 0);
                res.status(503).json({
                    status: 'unhealthy',
                    timestamp: new Date().toISOString(),
                    error: error instanceof Error ? error.message : 'Unknown error'
                });
            }
        });
    }
    setupCacheRoutes() {
        /**
         * @openapi
         * /cache/stats:
         *   get:
         *     summary: Estatísticas do Cache
         *     description: |
         *       Retorna estatísticas de uso do cache:
         *       - Total de hits (acertos)
         *       - Total de misses (erros)
         *       - Taxa de acerto (hit rate)
         *       - Número de chaves em cache
         *       - Informações de configuração
         *     tags:
         *       - Cache
         *     responses:
         *       200:
         *         description: Estatísticas do cache
         *         content:
         *           application/json:
         *             schema:
         *               type: object
         *               properties:
         *                 stats:
         *                   type: object
         *                   properties:
         *                     hits:
         *                       type: number
         *                     misses:
         *                       type: number
         *                     keys:
         *                       type: number
         *                     hitRate:
         *                       type: number
         *                 config:
         *                   type: object
         *                   properties:
         *                     stdTTL:
         *                       type: number
         *                     checkperiod:
         *                       type: number
         *                     enabled:
         *                       type: boolean
         *             example:
         *               stats:
         *                 hits: 150
         *                 misses: 30
         *                 keys: 45
         *                 hitRate: 83.33
         *               config:
         *                 stdTTL: 300
         *                 checkperiod: 600
         *                 enabled: true
         */
        this.app.get('/cache/stats', (req, res) => {
            try {
                const stats = cacheManager_1.CacheManager.getStats();
                res.json(stats);
            }
            catch (error) {
                res.status(500).json({
                    error: 'Erro ao obter estatísticas de cache',
                    message: error instanceof Error ? error.message : String(error)
                });
            }
        });
        /**
         * @openapi
         * /cache/keys:
         *   get:
         *     summary: Listar Chaves do Cache
         *     description: |
         *       Lista todas as chaves armazenadas no cache com seus TTLs.
         *       Útil para debug e monitoramento.
         *     tags:
         *       - Cache
         *     responses:
         *       200:
         *         description: Lista de chaves
         *         content:
         *           application/json:
         *             schema:
         *               type: object
         *               properties:
         *                 keys:
         *                   type: array
         *                   items:
         *                     type: object
         *                     properties:
         *                       key:
         *                         type: string
         *                       ttl:
         *                         type: number
         *                 total:
         *                   type: number
         *             example:
         *               keys:
         *                 - key: 'item:7530110:informacoesGerais'
         *                   ttl: 1735995600000
         *                 - key: 'GET:/health'
         *                   ttl: 1735995630000
         *               total: 2
         */
        this.app.get('/cache/keys', async (req, res) => {
            try {
                const pattern = req.query.pattern;
                const keys = await cacheManager_1.CacheManager.keys(pattern);
                res.json({ keys, count: keys.length });
            }
            catch (error) {
                res.status(500).json({
                    error: 'Erro ao listar chaves',
                    message: error instanceof Error ? error.message : String(error)
                });
            }
        });
        /**
         * @openapi
         * /cache/clear:
         *   post:
         *     summary: Limpar Cache
         *     description: |
         *       Limpa todo o cache e reseta estatísticas.
         *       **ATENÇÃO**: Use com cuidado em produção!
         *     tags:
         *       - Cache
         *     responses:
         *       200:
         *         description: Cache limpo com sucesso
         *         content:
         *           application/json:
         *             example:
         *               message: 'Cache limpo com sucesso'
         *               keysRemoved: 45
         */
        this.app.post('/cache/clear', async (req, res) => {
            try {
                await cacheManager_1.CacheManager.flush();
                res.json({
                    success: true,
                    message: 'Cache limpo com sucesso'
                });
            }
            catch (error) {
                res.status(500).json({
                    error: 'Erro ao limpar cache',
                    message: error instanceof Error ? error.message : String(error)
                });
            }
        });
        /**
         * @openapi
         * /cache/invalidate/{pattern}:
         *   delete:
         *     summary: Invalidar Cache por Padrão
         *     description: |
         *       Invalida cache usando padrão de chaves.
         *       Suporta wildcard (*).
         *
         *       Exemplos:
         *       - `item:*` - Todas as chaves de itens
         *       - `item:7530110:*` - Todas as chaves do item 7530110
         *       - `GET:/api/*` - Todas as requisições GET da API
         *     tags:
         *       - Cache
         *     parameters:
         *       - in: path
         *         name: pattern
         *         required: true
         *         schema:
         *           type: string
         *         description: Padrão de chaves (suporta *)
         *         examples:
         *           allItems:
         *             value: 'item:*'
         *             summary: Todos os itens
         *           singleItem:
         *             value: 'item:7530110:*'
         *             summary: Item específico
         *           apiRequests:
         *             value: 'GET:/api/*'
         *             summary: Todas as requisições GET
         *     responses:
         *       200:
         *         description: Cache invalidado
         *         content:
         *           application/json:
         *             example:
         *               message: 'Cache invalidado'
         *               pattern: 'item:*'
         *               keysRemoved: 12
         */
        this.app.delete('/cache/invalidate/:pattern', async (req, res) => {
            try {
                const pattern = req.params.pattern;
                const deletedCount = await cacheManager_1.CacheManager.invalidate(pattern);
                res.json({
                    success: true,
                    deletedCount,
                    pattern
                });
            }
            catch (error) {
                res.status(500).json({
                    error: 'Erro ao invalidar cache',
                    message: error instanceof Error ? error.message : String(error)
                });
            }
        });
    }
    setupSwaggerDocs() {
        // Serve Swagger UI
        this.app.use('/api-docs', swagger_ui_express_1.default.serve, swagger_ui_express_1.default.setup(swagger_config_1.swaggerSpec, swagger_config_1.swaggerUiOptions));
        // Serve OpenAPI spec em JSON
        this.app.get('/api-docs.json', (req, res) => {
            res.setHeader('Content-Type', 'application/json');
            res.send(swagger_config_1.swaggerSpec);
        });
        logger_1.log.info('📚 Documentação Swagger disponível em /api-docs');
    }
    setupAdminRoutes() {
        this.app.use('/admin', admin_routes_1.default);
        logger_1.log.info('🔑 Rotas de administração disponíveis em /admin');
    }
    setupRootRoute() {
        /**
         * @openapi
         * /:
         *   get:
         *     summary: Informações da API
         *     description: |
         *       Retorna informações básicas sobre a API e links úteis para navegação.
         *       Inclui **Correlation ID** para rastreamento de requisições.
         *     tags:
         *       - Health
         *     parameters:
         *       - in: header
         *         name: X-Correlation-ID
         *         schema:
         *           type: string
         *           format: uuid
         *         required: false
         *         description: Correlation ID para rastreamento
         *     responses:
         *       200:
         *         description: Informações da API
         *         headers:
         *           X-Correlation-ID:
         *             description: Correlation ID da requisição
         *             schema:
         *               type: string
         *               format: uuid
         *         content:
         *           application/json:
         *             example:
         *               message: 'Datasul API'
         *               version: '1.0.0'
         *               documentation: '/api-docs'
         *               health: '/health'
         *               endpoints:
         *                 informacoesGerais: '/api/lor0138/item/dadosCadastrais/informacoesGerais/:itemCodigo'
         *               correlationId: '550e8400-e29b-41d4-a716-446655440000'
         */
        this.app.get('/', (req, res) => {
            res.json({
                message: 'Datasul API',
                version: '1.0.0',
                documentation: '/api-docs',
                health: '/health',
                metrics: '/metrics', // ✅ NOVO
                endpoints: {
                    informacoesGerais: '/api/lor0138/item/dadosCadastrais/informacoesGerais/:itemCodigo'
                },
                correlationId: req.id
            });
        });
    }
    setup404Handler() {
        this.app.use((req, res) => {
            logger_1.log.warn('Rota não encontrada', {
                correlationId: req.id,
                method: req.method,
                url: req.url
            });
            res.status(404).json({
                error: 'Rota não encontrada',
                message: `A rota ${req.method} ${req.url} não existe`,
                timestamp: new Date().toISOString(),
                path: req.url,
                correlationId: req.id,
                availableRoutes: {
                    documentation: '/api-docs',
                    health: '/health',
                    metrics: '/metrics', // ✅ NOVO
                    api: '/api/lor0138/item/dadosCadastrais/informacoesGerais/:itemCodigo'
                }
            });
        });
    }
    setupErrorHandling() {
        // ✅ MUDANÇA: Error handler melhorado usando AppError
        this.app.use((err, req, res, next) => {
            // Timeout error
            if (err.message === 'Response timeout' || req.timedout) {
                return res.status(408).json({
                    error: 'Timeout',
                    message: 'A requisição demorou muito tempo para ser processada',
                    timestamp: new Date().toISOString(),
                    path: req.url,
                    correlationId: req.id
                });
            }
            // Se for AppError (do sistema unificado), usa statusCode e context
            if (err instanceof errors_1.AppError) {
                const response = {
                    error: err.name,
                    message: err.message,
                    timestamp: new Date().toISOString(),
                    path: req.url,
                    correlationId: req.id
                };
                // Adiciona context como details se existir
                if (err.context) {
                    response.details = err.context;
                }
                // Log apropriado
                if (err.isOperational) {
                    logger_1.log.warn('Erro operacional', {
                        correlationId: req.id,
                        error: err.name,
                        message: err.message,
                        statusCode: err.statusCode,
                        context: err.context
                    });
                }
                else {
                    logger_1.log.error('Erro crítico', {
                        correlationId: req.id,
                        error: err.name,
                        message: err.message,
                        statusCode: err.statusCode,
                        stack: err.stack,
                        context: err.context
                    });
                }
                return res.status(err.statusCode).json(response);
            }
            // Erro genérico não tratado
            logger_1.log.error('Erro não tratado', {
                correlationId: req.id,
                error: err.message,
                stack: err.stack,
                url: req.url,
                method: req.method
            });
            res.status(500).json({
                error: 'Erro interno',
                message: process.env.NODE_ENV === 'production'
                    ? 'Ocorreu um erro ao processar sua requisição'
                    : err.message,
                timestamp: new Date().toISOString(),
                path: req.url,
                correlationId: req.id
            });
        });
    }
    getExpressApp() {
        return this.app;
    }
}
exports.App = App;
// ✅ Export default da instância
const appInstance = new App();
exports.default = appInstance.getExpressApp();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ25ELENBQUM7WUFFRCw0QkFBNEI7WUFDNUIsWUFBRyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRTtnQkFDNUIsYUFBYSxFQUFFLEdBQUcsQ0FBQyxFQUFFO2dCQUNyQixLQUFLLEVBQUUsR0FBRyxDQUFDLE9BQU87Z0JBQ2xCLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSztnQkFDaEIsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHO2dCQUNaLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTTthQUNuQixDQUFDLENBQUM7WUFFSCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsS0FBSyxFQUFFLGNBQWM7Z0JBQ3JCLE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxZQUFZO29CQUM1QyxDQUFDLENBQUMsNkNBQTZDO29CQUMvQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU87Z0JBQ2YsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2dCQUNuQyxJQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUc7Z0JBQ2IsYUFBYSxFQUFFLEdBQUcsQ0FBQyxFQUFFO2FBQ3RCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLGFBQWE7UUFDbEIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ2xCLENBQUM7Q0FDRjtBQW5xQkQsa0JBbXFCQztBQUVELGdDQUFnQztBQUNoQyxNQUFNLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQzlCLGtCQUFlLFdBQVcsQ0FBQyxhQUFhLEVBQUUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9tYW5vL3Byb2pldG9zL2RhdGFzdWwvbG9yMDEzOC9zcmMvYXBwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9hcHAudHNcclxuaW1wb3J0IGV4cHJlc3MsIHsgQXBwbGljYXRpb24sIFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IGhlbG1ldCBmcm9tICdoZWxtZXQnO1xyXG5pbXBvcnQgY29ycyBmcm9tICdjb3JzJztcclxuaW1wb3J0IGNvbXByZXNzaW9uIGZyb20gJ2NvbXByZXNzaW9uJztcclxuaW1wb3J0IHRpbWVvdXQgZnJvbSAnY29ubmVjdC10aW1lb3V0JztcclxuaW1wb3J0IHN3YWdnZXJVaSBmcm9tICdzd2FnZ2VyLXVpLWV4cHJlc3MnO1xyXG5pbXBvcnQgeyByYXRlTGltaXQgfSBmcm9tICdleHByZXNzLXJhdGUtbGltaXQnO1xyXG5pbXBvcnQgeyBsb2cgfSBmcm9tICdAc2hhcmVkL3V0aWxzL2xvZ2dlcic7XHJcbmltcG9ydCB7IHN3YWdnZXJTcGVjLCBzd2FnZ2VyVWlPcHRpb25zIH0gZnJvbSAnQGNvbmZpZy9zd2FnZ2VyLmNvbmZpZyc7XHJcbmltcG9ydCB7IGNvcnJlbGF0aW9uSWRNaWRkbGV3YXJlIH0gZnJvbSAnQHNoYXJlZC9taWRkbGV3YXJlcy9jb3JyZWxhdGlvbklkLm1pZGRsZXdhcmUnO1xyXG5pbXBvcnQgaW5mb3JtYWNvZXNHZXJhaXNSb3V0ZXMgZnJvbSAnLi9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy9yb3V0ZXMvaW5mb3JtYWNvZXNHZXJhaXMucm91dGVzJztcclxuaW1wb3J0IHsgRGF0YWJhc2VNYW5hZ2VyIH0gZnJvbSAnQGluZnJhc3RydWN0dXJlL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlcic7XHJcbmltcG9ydCB7IENhY2hlTWFuYWdlciB9IGZyb20gJ0BzaGFyZWQvdXRpbHMvY2FjaGVNYW5hZ2VyJztcclxuaW1wb3J0IGFkbWluUm91dGVzIGZyb20gJy4vYXBpL2FkbWluL3JvdXRlcy9hZG1pbi5yb3V0ZXMnO1xyXG5cclxuLy8g4pyFIMOaTklDQSBNVURBTsOHQTogSW1wb3J0YXIgY2xhc3NlcyBkZSBlcnJvIGRvIHNpc3RlbWEgdW5pZmljYWRvXHJcbmltcG9ydCB7IEFwcEVycm9yIH0gZnJvbSAnQHNoYXJlZC9lcnJvcnMnO1xyXG5cclxuLy8g4pyFIE5PVk86IEltcG9ydHMgcGFyYSBtw6l0cmljYXNcclxuaW1wb3J0IHsgbWV0cmljc01pZGRsZXdhcmUgfSBmcm9tICdAc2hhcmVkL21pZGRsZXdhcmVzL21ldHJpY3MubWlkZGxld2FyZSc7XHJcbmltcG9ydCB7IE1ldHJpY3NNYW5hZ2VyLCBtZXRyaWNzTWFuYWdlciB9IGZyb20gJ0BpbmZyYXN0cnVjdHVyZS9tZXRyaWNzL01ldHJpY3NNYW5hZ2VyJztcclxuaW1wb3J0IG1ldHJpY3NSb3V0ZXMgZnJvbSAnLi9hcGkvbWV0cmljcy9yb3V0ZXMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEFwcCB7XHJcbiAgcHVibGljIGFwcDogQXBwbGljYXRpb247XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5hcHAgPSBleHByZXNzKCk7XHJcbiAgICBcclxuICAgIC8vIOKchSBOT1ZPOiBJbmljaWFsaXphciBtw6l0cmljYXMgQU5URVMgZG9zIG1pZGRsZXdhcmVzXHJcbiAgICB0aGlzLmluaXRpYWxpemVNZXRyaWNzKCk7XHJcbiAgICBcclxuICAgIC8vIENvbmZpZ3VyYSBtaWRkbGV3YXJlc1xyXG4gICAgdGhpcy5zZXR1cE1pZGRsZXdhcmVzKCk7XHJcbiAgICBcclxuICAgIC8vIENvbmZpZ3VyYSByb3Rhc1xyXG4gICAgdGhpcy5zZXR1cFJvdXRlcygpO1xyXG4gICAgXHJcbiAgICAvLyBDb25maWd1cmEgdHJhdGFtZW50byBkZSBlcnJvc1xyXG4gICAgdGhpcy5zZXR1cEVycm9ySGFuZGxpbmcoKTtcclxuICB9XHJcblxyXG4gIC8vIOKchSBOT1ZPOiBNw6l0b2RvIHBhcmEgaW5pY2lhbGl6YXIgbcOpdHJpY2FzXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplTWV0cmljcygpOiB2b2lkIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIE1ldHJpY3NNYW5hZ2VyLmdldEluc3RhbmNlKCk7XHJcbiAgICAgIGxvZy5pbmZvKCfinIUgU2lzdGVtYSBkZSBtw6l0cmljYXMgaW5pY2lhbGl6YWRvJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2cuZXJyb3IoJ0Vycm8gYW8gaW5pY2lhbGl6YXIgbcOpdHJpY2FzJywgeyBlcnJvciB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0dXBNaWRkbGV3YXJlcygpOiB2b2lkIHtcclxuICAgIC8vIOKchSAxLiBDb3JyZWxhdGlvbiBJRCAtIERFVkUgc2VyIG8gUFJJTUVJUk8gbWlkZGxld2FyZVxyXG4gICAgdGhpcy5hcHAudXNlKGNvcnJlbGF0aW9uSWRNaWRkbGV3YXJlKTtcclxuXHJcbiAgICAvLyDinIUgTk9WTzogMi4gTcOpdHJpY2FzIC0gbG9nbyBhcMOzcyBDb3JyZWxhdGlvbiBJRFxyXG4gICAgdGhpcy5hcHAudXNlKG1ldHJpY3NNaWRkbGV3YXJlKTtcclxuXHJcbiAgICAvLyAzLiBMb2dnaW5nIGRlIHJlcXVpc2nDp8O1ZXNcclxuICAgIHRoaXMuYXBwLnVzZSgocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IHtcclxuICAgICAgLy8g4pyFIENPUlJFw4fDg08gMjogRGVmaW5pciBzdGFydFRpbWVcclxuICAgICAgcmVxLnN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcblxyXG4gICAgICByZXMub24oJ2ZpbmlzaCcsICgpID0+IHtcclxuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSAoIHJlcS5zdGFydFRpbWUgfHwgMCApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxvZy5pbmZvKCdIVFRQIFJlcXVlc3QnLCB7XHJcbiAgICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWQsXHJcbiAgICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXHJcbiAgICAgICAgICB1cmw6IHJlcS51cmwsXHJcbiAgICAgICAgICBzdGF0dXNDb2RlOiByZXMuc3RhdHVzQ29kZSxcclxuICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcclxuICAgICAgICAgIHVzZXJBZ2VudDogcmVxLmdldCgndXNlci1hZ2VudCcpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG5leHQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIDQuIFNlY3VyaXR5IGhlYWRlcnNcclxuICAgIHRoaXMuYXBwLnVzZShoZWxtZXQoe1xyXG4gICAgICBjb250ZW50U2VjdXJpdHlQb2xpY3k6IGZhbHNlLCAvLyBEZXNhYmlsaXRhIENTUCBwYXJhIFN3YWdnZXIgZnVuY2lvbmFyXHJcbiAgICB9KSk7XHJcblxyXG4gICAgLy8gNS4gQ09SU1xyXG4gICAgdGhpcy5hcHAudXNlKGNvcnMoe1xyXG4gICAgICBvcmlnaW46IHByb2Nlc3MuZW52LkNPUlNfQUxMT1dFRF9PUklHSU5TIHx8ICcqJywgLy8g4pyFIENPUlJFw4fDg08gMTogQ09SU19BTExPV0VEX09SSUdJTlNcclxuICAgICAgbWV0aG9kczogWydHRVQnLCAnUE9TVCcsICdQVVQnLCAnREVMRVRFJ10sXHJcbiAgICAgIGFsbG93ZWRIZWFkZXJzOiBbJ0NvbnRlbnQtVHlwZScsICdBdXRob3JpemF0aW9uJywgJ1gtQ29ycmVsYXRpb24tSUQnLCAnWC1SZXF1ZXN0LUlEJ10sXHJcbiAgICAgIGV4cG9zZWRIZWFkZXJzOiBbJ1gtQ29ycmVsYXRpb24tSUQnXSwgLy8gUGVybWl0ZSBjbGllbnRlIGxlciBvIGhlYWRlclxyXG4gICAgfSkpO1xyXG5cclxuICAgIC8vIDYuIEJvZHkgcGFyc2VyXHJcbiAgICB0aGlzLmFwcC51c2UoZXhwcmVzcy5qc29uKHsgbGltaXQ6ICcxMG1iJyB9KSk7XHJcbiAgICB0aGlzLmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUsIGxpbWl0OiAnMTBtYicgfSkpO1xyXG5cclxuICAgIC8vIDcuIENvbXByZXNzw6NvIGRlIHJlc3Bvc3RhXHJcbiAgICB0aGlzLmFwcC51c2UoY29tcHJlc3Npb24oKSk7XHJcblxyXG4gICAgLy8gOC4gUmVxdWVzdCB0aW1lb3V0XHJcbiAgICB0aGlzLmFwcC51c2UodGltZW91dCgnMzBzJykpO1xyXG4gICAgdGhpcy5hcHAudXNlKChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xyXG4gICAgICBpZiAoIXJlcS50aW1lZG91dCkgbmV4dCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gOS4gUmF0ZSBsaW1pdGluZ1xyXG4gICAgY29uc3QgbGltaXRlciA9IHJhdGVMaW1pdCh7XHJcbiAgICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRvc1xyXG4gICAgICBtYXg6IDEwMCwgLy8gbGltaXRlIGRlIDEwMCByZXF1aXNpw6fDtWVzIHBvciBJUFxyXG4gICAgICBtZXNzYWdlOiB7XHJcbiAgICAgICAgZXJyb3I6ICdSYXRlIGxpbWl0IGV4Y2VkaWRvJyxcclxuICAgICAgICBtZXNzYWdlOiAnTXVpdGFzIHJlcXVpc2nDp8O1ZXMgZGVzdGUgSVAuIFRlbnRlIG5vdmFtZW50ZSBlbSBhbGd1bnMgbWludXRvcy4nLFxyXG4gICAgICAgIHJldHJ5QWZ0ZXI6ICcxNSBtaW51dG9zJ1xyXG4gICAgICB9LFxyXG4gICAgICBzdGFuZGFyZEhlYWRlcnM6IHRydWUsXHJcbiAgICAgIGxlZ2FjeUhlYWRlcnM6IGZhbHNlLFxyXG4gICAgICBoYW5kbGVyOiAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgbG9nLndhcm4oJ1JhdGUgbGltaXQgZXhjZWRpZG8nLCB7XHJcbiAgICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWQsXHJcbiAgICAgICAgICBpcDogcmVxLmlwLFxyXG4gICAgICAgICAgdXJsOiByZXEudXJsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg0MjkpLmpzb24oe1xyXG4gICAgICAgICAgZXJyb3I6ICdSYXRlIGxpbWl0IGV4Y2VkaWRvJyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdNdWl0YXMgcmVxdWlzacOnw7Vlcy4gVGVudGUgbm92YW1lbnRlIGVtIGFsZ3VucyBtaW51dG9zLicsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHBhdGg6IHJlcS51cmwsXHJcbiAgICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWRcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5hcHAudXNlKCcvYXBpLycsIGxpbWl0ZXIpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXR1cFJvdXRlcygpOiB2b2lkIHtcclxuICAgIC8vIOKchSBOT1ZPOiBSb3RhIGRlIG3DqXRyaWNhcyAoUFJJTUVJUk8gLSBhbnRlcyBkZSB0dWRvKVxyXG4gICAgdGhpcy5hcHAudXNlKCcvbWV0cmljcycsIG1ldHJpY3NSb3V0ZXMpO1xyXG5cclxuICAgIC8vIEhlYWx0aCBjaGVja1xyXG4gICAgdGhpcy5zZXR1cEhlYWx0aENoZWNrKCk7XHJcblxyXG4gICAgLy8gQ29uZmlndXJhIHJvdGFzIGRlIGNhY2hlXHJcbiAgICB0aGlzLnNldHVwQ2FjaGVSb3V0ZXMoKTtcclxuXHJcbiAgICAvLyBEb2N1bWVudGHDp8OjbyBTd2FnZ2VyXHJcbiAgICB0aGlzLnNldHVwU3dhZ2dlckRvY3MoKTtcclxuXHJcbiAgICB0aGlzLnNldHVwQWRtaW5Sb3V0ZXMoKVxyXG5cclxuICAgIC8vIFJvdGFzIGRhIEFQSVxyXG4gICAgdGhpcy5hcHAudXNlKCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMnLCBcclxuICAgICAgaW5mb3JtYWNvZXNHZXJhaXNSb3V0ZXNcclxuICAgICk7XHJcblxyXG4gICAgLy8gUm90YSByYWl6IGNvbSBkb2N1bWVudGHDp8Ojb1xyXG4gICAgdGhpcy5zZXR1cFJvb3RSb3V0ZSgpO1xyXG5cclxuICAgIC8vIDQwNCAtIFJvdGEgbsOjbyBlbmNvbnRyYWRhXHJcbiAgICB0aGlzLnNldHVwNDA0SGFuZGxlcigpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXR1cEhlYWx0aENoZWNrKCk6IHZvaWQge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAb3BlbmFwaVxyXG4gICAgICogL2hlYWx0aDpcclxuICAgICAqICAgZ2V0OlxyXG4gICAgICogICAgIHN1bW1hcnk6IEhlYWx0aCBDaGVjayBkbyBTaXN0ZW1hXHJcbiAgICAgKiAgICAgZGVzY3JpcHRpb246IHxcclxuICAgICAqICAgICAgIFZlcmlmaWNhIG8gc3RhdHVzIGRlIHNhw7pkZSBkbyBzaXN0ZW1hLCBpbmNsdWluZG86XHJcbiAgICAgKiAgICAgICAtIFN0YXR1cyBnZXJhbCAoaGVhbHRoeS9kZWdyYWRlZC91bmhlYWx0aHkpXHJcbiAgICAgKiAgICAgICAtIENvbmVjdGl2aWRhZGUgY29tIGJhbmNvIGRlIGRhZG9zXHJcbiAgICAgKiAgICAgICAtIFRlbXBvIGRlIHJlc3Bvc3RhIGRvIGJhbmNvXHJcbiAgICAgKiAgICAgICAtIFVzbyBkZSBtZW3Ds3JpYSBkYSBhcGxpY2HDp8Ojb1xyXG4gICAgICogICAgICAgLSBUZW1wbyBkZSBhdGl2aWRhZGUgKHVwdGltZSlcclxuICAgICAqICAgICAgIC0gKipDb3JyZWxhdGlvbiBJRCoqIHBhcmEgcmFzdHJlYW1lbnRvXHJcbiAgICAgKiAgICAgICBcclxuICAgICAqICAgICAgICoqU3RhdHVzIHBvc3PDrXZlaXM6KipcclxuICAgICAqICAgICAgIC0gYGhlYWx0aHlgOiBTaXN0ZW1hIG9wZXJhY2lvbmFsIChEQiA8IDEwMG1zKVxyXG4gICAgICogICAgICAgLSBgZGVncmFkZWRgOiBTaXN0ZW1hIGxlbnRvIChEQiA+PSAxMDBtcylcclxuICAgICAqICAgICAgIC0gYHVuaGVhbHRoeWA6IFNpc3RlbWEgY29tIGZhbGhhcyAoREIgbsOjbyBjb25lY3RhZG8pXHJcbiAgICAgKiAgICAgdGFnczpcclxuICAgICAqICAgICAgIC0gSGVhbHRoXHJcbiAgICAgKiAgICAgcGFyYW1ldGVyczpcclxuICAgICAqICAgICAgIC0gaW46IGhlYWRlclxyXG4gICAgICogICAgICAgICBuYW1lOiBYLUNvcnJlbGF0aW9uLUlEXHJcbiAgICAgKiAgICAgICAgIHNjaGVtYTpcclxuICAgICAqICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgICAqICAgICAgICAgICBmb3JtYXQ6IHV1aWRcclxuICAgICAqICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlXHJcbiAgICAgKiAgICAgICAgIGRlc2NyaXB0aW9uOiBDb3JyZWxhdGlvbiBJRCBwYXJhIHJhc3RyZWFtZW50byAoZ2VyYWRvIGF1dG9tYXRpY2FtZW50ZSBzZSBuw6NvIGZvcm5lY2lkbylcclxuICAgICAqICAgICAgICAgZXhhbXBsZTogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCdcclxuICAgICAqICAgICByZXNwb25zZXM6XHJcbiAgICAgKiAgICAgICAyMDA6XHJcbiAgICAgKiAgICAgICAgIGRlc2NyaXB0aW9uOiBTaXN0ZW1hIHNhdWTDoXZlbCBvdSBkZWdyYWRhZG9cclxuICAgICAqICAgICAgICAgaGVhZGVyczpcclxuICAgICAqICAgICAgICAgICBYLUNvcnJlbGF0aW9uLUlEOlxyXG4gICAgICogICAgICAgICAgICAgZGVzY3JpcHRpb246IENvcnJlbGF0aW9uIElEIGRhIHJlcXVpc2nDp8Ojb1xyXG4gICAgICogICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAgICogICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgICAqICAgICAgICAgICAgICAgZm9ybWF0OiB1dWlkXHJcbiAgICAgKiAgICAgICAgIGNvbnRlbnQ6XHJcbiAgICAgKiAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgICAqICAgICAgICAgICAgIHNjaGVtYTpcclxuICAgICAqICAgICAgICAgICAgICAgJHJlZjogJyMvY29tcG9uZW50cy9zY2hlbWFzL0hlYWx0aENoZWNrJ1xyXG4gICAgICogICAgICAgNTAzOlxyXG4gICAgICogICAgICAgICBkZXNjcmlwdGlvbjogU2lzdGVtYSBuw6NvIHNhdWTDoXZlbFxyXG4gICAgICogICAgICAgICBoZWFkZXJzOlxyXG4gICAgICogICAgICAgICAgIFgtQ29ycmVsYXRpb24tSUQ6XHJcbiAgICAgKiAgICAgICAgICAgICBkZXNjcmlwdGlvbjogQ29ycmVsYXRpb24gSUQgZGEgcmVxdWlzacOnw6NvXHJcbiAgICAgKiAgICAgICAgICAgICBzY2hlbWE6XHJcbiAgICAgKiAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAgICogICAgICAgICAgICAgICBmb3JtYXQ6IHV1aWRcclxuICAgICAqICAgICAgICAgY29udGVudDpcclxuICAgICAqICAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAgICogICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAgICogICAgICAgICAgICAgICAkcmVmOiAnIy9jb21wb25lbnRzL3NjaGVtYXMvSGVhbHRoQ2hlY2snXHJcbiAgICAgKi9cclxuICB0aGlzLmFwcC5nZXQoJy9oZWFsdGgnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFZlcmlmaWNhciBiYW5jbyBkZSBkYWRvc1xyXG4gICAgICBsZXQgZGJDb25uZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgbGV0IGRiUmVzcG9uc2VUaW1lID0gMDtcclxuICAgICAgbGV0IGRiVHlwZSA9ICd1bmtub3duJztcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpO1xyXG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBEYXRhYmFzZU1hbmFnZXIuZ2V0Q29ubmVjdGlvbigpO1xyXG4gICAgICAgIGF3YWl0IGNvbm5lY3Rpb24ucXVlcnkoJ1NFTEVDVCAxIGFzIHRlc3QnKTtcclxuICAgICAgICBkYlJlc3BvbnNlVGltZSA9IERhdGUubm93KCkgLSBzdGFydDtcclxuICAgICAgICBkYkNvbm5lY3RlZCA9IHRydWU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgZGJTdGF0dXMgPSBEYXRhYmFzZU1hbmFnZXIuZ2V0Q29ubmVjdGlvblN0YXR1cygpO1xyXG4gICAgICAgIGRiVHlwZSA9IGRiU3RhdHVzLnR5cGU7XHJcblxyXG4gICAgICAgIC8vIOKchSBOT1ZPOiBSZWdpc3RyYXIgbcOpdHJpY2EgZGUgaGVhbHRoIGNoZWNrIGRvIGRhdGFiYXNlXHJcbiAgICAgICAgbWV0cmljc01hbmFnZXIuaGVhbHRoQ2hlY2tEdXJhdGlvbi5vYnNlcnZlKFxyXG4gICAgICAgICAgeyBjb21wb25lbnQ6ICdkYXRhYmFzZScgfSxcclxuICAgICAgICAgIGRiUmVzcG9uc2VUaW1lIC8gMTAwMFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgbWV0cmljc01hbmFnZXIuaGVhbHRoQ2hlY2tTdGF0dXMuc2V0KFxyXG4gICAgICAgICAgeyBjb21wb25lbnQ6ICdkYXRhYmFzZScgfSxcclxuICAgICAgICAgIGRiQ29ubmVjdGVkID8gMSA6IDBcclxuICAgICAgICApO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGxvZy5lcnJvcignSGVhbHRoIGNoZWNrIGRhdGFiYXNlIGVycm9yJywgeyBlcnJvciB9KTtcclxuICAgICAgICBkYkNvbm5lY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIC8vIOKchSBOT1ZPOiBSZWdpc3RyYXIgZmFsaGFcclxuICAgICAgICBtZXRyaWNzTWFuYWdlci5oZWFsdGhDaGVja1N0YXR1cy5zZXQoeyBjb21wb25lbnQ6ICdkYXRhYmFzZScgfSwgMCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhciBjYWNoZVxyXG4gICAgICBjb25zdCBjYWNoZUVuYWJsZWQgPSBwcm9jZXNzLmVudi5DQUNIRV9FTkFCTEVEICE9PSAnZmFsc2UnO1xyXG4gICAgICBjb25zdCBjYWNoZVN0cmF0ZWd5ID0gcHJvY2Vzcy5lbnYuQ0FDSEVfU1RSQVRFR1kgfHwgJ21lbW9yeSc7XHJcbiAgICAgIGxldCBjYWNoZVJlYWR5ID0gZmFsc2U7XHJcblxyXG4gICAgICBpZiAoY2FjaGVFbmFibGVkKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNhY2hlUmVhZHkgPSBhd2FpdCBDYWNoZU1hbmFnZXIuaXNSZWFkeSgpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICBsb2cuZXJyb3IoJ0hlYWx0aCBjaGVjayBjYWNoZSBlcnJvcicsIHsgZXJyb3IgfSk7XHJcbiAgICAgICAgICBjYWNoZVJlYWR5ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEZXRlcm1pbmFyIHN0YXR1c1xyXG4gICAgICBjb25zdCBpc0hlYWx0aHkgPSBkYkNvbm5lY3RlZCAmJiAoIWNhY2hlRW5hYmxlZCB8fCBjYWNoZVJlYWR5KTtcclxuICAgICAgY29uc3Qgc3RhdHVzQ29kZSA9IGlzSGVhbHRoeSA/IDIwMCA6IDUwMztcclxuXHJcbiAgICAgIC8vIOKchSBOT1ZPOiBSZWdpc3RyYXIgc3RhdHVzIGdlcmFsIGRhIEFQSVxyXG4gICAgICBtZXRyaWNzTWFuYWdlci5oZWFsdGhDaGVja1N0YXR1cy5zZXQoXHJcbiAgICAgICAgeyBjb21wb25lbnQ6ICdhcGknIH0sXHJcbiAgICAgICAgaXNIZWFsdGh5ID8gMSA6IDBcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuanNvbih7XHJcbiAgICAgICAgc3RhdHVzOiBpc0hlYWx0aHkgPyAnaGVhbHRoeScgOiAndW5oZWFsdGh5JyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBkYXRhYmFzZToge1xyXG4gICAgICAgICAgY29ubmVjdGVkOiBkYkNvbm5lY3RlZCxcclxuICAgICAgICAgIHJlc3BvbnNlVGltZTogZGJSZXNwb25zZVRpbWUsXHJcbiAgICAgICAgICBzdGF0dXM6IGRiQ29ubmVjdGVkID8gJ2hlYWx0aHknIDogJ3VuaGVhbHRoeScsXHJcbiAgICAgICAgICB0eXBlOiBkYlR5cGVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNhY2hlOiB7XHJcbiAgICAgICAgICBlbmFibGVkOiBjYWNoZUVuYWJsZWQsXHJcbiAgICAgICAgICBzdHJhdGVneTogY2FjaGVTdHJhdGVneSxcclxuICAgICAgICAgIHJlYWR5OiBjYWNoZVJlYWR5XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyDinIUgTk9WTzogSW5mb3JtYcOnw6NvIHNvYnJlIG3DqXRyaWNhc1xyXG4gICAgICAgIG1ldHJpY3M6IHtcclxuICAgICAgICAgIGVuYWJsZWQ6IG1ldHJpY3NNYW5hZ2VyLmlzUmVhZHkoKSxcclxuICAgICAgICAgIGVuZHBvaW50OiAnL21ldHJpY3MnXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2cuZXJyb3IoJ0hlYWx0aCBjaGVjayBmYXRhbCBlcnJvcicsIHsgZXJyb3IgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyDinIUgTk9WTzogUmVnaXN0cmFyIGZhbGhhIHRvdGFsXHJcbiAgICAgIG1ldHJpY3NNYW5hZ2VyLmhlYWx0aENoZWNrU3RhdHVzLnNldCh7IGNvbXBvbmVudDogJ2FwaScgfSwgMCk7XHJcbiAgICAgIFxyXG4gICAgICByZXMuc3RhdHVzKDUwMykuanNvbih7XHJcbiAgICAgICAgc3RhdHVzOiAndW5oZWFsdGh5JyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiB9XHJcblxyXG4gIHByaXZhdGUgc2V0dXBDYWNoZVJvdXRlcygpOiB2b2lkIHtcclxuICAgIC8qKlxyXG4gICAgICogQG9wZW5hcGlcclxuICAgICAqIC9jYWNoZS9zdGF0czpcclxuICAgICAqICAgZ2V0OlxyXG4gICAgICogICAgIHN1bW1hcnk6IEVzdGF0w61zdGljYXMgZG8gQ2FjaGVcclxuICAgICAqICAgICBkZXNjcmlwdGlvbjogfFxyXG4gICAgICogICAgICAgUmV0b3JuYSBlc3RhdMOtc3RpY2FzIGRlIHVzbyBkbyBjYWNoZTpcclxuICAgICAqICAgICAgIC0gVG90YWwgZGUgaGl0cyAoYWNlcnRvcylcclxuICAgICAqICAgICAgIC0gVG90YWwgZGUgbWlzc2VzIChlcnJvcylcclxuICAgICAqICAgICAgIC0gVGF4YSBkZSBhY2VydG8gKGhpdCByYXRlKVxyXG4gICAgICogICAgICAgLSBOw7ptZXJvIGRlIGNoYXZlcyBlbSBjYWNoZVxyXG4gICAgICogICAgICAgLSBJbmZvcm1hw6fDtWVzIGRlIGNvbmZpZ3VyYcOnw6NvXHJcbiAgICAgKiAgICAgdGFnczpcclxuICAgICAqICAgICAgIC0gQ2FjaGVcclxuICAgICAqICAgICByZXNwb25zZXM6XHJcbiAgICAgKiAgICAgICAyMDA6XHJcbiAgICAgKiAgICAgICAgIGRlc2NyaXB0aW9uOiBFc3RhdMOtc3RpY2FzIGRvIGNhY2hlXHJcbiAgICAgKiAgICAgICAgIGNvbnRlbnQ6XHJcbiAgICAgKiAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgICAqICAgICAgICAgICAgIHNjaGVtYTpcclxuICAgICAqICAgICAgICAgICAgICAgdHlwZTogb2JqZWN0XHJcbiAgICAgKiAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgc3RhdHM6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgICAqICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgIGhpdHM6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbnVtYmVyXHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgIG1pc3NlczpcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBudW1iZXJcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAga2V5czpcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBudW1iZXJcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgaGl0UmF0ZTpcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBudW1iZXJcclxuICAgICAqICAgICAgICAgICAgICAgICBjb25maWc6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgICAqICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHN0ZFRUTDpcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBudW1iZXJcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgY2hlY2twZXJpb2Q6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbnVtYmVyXHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogYm9vbGVhblxyXG4gICAgICogICAgICAgICAgICAgZXhhbXBsZTpcclxuICAgICAqICAgICAgICAgICAgICAgc3RhdHM6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgaGl0czogMTUwXHJcbiAgICAgKiAgICAgICAgICAgICAgICAgbWlzc2VzOiAzMFxyXG4gICAgICogICAgICAgICAgICAgICAgIGtleXM6IDQ1XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgaGl0UmF0ZTogODMuMzNcclxuICAgICAqICAgICAgICAgICAgICAgY29uZmlnOlxyXG4gICAgICogICAgICAgICAgICAgICAgIHN0ZFRUTDogMzAwXHJcbiAgICAgKiAgICAgICAgICAgICAgICAgY2hlY2twZXJpb2Q6IDYwMFxyXG4gICAgICogICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWVcclxuICAgICAqL1xyXG4gICAgICB0aGlzLmFwcC5nZXQoJy9jYWNoZS9zdGF0cycsIChyZXEsIHJlcykgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBzdGF0cyA9IENhY2hlTWFuYWdlci5nZXRTdGF0cygpO1xyXG4gICAgICAgICAgcmVzLmpzb24oc3RhdHMpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIGVycm9yOiAnRXJybyBhbyBvYnRlciBlc3RhdMOtc3RpY2FzIGRlIGNhY2hlJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAb3BlbmFwaVxyXG4gICAgICogL2NhY2hlL2tleXM6XHJcbiAgICAgKiAgIGdldDpcclxuICAgICAqICAgICBzdW1tYXJ5OiBMaXN0YXIgQ2hhdmVzIGRvIENhY2hlXHJcbiAgICAgKiAgICAgZGVzY3JpcHRpb246IHxcclxuICAgICAqICAgICAgIExpc3RhIHRvZGFzIGFzIGNoYXZlcyBhcm1hemVuYWRhcyBubyBjYWNoZSBjb20gc2V1cyBUVExzLlxyXG4gICAgICogICAgICAgw5p0aWwgcGFyYSBkZWJ1ZyBlIG1vbml0b3JhbWVudG8uXHJcbiAgICAgKiAgICAgdGFnczpcclxuICAgICAqICAgICAgIC0gQ2FjaGVcclxuICAgICAqICAgICByZXNwb25zZXM6XHJcbiAgICAgKiAgICAgICAyMDA6XHJcbiAgICAgKiAgICAgICAgIGRlc2NyaXB0aW9uOiBMaXN0YSBkZSBjaGF2ZXNcclxuICAgICAqICAgICAgICAgY29udGVudDpcclxuICAgICAqICAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxyXG4gICAgICogICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAgICogICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgICAqICAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgICAqICAgICAgICAgICAgICAgICBrZXlzOlxyXG4gICAgICogICAgICAgICAgICAgICAgICAgdHlwZTogYXJyYXlcclxuICAgICAqICAgICAgICAgICAgICAgICAgIGl0ZW1zOlxyXG4gICAgICogICAgICAgICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczpcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICBrZXk6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICB0dGw6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBudW1iZXJcclxuICAgICAqICAgICAgICAgICAgICAgICB0b3RhbDpcclxuICAgICAqICAgICAgICAgICAgICAgICAgIHR5cGU6IG51bWJlclxyXG4gICAgICogICAgICAgICAgICAgZXhhbXBsZTpcclxuICAgICAqICAgICAgICAgICAgICAga2V5czpcclxuICAgICAqICAgICAgICAgICAgICAgICAtIGtleTogJ2l0ZW06NzUzMDExMDppbmZvcm1hY29lc0dlcmFpcydcclxuICAgICAqICAgICAgICAgICAgICAgICAgIHR0bDogMTczNTk5NTYwMDAwMFxyXG4gICAgICogICAgICAgICAgICAgICAgIC0ga2V5OiAnR0VUOi9oZWFsdGgnXHJcbiAgICAgKiAgICAgICAgICAgICAgICAgICB0dGw6IDE3MzU5OTU2MzAwMDBcclxuICAgICAqICAgICAgICAgICAgICAgdG90YWw6IDJcclxuICAgICAqL1xyXG4gICAgICB0aGlzLmFwcC5nZXQoJy9jYWNoZS9rZXlzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IHBhdHRlcm4gPSByZXEucXVlcnkucGF0dGVybiBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgICBjb25zdCBrZXlzID0gYXdhaXQgQ2FjaGVNYW5hZ2VyLmtleXMocGF0dGVybik7XHJcbiAgICAgICAgICByZXMuanNvbih7IGtleXMsIGNvdW50OiBrZXlzLmxlbmd0aCB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBlcnJvcjogJ0Vycm8gYW8gbGlzdGFyIGNoYXZlcycsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBvcGVuYXBpXHJcbiAgICAgKiAvY2FjaGUvY2xlYXI6XHJcbiAgICAgKiAgIHBvc3Q6XHJcbiAgICAgKiAgICAgc3VtbWFyeTogTGltcGFyIENhY2hlXHJcbiAgICAgKiAgICAgZGVzY3JpcHRpb246IHxcclxuICAgICAqICAgICAgIExpbXBhIHRvZG8gbyBjYWNoZSBlIHJlc2V0YSBlc3RhdMOtc3RpY2FzLlxyXG4gICAgICogICAgICAgKipBVEVOw4fDg08qKjogVXNlIGNvbSBjdWlkYWRvIGVtIHByb2R1w6fDo28hXHJcbiAgICAgKiAgICAgdGFnczpcclxuICAgICAqICAgICAgIC0gQ2FjaGVcclxuICAgICAqICAgICByZXNwb25zZXM6XHJcbiAgICAgKiAgICAgICAyMDA6XHJcbiAgICAgKiAgICAgICAgIGRlc2NyaXB0aW9uOiBDYWNoZSBsaW1wbyBjb20gc3VjZXNzb1xyXG4gICAgICogICAgICAgICBjb250ZW50OlxyXG4gICAgICogICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAgICAgKiAgICAgICAgICAgICBleGFtcGxlOlxyXG4gICAgICogICAgICAgICAgICAgICBtZXNzYWdlOiAnQ2FjaGUgbGltcG8gY29tIHN1Y2Vzc28nXHJcbiAgICAgKiAgICAgICAgICAgICAgIGtleXNSZW1vdmVkOiA0NVxyXG4gICAgICovXHJcbiAgICB0aGlzLmFwcC5wb3N0KCcvY2FjaGUvY2xlYXInLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCBDYWNoZU1hbmFnZXIuZmx1c2goKTtcclxuICAgICAgICByZXMuanNvbih7IFxyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSwgXHJcbiAgICAgICAgICBtZXNzYWdlOiAnQ2FjaGUgbGltcG8gY29tIHN1Y2Vzc28nIFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgIGVycm9yOiAnRXJybyBhbyBsaW1wYXIgY2FjaGUnLFxyXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQG9wZW5hcGlcclxuICAgICAqIC9jYWNoZS9pbnZhbGlkYXRlL3twYXR0ZXJufTpcclxuICAgICAqICAgZGVsZXRlOlxyXG4gICAgICogICAgIHN1bW1hcnk6IEludmFsaWRhciBDYWNoZSBwb3IgUGFkcsOjb1xyXG4gICAgICogICAgIGRlc2NyaXB0aW9uOiB8XHJcbiAgICAgKiAgICAgICBJbnZhbGlkYSBjYWNoZSB1c2FuZG8gcGFkcsOjbyBkZSBjaGF2ZXMuXHJcbiAgICAgKiAgICAgICBTdXBvcnRhIHdpbGRjYXJkICgqKS5cclxuICAgICAqICAgICAgIFxyXG4gICAgICogICAgICAgRXhlbXBsb3M6XHJcbiAgICAgKiAgICAgICAtIGBpdGVtOipgIC0gVG9kYXMgYXMgY2hhdmVzIGRlIGl0ZW5zXHJcbiAgICAgKiAgICAgICAtIGBpdGVtOjc1MzAxMTA6KmAgLSBUb2RhcyBhcyBjaGF2ZXMgZG8gaXRlbSA3NTMwMTEwXHJcbiAgICAgKiAgICAgICAtIGBHRVQ6L2FwaS8qYCAtIFRvZGFzIGFzIHJlcXVpc2nDp8O1ZXMgR0VUIGRhIEFQSVxyXG4gICAgICogICAgIHRhZ3M6XHJcbiAgICAgKiAgICAgICAtIENhY2hlXHJcbiAgICAgKiAgICAgcGFyYW1ldGVyczpcclxuICAgICAqICAgICAgIC0gaW46IHBhdGhcclxuICAgICAqICAgICAgICAgbmFtZTogcGF0dGVyblxyXG4gICAgICogICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICogICAgICAgICBzY2hlbWE6XHJcbiAgICAgKiAgICAgICAgICAgdHlwZTogc3RyaW5nXHJcbiAgICAgKiAgICAgICAgIGRlc2NyaXB0aW9uOiBQYWRyw6NvIGRlIGNoYXZlcyAoc3Vwb3J0YSAqKVxyXG4gICAgICogICAgICAgICBleGFtcGxlczpcclxuICAgICAqICAgICAgICAgICBhbGxJdGVtczpcclxuICAgICAqICAgICAgICAgICAgIHZhbHVlOiAnaXRlbToqJ1xyXG4gICAgICogICAgICAgICAgICAgc3VtbWFyeTogVG9kb3Mgb3MgaXRlbnNcclxuICAgICAqICAgICAgICAgICBzaW5nbGVJdGVtOlxyXG4gICAgICogICAgICAgICAgICAgdmFsdWU6ICdpdGVtOjc1MzAxMTA6KidcclxuICAgICAqICAgICAgICAgICAgIHN1bW1hcnk6IEl0ZW0gZXNwZWPDrWZpY29cclxuICAgICAqICAgICAgICAgICBhcGlSZXF1ZXN0czpcclxuICAgICAqICAgICAgICAgICAgIHZhbHVlOiAnR0VUOi9hcGkvKidcclxuICAgICAqICAgICAgICAgICAgIHN1bW1hcnk6IFRvZGFzIGFzIHJlcXVpc2nDp8O1ZXMgR0VUXHJcbiAgICAgKiAgICAgcmVzcG9uc2VzOlxyXG4gICAgICogICAgICAgMjAwOlxyXG4gICAgICogICAgICAgICBkZXNjcmlwdGlvbjogQ2FjaGUgaW52YWxpZGFkb1xyXG4gICAgICogICAgICAgICBjb250ZW50OlxyXG4gICAgICogICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XHJcbiAgICAgKiAgICAgICAgICAgICBleGFtcGxlOlxyXG4gICAgICogICAgICAgICAgICAgICBtZXNzYWdlOiAnQ2FjaGUgaW52YWxpZGFkbydcclxuICAgICAqICAgICAgICAgICAgICAgcGF0dGVybjogJ2l0ZW06KidcclxuICAgICAqICAgICAgICAgICAgICAga2V5c1JlbW92ZWQ6IDEyXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYXBwLmRlbGV0ZSgnL2NhY2hlL2ludmFsaWRhdGUvOnBhdHRlcm4nLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgcGF0dGVybiA9IHJlcS5wYXJhbXMucGF0dGVybjtcclxuICAgICAgICAgIGNvbnN0IGRlbGV0ZWRDb3VudCA9IGF3YWl0IENhY2hlTWFuYWdlci5pbnZhbGlkYXRlKHBhdHRlcm4pO1xyXG4gICAgICAgICAgcmVzLmpzb24oeyBcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSwgXHJcbiAgICAgICAgICAgIGRlbGV0ZWRDb3VudCxcclxuICAgICAgICAgICAgcGF0dGVybiBcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIGVycm9yOiAnRXJybyBhbyBpbnZhbGlkYXIgY2FjaGUnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcilcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbn1cclxuXHJcbiAgcHJpdmF0ZSBzZXR1cFN3YWdnZXJEb2NzKCk6IHZvaWQge1xyXG4gICAgLy8gU2VydmUgU3dhZ2dlciBVSVxyXG4gICAgdGhpcy5hcHAudXNlKFxyXG4gICAgICAnL2FwaS1kb2NzJyxcclxuICAgICAgc3dhZ2dlclVpLnNlcnZlLFxyXG4gICAgICBzd2FnZ2VyVWkuc2V0dXAoc3dhZ2dlclNwZWMsIHN3YWdnZXJVaU9wdGlvbnMpXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFNlcnZlIE9wZW5BUEkgc3BlYyBlbSBKU09OXHJcbiAgICB0aGlzLmFwcC5nZXQoJy9hcGktZG9jcy5qc29uJywgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgICByZXMuc2VuZChzd2FnZ2VyU3BlYyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBsb2cuaW5mbygn8J+TmiBEb2N1bWVudGHDp8OjbyBTd2FnZ2VyIGRpc3BvbsOtdmVsIGVtIC9hcGktZG9jcycpO1xyXG4gIH1cclxuXHJcbiAgXHJcbiAgcHJpdmF0ZSBzZXR1cEFkbWluUm91dGVzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5hcHAudXNlKCcvYWRtaW4nLCBhZG1pblJvdXRlcyk7XHJcbiAgICBsb2cuaW5mbygn8J+UkSBSb3RhcyBkZSBhZG1pbmlzdHJhw6fDo28gZGlzcG9uw612ZWlzIGVtIC9hZG1pbicpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXR1cFJvb3RSb3V0ZSgpOiB2b2lkIHtcclxuICAgIC8qKlxyXG4gICAgICogQG9wZW5hcGlcclxuICAgICAqIC86XHJcbiAgICAgKiAgIGdldDpcclxuICAgICAqICAgICBzdW1tYXJ5OiBJbmZvcm1hw6fDtWVzIGRhIEFQSVxyXG4gICAgICogICAgIGRlc2NyaXB0aW9uOiB8XHJcbiAgICAgKiAgICAgICBSZXRvcm5hIGluZm9ybWHDp8O1ZXMgYsOhc2ljYXMgc29icmUgYSBBUEkgZSBsaW5rcyDDunRlaXMgcGFyYSBuYXZlZ2HDp8Ojby5cclxuICAgICAqICAgICAgIEluY2x1aSAqKkNvcnJlbGF0aW9uIElEKiogcGFyYSByYXN0cmVhbWVudG8gZGUgcmVxdWlzacOnw7Vlcy5cclxuICAgICAqICAgICB0YWdzOlxyXG4gICAgICogICAgICAgLSBIZWFsdGhcclxuICAgICAqICAgICBwYXJhbWV0ZXJzOlxyXG4gICAgICogICAgICAgLSBpbjogaGVhZGVyXHJcbiAgICAgKiAgICAgICAgIG5hbWU6IFgtQ29ycmVsYXRpb24tSURcclxuICAgICAqICAgICAgICAgc2NoZW1hOlxyXG4gICAgICogICAgICAgICAgIHR5cGU6IHN0cmluZ1xyXG4gICAgICogICAgICAgICAgIGZvcm1hdDogdXVpZFxyXG4gICAgICogICAgICAgICByZXF1aXJlZDogZmFsc2VcclxuICAgICAqICAgICAgICAgZGVzY3JpcHRpb246IENvcnJlbGF0aW9uIElEIHBhcmEgcmFzdHJlYW1lbnRvXHJcbiAgICAgKiAgICAgcmVzcG9uc2VzOlxyXG4gICAgICogICAgICAgMjAwOlxyXG4gICAgICogICAgICAgICBkZXNjcmlwdGlvbjogSW5mb3JtYcOnw7VlcyBkYSBBUElcclxuICAgICAqICAgICAgICAgaGVhZGVyczpcclxuICAgICAqICAgICAgICAgICBYLUNvcnJlbGF0aW9uLUlEOlxyXG4gICAgICogICAgICAgICAgICAgZGVzY3JpcHRpb246IENvcnJlbGF0aW9uIElEIGRhIHJlcXVpc2nDp8Ojb1xyXG4gICAgICogICAgICAgICAgICAgc2NoZW1hOlxyXG4gICAgICogICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcclxuICAgICAqICAgICAgICAgICAgICAgZm9ybWF0OiB1dWlkXHJcbiAgICAgKiAgICAgICAgIGNvbnRlbnQ6XHJcbiAgICAgKiAgICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcclxuICAgICAqICAgICAgICAgICAgIGV4YW1wbGU6XHJcbiAgICAgKiAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhc3VsIEFQSSdcclxuICAgICAqICAgICAgICAgICAgICAgdmVyc2lvbjogJzEuMC4wJ1xyXG4gICAgICogICAgICAgICAgICAgICBkb2N1bWVudGF0aW9uOiAnL2FwaS1kb2NzJ1xyXG4gICAgICogICAgICAgICAgICAgICBoZWFsdGg6ICcvaGVhbHRoJ1xyXG4gICAgICogICAgICAgICAgICAgICBlbmRwb2ludHM6XHJcbiAgICAgKiAgICAgICAgICAgICAgICAgaW5mb3JtYWNvZXNHZXJhaXM6ICcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvOml0ZW1Db2RpZ28nXHJcbiAgICAgKiAgICAgICAgICAgICAgIGNvcnJlbGF0aW9uSWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYXBwLmdldCgnLycsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRhc3VsIEFQSScsXHJcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wJyxcclxuICAgICAgICBkb2N1bWVudGF0aW9uOiAnL2FwaS1kb2NzJyxcclxuICAgICAgICBoZWFsdGg6ICcvaGVhbHRoJyxcclxuICAgICAgICBtZXRyaWNzOiAnL21ldHJpY3MnLCAvLyDinIUgTk9WT1xyXG4gICAgICAgIGVuZHBvaW50czoge1xyXG4gICAgICAgICAgaW5mb3JtYWNvZXNHZXJhaXM6ICcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvOml0ZW1Db2RpZ28nXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWRcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0dXA0MDRIYW5kbGVyKCk6IHZvaWQge1xyXG4gICAgdGhpcy5hcHAudXNlKChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICAgICAgbG9nLndhcm4oJ1JvdGEgbsOjbyBlbmNvbnRyYWRhJywge1xyXG4gICAgICAgIGNvcnJlbGF0aW9uSWQ6IHJlcS5pZCxcclxuICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXHJcbiAgICAgICAgdXJsOiByZXEudXJsXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnUm90YSBuw6NvIGVuY29udHJhZGEnLFxyXG4gICAgICAgIG1lc3NhZ2U6IGBBIHJvdGEgJHtyZXEubWV0aG9kfSAke3JlcS51cmx9IG7Do28gZXhpc3RlYCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBwYXRoOiByZXEudXJsLFxyXG4gICAgICAgIGNvcnJlbGF0aW9uSWQ6IHJlcS5pZCxcclxuICAgICAgICBhdmFpbGFibGVSb3V0ZXM6IHtcclxuICAgICAgICAgIGRvY3VtZW50YXRpb246ICcvYXBpLWRvY3MnLFxyXG4gICAgICAgICAgaGVhbHRoOiAnL2hlYWx0aCcsXHJcbiAgICAgICAgICBtZXRyaWNzOiAnL21ldHJpY3MnLCAvLyDinIUgTk9WT1xyXG4gICAgICAgICAgYXBpOiAnL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzLzppdGVtQ29kaWdvJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0dXBFcnJvckhhbmRsaW5nKCk6IHZvaWQge1xyXG4gICAgLy8g4pyFIE1VREFOw4dBOiBFcnJvciBoYW5kbGVyIG1lbGhvcmFkbyB1c2FuZG8gQXBwRXJyb3JcclxuICAgIHRoaXMuYXBwLnVzZSgoZXJyOiBFcnJvciB8IEFwcEVycm9yLCByZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xyXG4gICAgICAvLyBUaW1lb3V0IGVycm9yXHJcbiAgICAgIGlmIChlcnIubWVzc2FnZSA9PT0gJ1Jlc3BvbnNlIHRpbWVvdXQnIHx8IHJlcS50aW1lZG91dCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwOCkuanNvbih7XHJcbiAgICAgICAgICBlcnJvcjogJ1RpbWVvdXQnLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ0EgcmVxdWlzacOnw6NvIGRlbW9yb3UgbXVpdG8gdGVtcG8gcGFyYSBzZXIgcHJvY2Vzc2FkYScsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHBhdGg6IHJlcS51cmwsXHJcbiAgICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWRcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU2UgZm9yIEFwcEVycm9yIChkbyBzaXN0ZW1hIHVuaWZpY2FkbyksIHVzYSBzdGF0dXNDb2RlIGUgY29udGV4dFxyXG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgQXBwRXJyb3IpIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZTogYW55ID0ge1xyXG4gICAgICAgICAgZXJyb3I6IGVyci5uYW1lLFxyXG4gICAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHBhdGg6IHJlcS51cmwsXHJcbiAgICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBBZGljaW9uYSBjb250ZXh0IGNvbW8gZGV0YWlscyBzZSBleGlzdGlyXHJcbiAgICAgICAgaWYgKGVyci5jb250ZXh0KSB7XHJcbiAgICAgICAgICByZXNwb25zZS5kZXRhaWxzID0gZXJyLmNvbnRleHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb2cgYXByb3ByaWFkb1xyXG4gICAgICAgIGlmIChlcnIuaXNPcGVyYXRpb25hbCkge1xyXG4gICAgICAgICAgbG9nLndhcm4oJ0Vycm8gb3BlcmFjaW9uYWwnLCB7XHJcbiAgICAgICAgICAgIGNvcnJlbGF0aW9uSWQ6IHJlcS5pZCxcclxuICAgICAgICAgICAgZXJyb3I6IGVyci5uYW1lLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZSxcclxuICAgICAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsXHJcbiAgICAgICAgICAgIGNvbnRleHQ6IGVyci5jb250ZXh0XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbG9nLmVycm9yKCdFcnJvIGNyw610aWNvJywge1xyXG4gICAgICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWQsXHJcbiAgICAgICAgICAgIGVycm9yOiBlcnIubmFtZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLFxyXG4gICAgICAgICAgICBzdGFjazogZXJyLnN0YWNrLFxyXG4gICAgICAgICAgICBjb250ZXh0OiBlcnIuY29udGV4dFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhlcnIuc3RhdHVzQ29kZSkuanNvbihyZXNwb25zZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEVycm8gZ2Vuw6lyaWNvIG7Do28gdHJhdGFkb1xyXG4gICAgICBsb2cuZXJyb3IoJ0Vycm8gbsOjbyB0cmF0YWRvJywge1xyXG4gICAgICAgIGNvcnJlbGF0aW9uSWQ6IHJlcS5pZCxcclxuICAgICAgICBlcnJvcjogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgc3RhY2s6IGVyci5zdGFjayxcclxuICAgICAgICB1cmw6IHJlcS51cmwsXHJcbiAgICAgICAgbWV0aG9kOiByZXEubWV0aG9kXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnRXJybyBpbnRlcm5vJyxcclxuICAgICAgICBtZXNzYWdlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nIFxyXG4gICAgICAgICAgPyAnT2NvcnJldSB1bSBlcnJvIGFvIHByb2Nlc3NhciBzdWEgcmVxdWlzacOnw6NvJyBcclxuICAgICAgICAgIDogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgcGF0aDogcmVxLnVybCxcclxuICAgICAgICBjb3JyZWxhdGlvbklkOiByZXEuaWRcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRFeHByZXNzQXBwKCk6IEFwcGxpY2F0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLmFwcDtcclxuICB9XHJcbn1cclxuXHJcbi8vIOKchSBFeHBvcnQgZGVmYXVsdCBkYSBpbnN0w6JuY2lhXHJcbmNvbnN0IGFwcEluc3RhbmNlID0gbmV3IEFwcCgpO1xyXG5leHBvcnQgZGVmYXVsdCBhcHBJbnN0YW5jZS5nZXRFeHByZXNzQXBwKCk7Il0sInZlcnNpb24iOjN9