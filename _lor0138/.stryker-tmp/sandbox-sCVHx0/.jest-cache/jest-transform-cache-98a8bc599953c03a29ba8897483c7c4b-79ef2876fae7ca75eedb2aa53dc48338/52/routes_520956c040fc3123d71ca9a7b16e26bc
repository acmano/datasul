8097824b4a9c36671fca9da7b1a2a70c
"use strict";
// src/api/metrics/routes.ts
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const MetricsManager_1 = require("@infrastructure/metrics/MetricsManager");
const router = (0, express_1.Router)();
/**
 * GET /metrics
 * Retorna todas as métricas no formato Prometheus
 *
 * Este endpoint é usado pelo Prometheus para scraping
 */
router.get('/', async (req, res) => {
    try {
        res.set('Content-Type', MetricsManager_1.metricsManager.getRegistry().contentType);
        const metrics = await MetricsManager_1.metricsManager.getMetrics();
        res.end(metrics);
    }
    catch (error) {
        console.error('Erro ao obter métricas:', error);
        res.status(500).json({
            error: 'Erro ao obter métricas',
            message: error.message,
        });
    }
});
/**
 * GET /metrics/health
 * Health check específico para métricas
 */
router.get('/health', (req, res) => {
    const isReady = MetricsManager_1.metricsManager.isReady();
    res.status(isReady ? 200 : 503).json({
        status: isReady ? 'healthy' : 'unhealthy',
        metrics: {
            enabled: true,
            ready: isReady,
        },
    });
});
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvc3JjL2FwaS9tZXRyaWNzL3JvdXRlcy50cyIsIm1hcHBpbmdzIjoiO0FBQUEsNEJBQTRCOztBQUU1QixxQ0FBb0Q7QUFDcEQsMkVBQXdFO0FBRXhFLE1BQU0sTUFBTSxHQUFHLElBQUEsZ0JBQU0sR0FBRSxDQUFDO0FBRXhCOzs7OztHQUtHO0FBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUNwRCxJQUFJLENBQUM7UUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSwrQkFBYyxDQUFDLFdBQVcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sT0FBTyxHQUFHLE1BQU0sK0JBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsRCxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNoRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNuQixLQUFLLEVBQUUsd0JBQXdCO1lBQy9CLE9BQU8sRUFBRyxLQUFlLENBQUMsT0FBTztTQUNsQyxDQUFDLENBQUM7SUFDTCxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSDs7O0dBR0c7QUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUNwRCxNQUFNLE9BQU8sR0FBRywrQkFBYyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBRXpDLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNuQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFdBQVc7UUFDekMsT0FBTyxFQUFFO1lBQ1AsT0FBTyxFQUFFLElBQUk7WUFDYixLQUFLLEVBQUUsT0FBTztTQUNmO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxrQkFBZSxNQUFNLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvc3JjL2FwaS9tZXRyaWNzL3JvdXRlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvYXBpL21ldHJpY3Mvcm91dGVzLnRzXG5cbmltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IG1ldHJpY3NNYW5hZ2VyIH0gZnJvbSAnQGluZnJhc3RydWN0dXJlL21ldHJpY3MvTWV0cmljc01hbmFnZXInO1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxuLyoqXG4gKiBHRVQgL21ldHJpY3NcbiAqIFJldG9ybmEgdG9kYXMgYXMgbcOpdHJpY2FzIG5vIGZvcm1hdG8gUHJvbWV0aGV1c1xuICogXG4gKiBFc3RlIGVuZHBvaW50IMOpIHVzYWRvIHBlbG8gUHJvbWV0aGV1cyBwYXJhIHNjcmFwaW5nXG4gKi9cbnJvdXRlci5nZXQoJy8nLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gIHRyeSB7XG4gICAgcmVzLnNldCgnQ29udGVudC1UeXBlJywgbWV0cmljc01hbmFnZXIuZ2V0UmVnaXN0cnkoKS5jb250ZW50VHlwZSk7XG4gICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IG1ldHJpY3NNYW5hZ2VyLmdldE1ldHJpY3MoKTtcbiAgICByZXMuZW5kKG1ldHJpY3MpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gb2J0ZXIgbcOpdHJpY2FzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBlcnJvcjogJ0Vycm8gYW8gb2J0ZXIgbcOpdHJpY2FzJyxcbiAgICAgIG1lc3NhZ2U6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSxcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8qKlxuICogR0VUIC9tZXRyaWNzL2hlYWx0aFxuICogSGVhbHRoIGNoZWNrIGVzcGVjw61maWNvIHBhcmEgbcOpdHJpY2FzXG4gKi9cbnJvdXRlci5nZXQoJy9oZWFsdGgnLCAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gIGNvbnN0IGlzUmVhZHkgPSBtZXRyaWNzTWFuYWdlci5pc1JlYWR5KCk7XG5cbiAgcmVzLnN0YXR1cyhpc1JlYWR5ID8gMjAwIDogNTAzKS5qc29uKHtcbiAgICBzdGF0dXM6IGlzUmVhZHkgPyAnaGVhbHRoeScgOiAndW5oZWFsdGh5JyxcbiAgICBtZXRyaWNzOiB7XG4gICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgcmVhZHk6IGlzUmVhZHksXG4gICAgfSxcbiAgfSk7XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyJdLCJ2ZXJzaW9uIjozfQ==