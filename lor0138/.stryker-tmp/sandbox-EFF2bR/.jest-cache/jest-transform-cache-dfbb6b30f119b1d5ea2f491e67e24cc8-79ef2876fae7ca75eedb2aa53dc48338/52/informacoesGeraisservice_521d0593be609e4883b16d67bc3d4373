8627584648d45939f8586c566f133c74
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InformacoesGeraisService = void 0;
// @ts-nocheck
// src/api/lor0138/item/dadosCadastrais/informacoesGerais/service/informacoesGerais.service.ts
function stryNS_9fa48() {
    var g = typeof globalThis === 'object' && globalThis && globalThis.Math === Math && globalThis || new Function("return this")();
    var ns = g.__stryker__ || (g.__stryker__ = {});
    if (ns.activeMutant === undefined && g.process && g.process.env && g.process.env.__STRYKER_ACTIVE_MUTANT__) {
        ns.activeMutant = g.process.env.__STRYKER_ACTIVE_MUTANT__;
    }
    function retrieveNS() {
        return ns;
    }
    stryNS_9fa48 = retrieveNS;
    return retrieveNS();
}
stryNS_9fa48();
function stryCov_9fa48() {
    var ns = stryNS_9fa48();
    var cov = ns.mutantCoverage || (ns.mutantCoverage = {
        static: {},
        perTest: {}
    });
    function cover() {
        var c = cov.static;
        if (ns.currentTestId) {
            c = cov.perTest[ns.currentTestId] = cov.perTest[ns.currentTestId] || {};
        }
        var a = arguments;
        for (var i = 0; i < a.length; i++) {
            c[a[i]] = (c[a[i]] || 0) + 1;
        }
    }
    stryCov_9fa48 = cover;
    cover.apply(null, arguments);
}
function stryMutAct_9fa48(id) {
    var ns = stryNS_9fa48();
    function isActive(id) {
        if (ns.activeMutant === id) {
            if (ns.hitCount !== void 0 && ++ns.hitCount > ns.hitLimit) {
                throw new Error('Stryker: Hit count limit reached (' + ns.hitCount + ')');
            }
            return true;
        }
        return false;
    }
    stryMutAct_9fa48 = isActive;
    return isActive(id);
}
const informacoesGerais_repository_1 = require("../repository/informacoesGerais.repository");
const CustomErrors_1 = require("@shared/errors/CustomErrors");
const logger_1 = require("@shared/utils/logger");
class InformacoesGeraisService {
    static async getInformacoesGerais(itemCodigo) {
        if (stryMutAct_9fa48("187")) {
            { }
        }
        else {
            stryCov_9fa48("187");
            try {
                if (stryMutAct_9fa48("188")) {
                    { }
                }
                else {
                    stryCov_9fa48("188");
                    // Buscar dados do item
                    const itemData = await informacoesGerais_repository_1.ItemInformacoesGeraisRepository.getItemMaster(itemCodigo);
                    // Se não encontrou o item
                    if (stryMutAct_9fa48("191") ? false : stryMutAct_9fa48("190") ? true : stryMutAct_9fa48("189") ? itemData : (stryCov_9fa48("189", "190", "191"), !itemData)) {
                        if (stryMutAct_9fa48("192")) {
                            { }
                        }
                        else {
                            stryCov_9fa48("192");
                            logger_1.log.info(stryMutAct_9fa48("193") ? "" : (stryCov_9fa48("193"), 'Item não encontrado'), stryMutAct_9fa48("194") ? {} : (stryCov_9fa48("194"), {
                                itemCodigo
                            }));
                            throw new CustomErrors_1.ItemNotFoundError(itemCodigo);
                        }
                    }
                    // Buscar estabelecimentos
                    const estabelecimentos = await informacoesGerais_repository_1.ItemInformacoesGeraisRepository.getItemEstabelecimentos(itemCodigo);
                    // Montar resposta
                    const response = stryMutAct_9fa48("195") ? {} : (stryCov_9fa48("195"), {
                        identificacaoItemCodigo: itemData.itemCodigo,
                        identificacaoItemDescricao: itemData.itemDescricao,
                        identificacaoItemUnidade: itemData.itemUnidade,
                        identificacaoItensEstabelecimentos: estabelecimentos.map(stryMutAct_9fa48("196") ? () => undefined : (stryCov_9fa48("196"), estab => stryMutAct_9fa48("197") ? {} : (stryCov_9fa48("197"), {
                            itemCodigo: estab.itemCodigo,
                            estabCodigo: estab.estabCodigo,
                            estabNome: estab.estabNome,
                            statusIndex: (stryMutAct_9fa48("200") ? estab.codObsoleto !== 0 : stryMutAct_9fa48("199") ? false : stryMutAct_9fa48("198") ? true : (stryCov_9fa48("198", "199", "200"), estab.codObsoleto === 0)) ? 1 : 2
                        })))
                    });
                    return response;
                }
            }
            catch (error) {
                if (stryMutAct_9fa48("201")) {
                    { }
                }
                else {
                    stryCov_9fa48("201");
                    // Se já é erro customizado, re-lança
                    if (stryMutAct_9fa48("203") ? false : stryMutAct_9fa48("202") ? true : (stryCov_9fa48("202", "203"), error instanceof CustomErrors_1.ItemNotFoundError)) {
                        if (stryMutAct_9fa48("204")) {
                            { }
                        }
                        else {
                            stryCov_9fa48("204");
                            throw error;
                        }
                    }
                    // Se for erro de banco, converte para DatabaseError
                    logger_1.log.error(stryMutAct_9fa48("205") ? "" : (stryCov_9fa48("205"), 'Erro ao buscar informações gerais'), stryMutAct_9fa48("206") ? {} : (stryCov_9fa48("206"), {
                        itemCodigo,
                        error: error instanceof Error ? error.message : stryMutAct_9fa48("207") ? "" : (stryCov_9fa48("207"), 'Erro desconhecido')
                    }));
                    throw new CustomErrors_1.DatabaseError(stryMutAct_9fa48("208") ? "" : (stryCov_9fa48("208"), 'Falha ao buscar informações do item'), error instanceof Error ? error : undefined);
                }
            }
        }
    }
}
exports.InformacoesGeraisService = InformacoesGeraisService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvLnN0cnlrZXItdG1wL3NhbmRib3gtRUZGMmJSL3NyYy9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy9zZXJ2aWNlL2luZm9ybWFjb2VzR2VyYWlzLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsY0FBYztBQUNkLDhGQUE4RjtBQUM5RixTQUFTLFlBQVk7SUFDbkIsSUFBSSxDQUFDLEdBQUcsT0FBTyxVQUFVLEtBQUssUUFBUSxJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxVQUFVLElBQUksSUFBSSxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztJQUNoSSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMvQyxJQUFJLEVBQUUsQ0FBQyxZQUFZLEtBQUssU0FBUyxJQUFJLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLEVBQUUsQ0FBQztRQUMzRyxFQUFFLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDO0lBQzVELENBQUM7SUFDRCxTQUFTLFVBQVU7UUFDakIsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBQ0QsWUFBWSxHQUFHLFVBQVUsQ0FBQztJQUMxQixPQUFPLFVBQVUsRUFBRSxDQUFDO0FBQ3RCLENBQUM7QUFDRCxZQUFZLEVBQUUsQ0FBQztBQUNmLFNBQVMsYUFBYTtJQUNwQixJQUFJLEVBQUUsR0FBRyxZQUFZLEVBQUUsQ0FBQztJQUN4QixJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUMsY0FBYyxJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsR0FBRztRQUNsRCxN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L2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvLnN0cnlrZXItdG1wL3NhbmRib3gtRUZGMmJSL3NyYy9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy9zZXJ2aWNlL2luZm9ybWFjb2VzR2VyYWlzLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLW5vY2hlY2tcbi8vIHNyYy9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy9zZXJ2aWNlL2luZm9ybWFjb2VzR2VyYWlzLnNlcnZpY2UudHNcbmZ1bmN0aW9uIHN0cnlOU185ZmE0OCgpIHtcbiAgdmFyIGcgPSB0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcgJiYgZ2xvYmFsVGhpcyAmJiBnbG9iYWxUaGlzLk1hdGggPT09IE1hdGggJiYgZ2xvYmFsVGhpcyB8fCBuZXcgRnVuY3Rpb24oXCJyZXR1cm4gdGhpc1wiKSgpO1xuICB2YXIgbnMgPSBnLl9fc3RyeWtlcl9fIHx8IChnLl9fc3RyeWtlcl9fID0ge30pO1xuICBpZiAobnMuYWN0aXZlTXV0YW50ID09PSB1bmRlZmluZWQgJiYgZy5wcm9jZXNzICYmIGcucHJvY2Vzcy5lbnYgJiYgZy5wcm9jZXNzLmVudi5fX1NUUllLRVJfQUNUSVZFX01VVEFOVF9fKSB7XG4gICAgbnMuYWN0aXZlTXV0YW50ID0gZy5wcm9jZXNzLmVudi5fX1NUUllLRVJfQUNUSVZFX01VVEFOVF9fO1xuICB9XG4gIGZ1bmN0aW9uIHJldHJpZXZlTlMoKSB7XG4gICAgcmV0dXJuIG5zO1xuICB9XG4gIHN0cnlOU185ZmE0OCA9IHJldHJpZXZlTlM7XG4gIHJldHVybiByZXRyaWV2ZU5TKCk7XG59XG5zdHJ5TlNfOWZhNDgoKTtcbmZ1bmN0aW9uIHN0cnlDb3ZfOWZhNDgoKSB7XG4gIHZhciBucyA9IHN0cnlOU185ZmE0OCgpO1xuICB2YXIgY292ID0gbnMubXV0YW50Q292ZXJhZ2UgfHwgKG5zLm11dGFudENvdmVyYWdlID0ge1xuICAgIHN0YXRpYzoge30sXG4gICAgcGVyVGVzdDoge31cbiAgfSk7XG4gIGZ1bmN0aW9uIGNvdmVyKCkge1xuICAgIHZhciBjID0gY292LnN0YXRpYztcbiAgICBpZiAobnMuY3VycmVudFRlc3RJZCkge1xuICAgICAgYyA9IGNvdi5wZXJUZXN0W25zLmN1cnJlbnRUZXN0SWRdID0gY292LnBlclRlc3RbbnMuY3VycmVudFRlc3RJZF0gfHwge307XG4gICAgfVxuICAgIHZhciBhID0gYXJndW1lbnRzO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykge1xuICAgICAgY1thW2ldXSA9IChjW2FbaV1dIHx8IDApICsgMTtcbiAgICB9XG4gIH1cbiAgc3RyeUNvdl85ZmE0OCA9IGNvdmVyO1xuICBjb3Zlci5hcHBseShudWxsLCBhcmd1bWVudHMpO1xufVxuZnVuY3Rpb24gc3RyeU11dEFjdF85ZmE0OChpZCkge1xuICB2YXIgbnMgPSBzdHJ5TlNfOWZhNDgoKTtcbiAgZnVuY3Rpb24gaXNBY3RpdmUoaWQpIHtcbiAgICBpZiAobnMuYWN0aXZlTXV0YW50ID09PSBpZCkge1xuICAgICAgaWYgKG5zLmhpdENvdW50ICE9PSB2b2lkIDAgJiYgKytucy5oaXRDb3VudCA+IG5zLmhpdExpbWl0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignU3RyeWtlcjogSGl0IGNvdW50IGxpbWl0IHJlYWNoZWQgKCcgKyBucy5oaXRDb3VudCArICcpJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHN0cnlNdXRBY3RfOWZhNDggPSBpc0FjdGl2ZTtcbiAgcmV0dXJuIGlzQWN0aXZlKGlkKTtcbn1cbmltcG9ydCB7IEl0ZW1JbmZvcm1hY29lc0dlcmFpc1JlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3J5L2luZm9ybWFjb2VzR2VyYWlzLnJlcG9zaXRvcnknO1xuaW1wb3J0IHsgRGF0YWJhc2VFcnJvciwgSXRlbU5vdEZvdW5kRXJyb3IgfSBmcm9tICdAc2hhcmVkL2Vycm9ycy9DdXN0b21FcnJvcnMnO1xuaW1wb3J0IHsgbG9nIH0gZnJvbSAnQHNoYXJlZC91dGlscy9sb2dnZXInO1xuZXhwb3J0IGNsYXNzIEluZm9ybWFjb2VzR2VyYWlzU2VydmljZSB7XG4gIHN0YXRpYyBhc3luYyBnZXRJbmZvcm1hY29lc0dlcmFpcyhpdGVtQ29kaWdvOiBzdHJpbmcpOiBQcm9taXNlPGFueSB8IG51bGw+IHtcbiAgICBpZiAoc3RyeU11dEFjdF85ZmE0OChcIjE4N1wiKSkge1xuICAgICAge31cbiAgICB9IGVsc2Uge1xuICAgICAgc3RyeUNvdl85ZmE0OChcIjE4N1wiKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChzdHJ5TXV0QWN0XzlmYTQ4KFwiMTg4XCIpKSB7XG4gICAgICAgICAge31cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdHJ5Q292XzlmYTQ4KFwiMTg4XCIpO1xuICAgICAgICAgIC8vIEJ1c2NhciBkYWRvcyBkbyBpdGVtXG4gICAgICAgICAgY29uc3QgaXRlbURhdGEgPSBhd2FpdCBJdGVtSW5mb3JtYWNvZXNHZXJhaXNSZXBvc2l0b3J5LmdldEl0ZW1NYXN0ZXIoaXRlbUNvZGlnbyk7XG5cbiAgICAgICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSBvIGl0ZW1cbiAgICAgICAgICBpZiAoc3RyeU11dEFjdF85ZmE0OChcIjE5MVwiKSA/IGZhbHNlIDogc3RyeU11dEFjdF85ZmE0OChcIjE5MFwiKSA/IHRydWUgOiBzdHJ5TXV0QWN0XzlmYTQ4KFwiMTg5XCIpID8gaXRlbURhdGEgOiAoc3RyeUNvdl85ZmE0OChcIjE4OVwiLCBcIjE5MFwiLCBcIjE5MVwiKSwgIWl0ZW1EYXRhKSkge1xuICAgICAgICAgICAgaWYgKHN0cnlNdXRBY3RfOWZhNDgoXCIxOTJcIikpIHtcbiAgICAgICAgICAgICAge31cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHN0cnlDb3ZfOWZhNDgoXCIxOTJcIik7XG4gICAgICAgICAgICAgIGxvZy5pbmZvKHN0cnlNdXRBY3RfOWZhNDgoXCIxOTNcIikgPyBcIlwiIDogKHN0cnlDb3ZfOWZhNDgoXCIxOTNcIiksICdJdGVtIG7Do28gZW5jb250cmFkbycpLCBzdHJ5TXV0QWN0XzlmYTQ4KFwiMTk0XCIpID8ge30gOiAoc3RyeUNvdl85ZmE0OChcIjE5NFwiKSwge1xuICAgICAgICAgICAgICAgIGl0ZW1Db2RpZ29cbiAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgSXRlbU5vdEZvdW5kRXJyb3IoaXRlbUNvZGlnbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQnVzY2FyIGVzdGFiZWxlY2ltZW50b3NcbiAgICAgICAgICBjb25zdCBlc3RhYmVsZWNpbWVudG9zID0gYXdhaXQgSXRlbUluZm9ybWFjb2VzR2VyYWlzUmVwb3NpdG9yeS5nZXRJdGVtRXN0YWJlbGVjaW1lbnRvcyhpdGVtQ29kaWdvKTtcblxuICAgICAgICAgIC8vIE1vbnRhciByZXNwb3N0YVxuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gc3RyeU11dEFjdF85ZmE0OChcIjE5NVwiKSA/IHt9IDogKHN0cnlDb3ZfOWZhNDgoXCIxOTVcIiksIHtcbiAgICAgICAgICAgIGlkZW50aWZpY2FjYW9JdGVtQ29kaWdvOiBpdGVtRGF0YS5pdGVtQ29kaWdvLFxuICAgICAgICAgICAgaWRlbnRpZmljYWNhb0l0ZW1EZXNjcmljYW86IGl0ZW1EYXRhLml0ZW1EZXNjcmljYW8sXG4gICAgICAgICAgICBpZGVudGlmaWNhY2FvSXRlbVVuaWRhZGU6IGl0ZW1EYXRhLml0ZW1VbmlkYWRlLFxuICAgICAgICAgICAgaWRlbnRpZmljYWNhb0l0ZW5zRXN0YWJlbGVjaW1lbnRvczogZXN0YWJlbGVjaW1lbnRvcy5tYXAoc3RyeU11dEFjdF85ZmE0OChcIjE5NlwiKSA/ICgpID0+IHVuZGVmaW5lZCA6IChzdHJ5Q292XzlmYTQ4KFwiMTk2XCIpLCBlc3RhYiA9PiBzdHJ5TXV0QWN0XzlmYTQ4KFwiMTk3XCIpID8ge30gOiAoc3RyeUNvdl85ZmE0OChcIjE5N1wiKSwge1xuICAgICAgICAgICAgICBpdGVtQ29kaWdvOiBlc3RhYi5pdGVtQ29kaWdvLFxuICAgICAgICAgICAgICBlc3RhYkNvZGlnbzogZXN0YWIuZXN0YWJDb2RpZ28sXG4gICAgICAgICAgICAgIGVzdGFiTm9tZTogZXN0YWIuZXN0YWJOb21lLFxuICAgICAgICAgICAgICBzdGF0dXNJbmRleDogKHN0cnlNdXRBY3RfOWZhNDgoXCIyMDBcIikgPyBlc3RhYi5jb2RPYnNvbGV0byAhPT0gMCA6IHN0cnlNdXRBY3RfOWZhNDgoXCIxOTlcIikgPyBmYWxzZSA6IHN0cnlNdXRBY3RfOWZhNDgoXCIxOThcIikgPyB0cnVlIDogKHN0cnlDb3ZfOWZhNDgoXCIxOThcIiwgXCIxOTlcIiwgXCIyMDBcIiksIGVzdGFiLmNvZE9ic29sZXRvID09PSAwKSkgPyAxIDogMlxuICAgICAgICAgICAgfSkpKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKHN0cnlNdXRBY3RfOWZhNDgoXCIyMDFcIikpIHtcbiAgICAgICAgICB7fVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0cnlDb3ZfOWZhNDgoXCIyMDFcIik7XG4gICAgICAgICAgLy8gU2UgasOhIMOpIGVycm8gY3VzdG9taXphZG8sIHJlLWxhbsOnYVxuICAgICAgICAgIGlmIChzdHJ5TXV0QWN0XzlmYTQ4KFwiMjAzXCIpID8gZmFsc2UgOiBzdHJ5TXV0QWN0XzlmYTQ4KFwiMjAyXCIpID8gdHJ1ZSA6IChzdHJ5Q292XzlmYTQ4KFwiMjAyXCIsIFwiMjAzXCIpLCBlcnJvciBpbnN0YW5jZW9mIEl0ZW1Ob3RGb3VuZEVycm9yKSkge1xuICAgICAgICAgICAgaWYgKHN0cnlNdXRBY3RfOWZhNDgoXCIyMDRcIikpIHtcbiAgICAgICAgICAgICAge31cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHN0cnlDb3ZfOWZhNDgoXCIyMDRcIik7XG4gICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFNlIGZvciBlcnJvIGRlIGJhbmNvLCBjb252ZXJ0ZSBwYXJhIERhdGFiYXNlRXJyb3JcbiAgICAgICAgICBsb2cuZXJyb3Ioc3RyeU11dEFjdF85ZmE0OChcIjIwNVwiKSA/IFwiXCIgOiAoc3RyeUNvdl85ZmE0OChcIjIwNVwiKSwgJ0Vycm8gYW8gYnVzY2FyIGluZm9ybWHDp8O1ZXMgZ2VyYWlzJyksIHN0cnlNdXRBY3RfOWZhNDgoXCIyMDZcIikgPyB7fSA6IChzdHJ5Q292XzlmYTQ4KFwiMjA2XCIpLCB7XG4gICAgICAgICAgICBpdGVtQ29kaWdvLFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogc3RyeU11dEFjdF85ZmE0OChcIjIwN1wiKSA/IFwiXCIgOiAoc3RyeUNvdl85ZmE0OChcIjIwN1wiKSwgJ0Vycm8gZGVzY29uaGVjaWRvJylcbiAgICAgICAgICB9KSk7XG4gICAgICAgICAgdGhyb3cgbmV3IERhdGFiYXNlRXJyb3Ioc3RyeU11dEFjdF85ZmE0OChcIjIwOFwiKSA/IFwiXCIgOiAoc3RyeUNvdl85ZmE0OChcIjIwOFwiKSwgJ0ZhbGhhIGFvIGJ1c2NhciBpbmZvcm1hw6fDtWVzIGRvIGl0ZW0nKSwgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogdW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==