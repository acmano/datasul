f106eb5a769bcb604d668e8bf40f44f5
"use strict";
// src/api/lor0138/item/dadosCadastrais/informacoesGerais/validators/informacoesGerais.validators.ts
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateItemInformacoesGeraisRequest = validateItemInformacoesGeraisRequest;
/**
 * Sanitiza o código do item removendo caracteres perigosos
 */
function sanitizeItemCodigo(value) {
    // Remove espaços em branco nas extremidades
    let sanitized = value.trim();
    // Remove caracteres de controle e não imprimíveis
    sanitized = sanitized.replace(/[\x00-\x1F\x7F]/g, '');
    // Remove tentativas de path traversal
    sanitized = sanitized.replace(/\.\./g, '');
    sanitized = sanitized.replace(/[\/\\]/g, '');
    // Remove caracteres SQL perigosos adicionais (redundante com prepared statements, mas seguro)
    sanitized = sanitized.replace(/[';"\-\-]/g, '');
    // Remove tags HTML/XML (prevenção XSS)
    sanitized = sanitized.replace(/<[^>]*>/g, '');
    return sanitized;
}
/**
 * Valida formato do código do item
 */
function isValidItemCodigoFormat(value) {
    // Permite apenas: letras e números
    // Caracteres permitidos: A-Z, a-z, 0-9
    const validPattern = /^[A-Za-z0-9]+$/;
    return validPattern.test(value);
}
/**
 * Valida os parâmetros de busca de informações gerais do item
 */
function validateItemInformacoesGeraisRequest(data) {
    // 1. Verifica se itemCodigo foi fornecido
    if (!data.itemCodigo) {
        return {
            valid: false,
            error: 'Código do item é obrigatório',
        };
    }
    // 2. Valida tipo
    if (typeof data.itemCodigo !== 'string') {
        return {
            valid: false,
            error: 'Código do item deve ser uma string',
        };
    }
    // 3. Sanitiza
    const sanitized = sanitizeItemCodigo(data.itemCodigo);
    // 4. Valida se não ficou vazio após sanitização
    if (sanitized.length === 0) {
        return {
            valid: false,
            error: 'Código do item inválido ou contém apenas caracteres não permitidos',
        };
    }
    // 5. Valida tamanho máximo
    if (sanitized.length > 16) {
        return {
            valid: false,
            error: 'Código do item não pode ter mais de 16 caracteres',
        };
    }
    // 6. Valida tamanho mínimo
    if (sanitized.length < 1) {
        return {
            valid: false,
            error: 'Código do item não pode estar vazio',
        };
    }
    // 7. Valida formato (caracteres permitidos)
    if (!isValidItemCodigoFormat(sanitized)) {
        return {
            valid: false,
            error: 'Código do item contém caracteres inválidos. Use apenas letras, números e caracteres básicos',
        };
    }
    // 8. Validações adicionais de segurança
    // Bloqueia tentativas óbvias de SQL injection
    const sqlKeywords = ['SELECT', 'INSERT', 'UPDATE', 'DELETE', 'DROP', 'CREATE', 'ALTER', 'EXEC', 'UNION'];
    const upperSanitized = sanitized.toUpperCase();
    for (const keyword of sqlKeywords) {
        if (upperSanitized.includes(keyword)) {
            return {
                valid: false,
                error: 'Código do item contém padrões não permitidos',
            };
        }
    }
    // Bloqueia tentativas de command injection
    const dangerousPatterns = [
        '&&', '||', '|', '`', '$', '$(', '${',
    ];
    for (const pattern of dangerousPatterns) {
        if (sanitized.includes(pattern)) {
            return {
                valid: false,
                error: 'Código do item contém caracteres não permitidos',
            };
        }
    }
    // Tudo válido
    return {
        valid: true,
        data: { itemCodigo: sanitized },
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvc3JjL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzL3ZhbGlkYXRvcnMvaW5mb3JtYWNvZXNHZXJhaXMudmFsaWRhdG9ycy50cyIsIm1hcHBpbmdzIjoiO0FBQUEsb0dBQW9HOztBQXdDcEcsb0ZBdUZDO0FBM0hEOztHQUVHO0FBQ0gsU0FBUyxrQkFBa0IsQ0FBQyxLQUFhO0lBQ3ZDLDRDQUE0QztJQUM1QyxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7SUFFN0Isa0RBQWtEO0lBQ2xELFNBQVMsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLGtCQUFrQixFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRXRELHNDQUFzQztJQUN0QyxTQUFTLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDM0MsU0FBUyxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRTdDLDhGQUE4RjtJQUM5RixTQUFTLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFFaEQsdUNBQXVDO0lBQ3ZDLFNBQVMsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUU5QyxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFTLHVCQUF1QixDQUFDLEtBQWE7SUFDNUMsbUNBQW1DO0lBQ25DLHVDQUF1QztJQUN2QyxNQUFNLFlBQVksR0FBRyxnQkFBZ0IsQ0FBQztJQUN0QyxPQUFPLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDbEMsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0Isb0NBQW9DLENBQ2xELElBQVM7SUFHVCwwQ0FBMEM7SUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNyQixPQUFPO1lBQ0wsS0FBSyxFQUFFLEtBQUs7WUFDWixLQUFLLEVBQUUsOEJBQThCO1NBQ3RDLENBQUM7SUFDSixDQUFDO0lBRUQsaUJBQWlCO0lBQ2pCLElBQUksT0FBTyxJQUFJLENBQUMsVUFBVSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ3hDLE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSztZQUNaLEtBQUssRUFBRSxvQ0FBb0M7U0FDNUMsQ0FBQztJQUNKLENBQUM7SUFFRCxjQUFjO0lBQ2QsTUFBTSxTQUFTLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRXRELGdEQUFnRDtJQUNoRCxJQUFJLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDM0IsT0FBTztZQUNMLEtBQUssRUFBRSxLQUFLO1lBQ1osS0FBSyxFQUFFLG9FQUFvRTtTQUM1RSxDQUFDO0lBQ0osQ0FBQztJQUVELDJCQUEyQjtJQUMzQixJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsRUFBRSxFQUFFLENBQUM7UUFDMUIsT0FBTztZQUNMLEtBQUssRUFBRSxLQUFLO1lBQ1osS0FBSyxFQUFFLG1EQUFtRDtTQUMzRCxDQUFDO0lBQ0osQ0FBQztJQUVELDJCQUEyQjtJQUMzQixJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDekIsT0FBTztZQUNMLEtBQUssRUFBRSxLQUFLO1lBQ1osS0FBSyxFQUFFLHFDQUFxQztTQUM3QyxDQUFDO0lBQ0osQ0FBQztJQUVELDRDQUE0QztJQUM1QyxJQUFJLENBQUMsdUJBQXVCLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztRQUN4QyxPQUFPO1lBQ0wsS0FBSyxFQUFFLEtBQUs7WUFDWixLQUFLLEVBQUUsNkZBQTZGO1NBQ3JHLENBQUM7SUFDSixDQUFDO0lBRUQsd0NBQXdDO0lBRXhDLDhDQUE4QztJQUM5QyxNQUFNLFdBQVcsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDekcsTUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQy9DLEtBQUssTUFBTSxPQUFPLElBQUksV0FBVyxFQUFFLENBQUM7UUFDbEMsSUFBSSxjQUFjLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDckMsT0FBTztnQkFDTCxLQUFLLEVBQUUsS0FBSztnQkFDWixLQUFLLEVBQUUsOENBQThDO2FBQ3RELENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztJQUVELDJDQUEyQztJQUMzQyxNQUFNLGlCQUFpQixHQUFHO1FBQ3hCLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUk7S0FDdEMsQ0FBQztJQUNGLEtBQUssTUFBTSxPQUFPLElBQUksaUJBQWlCLEVBQUUsQ0FBQztRQUN4QyxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUNoQyxPQUFPO2dCQUNMLEtBQUssRUFBRSxLQUFLO2dCQUNaLEtBQUssRUFBRSxpREFBaUQ7YUFDekQsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRUQsY0FBYztJQUNkLE9BQU87UUFDTCxLQUFLLEVBQUUsSUFBSTtRQUNYLElBQUksRUFBRSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUU7S0FDaEMsQ0FBQztBQUNKLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvc3JjL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzL3ZhbGlkYXRvcnMvaW5mb3JtYWNvZXNHZXJhaXMudmFsaWRhdG9ycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvdmFsaWRhdG9ycy9pbmZvcm1hY29lc0dlcmFpcy52YWxpZGF0b3JzLnRzXHJcblxyXG5pbXBvcnQgeyBJdGVtSW5mb3JtYWNvZXNHZXJhaXNSZXF1ZXN0RFRPIH0gZnJvbSAnLi4vdHlwZXMvaW5mb3JtYWNvZXNHZXJhaXMudHlwZXMnO1xyXG5cclxuLyoqXHJcbiAqIFNhbml0aXphIG8gY8OzZGlnbyBkbyBpdGVtIHJlbW92ZW5kbyBjYXJhY3RlcmVzIHBlcmlnb3Nvc1xyXG4gKi9cclxuZnVuY3Rpb24gc2FuaXRpemVJdGVtQ29kaWdvKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIC8vIFJlbW92ZSBlc3Bhw6dvcyBlbSBicmFuY28gbmFzIGV4dHJlbWlkYWRlc1xyXG4gIGxldCBzYW5pdGl6ZWQgPSB2YWx1ZS50cmltKCk7XHJcbiAgXHJcbiAgLy8gUmVtb3ZlIGNhcmFjdGVyZXMgZGUgY29udHJvbGUgZSBuw6NvIGltcHJpbcOtdmVpc1xyXG4gIHNhbml0aXplZCA9IHNhbml0aXplZC5yZXBsYWNlKC9bXFx4MDAtXFx4MUZcXHg3Rl0vZywgJycpO1xyXG4gIFxyXG4gIC8vIFJlbW92ZSB0ZW50YXRpdmFzIGRlIHBhdGggdHJhdmVyc2FsXHJcbiAgc2FuaXRpemVkID0gc2FuaXRpemVkLnJlcGxhY2UoL1xcLlxcLi9nLCAnJyk7XHJcbiAgc2FuaXRpemVkID0gc2FuaXRpemVkLnJlcGxhY2UoL1tcXC9cXFxcXS9nLCAnJyk7XHJcbiAgXHJcbiAgLy8gUmVtb3ZlIGNhcmFjdGVyZXMgU1FMIHBlcmlnb3NvcyBhZGljaW9uYWlzIChyZWR1bmRhbnRlIGNvbSBwcmVwYXJlZCBzdGF0ZW1lbnRzLCBtYXMgc2VndXJvKVxyXG4gIHNhbml0aXplZCA9IHNhbml0aXplZC5yZXBsYWNlKC9bJztcIlxcLVxcLV0vZywgJycpO1xyXG4gIFxyXG4gIC8vIFJlbW92ZSB0YWdzIEhUTUwvWE1MIChwcmV2ZW7Dp8OjbyBYU1MpXHJcbiAgc2FuaXRpemVkID0gc2FuaXRpemVkLnJlcGxhY2UoLzxbXj5dKj4vZywgJycpO1xyXG4gIFxyXG4gIHJldHVybiBzYW5pdGl6ZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGEgZm9ybWF0byBkbyBjw7NkaWdvIGRvIGl0ZW1cclxuICovXHJcbmZ1bmN0aW9uIGlzVmFsaWRJdGVtQ29kaWdvRm9ybWF0KHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAvLyBQZXJtaXRlIGFwZW5hczogbGV0cmFzIGUgbsO6bWVyb3NcclxuICAvLyBDYXJhY3RlcmVzIHBlcm1pdGlkb3M6IEEtWiwgYS16LCAwLTlcclxuICBjb25zdCB2YWxpZFBhdHRlcm4gPSAvXltBLVphLXowLTldKyQvO1xyXG4gIHJldHVybiB2YWxpZFBhdHRlcm4udGVzdCh2YWx1ZSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGEgb3MgcGFyw6JtZXRyb3MgZGUgYnVzY2EgZGUgaW5mb3JtYcOnw7VlcyBnZXJhaXMgZG8gaXRlbVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlSXRlbUluZm9ybWFjb2VzR2VyYWlzUmVxdWVzdChcclxuICBkYXRhOiBhbnlcclxuKTogeyB2YWxpZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmc7IGRhdGE/OiBJdGVtSW5mb3JtYWNvZXNHZXJhaXNSZXF1ZXN0RFRPIH0ge1xyXG4gIFxyXG4gIC8vIDEuIFZlcmlmaWNhIHNlIGl0ZW1Db2RpZ28gZm9pIGZvcm5lY2lkb1xyXG4gIGlmICghZGF0YS5pdGVtQ29kaWdvKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnQ8OzZGlnbyBkbyBpdGVtIMOpIG9icmlnYXTDs3JpbycsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gMi4gVmFsaWRhIHRpcG9cclxuICBpZiAodHlwZW9mIGRhdGEuaXRlbUNvZGlnbyAhPT0gJ3N0cmluZycpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdDw7NkaWdvIGRvIGl0ZW0gZGV2ZSBzZXIgdW1hIHN0cmluZycsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gMy4gU2FuaXRpemFcclxuICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZUl0ZW1Db2RpZ28oZGF0YS5pdGVtQ29kaWdvKTtcclxuXHJcbiAgLy8gNC4gVmFsaWRhIHNlIG7Do28gZmljb3UgdmF6aW8gYXDDs3Mgc2FuaXRpemHDp8Ojb1xyXG4gIGlmIChzYW5pdGl6ZWQubGVuZ3RoID09PSAwKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnQ8OzZGlnbyBkbyBpdGVtIGludsOhbGlkbyBvdSBjb250w6ltIGFwZW5hcyBjYXJhY3RlcmVzIG7Do28gcGVybWl0aWRvcycsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gNS4gVmFsaWRhIHRhbWFuaG8gbcOheGltb1xyXG4gIGlmIChzYW5pdGl6ZWQubGVuZ3RoID4gMTYpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdDw7NkaWdvIGRvIGl0ZW0gbsOjbyBwb2RlIHRlciBtYWlzIGRlIDE2IGNhcmFjdGVyZXMnLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIDYuIFZhbGlkYSB0YW1hbmhvIG3DrW5pbW9cclxuICBpZiAoc2FuaXRpemVkLmxlbmd0aCA8IDEpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdDw7NkaWdvIGRvIGl0ZW0gbsOjbyBwb2RlIGVzdGFyIHZhemlvJyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyA3LiBWYWxpZGEgZm9ybWF0byAoY2FyYWN0ZXJlcyBwZXJtaXRpZG9zKVxyXG4gIGlmICghaXNWYWxpZEl0ZW1Db2RpZ29Gb3JtYXQoc2FuaXRpemVkKSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdmFsaWQ6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ0PDs2RpZ28gZG8gaXRlbSBjb250w6ltIGNhcmFjdGVyZXMgaW52w6FsaWRvcy4gVXNlIGFwZW5hcyBsZXRyYXMsIG7Dum1lcm9zIGUgY2FyYWN0ZXJlcyBiw6FzaWNvcycsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gOC4gVmFsaWRhw6fDtWVzIGFkaWNpb25haXMgZGUgc2VndXJhbsOnYVxyXG4gIFxyXG4gIC8vIEJsb3F1ZWlhIHRlbnRhdGl2YXMgw7NidmlhcyBkZSBTUUwgaW5qZWN0aW9uXHJcbiAgY29uc3Qgc3FsS2V5d29yZHMgPSBbJ1NFTEVDVCcsICdJTlNFUlQnLCAnVVBEQVRFJywgJ0RFTEVURScsICdEUk9QJywgJ0NSRUFURScsICdBTFRFUicsICdFWEVDJywgJ1VOSU9OJ107XHJcbiAgY29uc3QgdXBwZXJTYW5pdGl6ZWQgPSBzYW5pdGl6ZWQudG9VcHBlckNhc2UoKTtcclxuICBmb3IgKGNvbnN0IGtleXdvcmQgb2Ygc3FsS2V5d29yZHMpIHtcclxuICAgIGlmICh1cHBlclNhbml0aXplZC5pbmNsdWRlcyhrZXl3b3JkKSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0PDs2RpZ28gZG8gaXRlbSBjb250w6ltIHBhZHLDtWVzIG7Do28gcGVybWl0aWRvcycsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBCbG9xdWVpYSB0ZW50YXRpdmFzIGRlIGNvbW1hbmQgaW5qZWN0aW9uXHJcbiAgY29uc3QgZGFuZ2Vyb3VzUGF0dGVybnMgPSBbXHJcbiAgICAnJiYnLCAnfHwnLCAnfCcsICdgJywgJyQnLCAnJCgnLCAnJHsnLFxyXG4gIF07XHJcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGRhbmdlcm91c1BhdHRlcm5zKSB7XHJcbiAgICBpZiAoc2FuaXRpemVkLmluY2x1ZGVzKHBhdHRlcm4pKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnQ8OzZGlnbyBkbyBpdGVtIGNvbnTDqW0gY2FyYWN0ZXJlcyBuw6NvIHBlcm1pdGlkb3MnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gVHVkbyB2w6FsaWRvXHJcbiAgcmV0dXJuIHtcclxuICAgIHZhbGlkOiB0cnVlLFxyXG4gICAgZGF0YTogeyBpdGVtQ29kaWdvOiBzYW5pdGl6ZWQgfSxcclxuICB9O1xyXG59Il0sInZlcnNpb24iOjN9