6b10b02550c0931a7a1eb060d07d42f5
"use strict";
// tests/setup.integration.ts
// Setup ESPEC√çFICO para testes de integra√ß√£o com banco real
Object.defineProperty(exports, "__esModule", { value: true });
const database_helper_1 = require("./helpers/database.helper");
// ========================================
// 1. DESABILITAR MOCKS DE TESTE UNIT√ÅRIO
// ========================================
// N√ÉO mockar o logger em testes de integra√ß√£o
// (queremos ver logs reais de conex√£o)
// ========================================
// 2. CONFIGURAR TIMEOUT MAIOR
// ========================================
// Testes de integra√ß√£o podem ser mais lentos
jest.setTimeout(30000); // 30 segundos
// ========================================
// 3. INICIALIZAR BANCO ANTES DE TODOS OS TESTES
// ========================================
beforeAll(async () => {
    console.log('üîß Inicializando testes de integra√ß√£o...');
    await database_helper_1.DatabaseTestHelper.initialize();
    if (database_helper_1.DatabaseTestHelper.isUsingRealDatabase()) {
        console.log('‚úÖ Usando banco REAL - Testes de integra√ß√£o completos');
    }
    else {
        console.log('‚ö†Ô∏è  Usando MOCK - Testes de integra√ß√£o limitados');
    }
});
// ========================================
// 4. CLEANUP AP√ìS TODOS OS TESTES
// ========================================
afterAll(async () => {
    console.log('üßπ Limpando recursos de testes...');
    await database_helper_1.DatabaseTestHelper.cleanup();
    // Aguarda processos ass√≠ncronos finalizarem
    await new Promise(resolve => setTimeout(resolve, 1000));
});
// ========================================
// 5. RESET ENTRE TESTES (se necess√°rio)
// ========================================
afterEach(() => {
    // Limpar mocks se algum teste criar
    jest.clearAllMocks();
});
// ========================================
// 6. MATCHERS CUSTOMIZADOS PARA INTEGRA√á√ÉO
// ========================================
expect.extend({
    /**
     * Verifica se resposta veio do banco real
     */
    toBeRealDatabaseResponse(received) {
        // Se estamos usando mock, aceita qualquer coisa
        if (!database_helper_1.DatabaseTestHelper.isUsingRealDatabase()) {
            return {
                pass: true,
                message: () => 'Usando mock, teste pulado'
            };
        }
        // Verifica se tem estrutura de dados real
        const hasRealData = received &&
            (Array.isArray(received) || typeof received === 'object');
        return {
            pass: hasRealData,
            message: () => hasRealData
                ? 'Resposta cont√©m dados reais do banco'
                : 'Resposta n√£o parece vir do banco real'
        };
    },
    /**
     * Verifica se tempo de resposta √© aceit√°vel
     */
    toRespondWithin(received, maxMs) {
        const pass = received <= maxMs;
        return {
            pass,
            message: () => pass
                ? `Respondeu em ${received}ms (dentro de ${maxMs}ms)`
                : `Respondeu em ${received}ms (esperado max ${maxMs}ms)`
        };
    },
});
// ========================================
// 8. UTILIT√ÅRIOS GLOBAIS
// ========================================
// Disponibilizar helper globalmente
global.DatabaseTestHelper = database_helper_1.DatabaseTestHelper;
console.log('üß™ Setup de testes de integra√ß√£o carregado');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvdGVzdHMvc2V0dXAuaW50ZWdyYXRpb24udHMiLCJtYXBwaW5ncyI6IjtBQUFBLDZCQUE2QjtBQUM3Qiw0REFBNEQ7O0FBRTVELCtEQUErRDtBQUUvRCwyQ0FBMkM7QUFDM0MseUNBQXlDO0FBQ3pDLDJDQUEyQztBQUMzQyw4Q0FBOEM7QUFDOUMsdUNBQXVDO0FBRXZDLDJDQUEyQztBQUMzQyw4QkFBOEI7QUFDOUIsMkNBQTJDO0FBQzNDLDZDQUE2QztBQUM3QyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsY0FBYztBQUV0QywyQ0FBMkM7QUFDM0MsZ0RBQWdEO0FBQ2hELDJDQUEyQztBQUMzQyxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO0lBRXhELE1BQU0sb0NBQWtCLENBQUMsVUFBVSxFQUFFLENBQUM7SUFFdEMsSUFBSSxvQ0FBa0IsQ0FBQyxtQkFBbUIsRUFBRSxFQUFFLENBQUM7UUFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7U0FBTSxDQUFDO1FBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILDJDQUEyQztBQUMzQyxrQ0FBa0M7QUFDbEMsMkNBQTJDO0FBQzNDLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtJQUNsQixPQUFPLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7SUFDakQsTUFBTSxvQ0FBa0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUVuQyw0Q0FBNEM7SUFDNUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUMxRCxDQUFDLENBQUMsQ0FBQztBQUVILDJDQUEyQztBQUMzQyx3Q0FBd0M7QUFDeEMsMkNBQTJDO0FBQzNDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7SUFDYixvQ0FBb0M7SUFDcEMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0FBRUgsMkNBQTJDO0FBQzNDLDJDQUEyQztBQUMzQywyQ0FBMkM7QUFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNaOztPQUVHO0lBQ0gsd0JBQXdCLENBQUMsUUFBYTtRQUNwQyxnREFBZ0Q7UUFDaEQsSUFBSSxDQUFDLG9DQUFrQixDQUFDLG1CQUFtQixFQUFFLEVBQUUsQ0FBQztZQUM5QyxPQUFPO2dCQUNMLElBQUksRUFBRSxJQUFJO2dCQUNWLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQywyQkFBMkI7YUFDM0MsQ0FBQztRQUNKLENBQUM7UUFFRCwwQ0FBMEM7UUFDMUMsTUFBTSxXQUFXLEdBQUcsUUFBUTtZQUMxQixDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksT0FBTyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUM7UUFFNUQsT0FBTztZQUNMLElBQUksRUFBRSxXQUFXO1lBQ2pCLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxXQUFXO2dCQUN4QixDQUFDLENBQUMsc0NBQXNDO2dCQUN4QyxDQUFDLENBQUMsdUNBQXVDO1NBQzVDLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCxlQUFlLENBQUMsUUFBZ0IsRUFBRSxLQUFhO1FBQzdDLE1BQU0sSUFBSSxHQUFHLFFBQVEsSUFBSSxLQUFLLENBQUM7UUFFL0IsT0FBTztZQUNMLElBQUk7WUFDSixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSTtnQkFDakIsQ0FBQyxDQUFDLGdCQUFnQixRQUFRLGlCQUFpQixLQUFLLEtBQUs7Z0JBQ3JELENBQUMsQ0FBQyxnQkFBZ0IsUUFBUSxvQkFBb0IsS0FBSyxLQUFLO1NBQzNELENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFDO0FBY0gsMkNBQTJDO0FBQzNDLHlCQUF5QjtBQUN6QiwyQ0FBMkM7QUFDM0Msb0NBQW9DO0FBQ25DLE1BQWMsQ0FBQyxrQkFBa0IsR0FBRyxvQ0FBa0IsQ0FBQztBQUV4RCxPQUFPLENBQUMsR0FBRyxDQUFDLDRDQUE0QyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvdGVzdHMvc2V0dXAuaW50ZWdyYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gdGVzdHMvc2V0dXAuaW50ZWdyYXRpb24udHNcbi8vIFNldHVwIEVTUEVDw41GSUNPIHBhcmEgdGVzdGVzIGRlIGludGVncmHDp8OjbyBjb20gYmFuY28gcmVhbFxuXG5pbXBvcnQgeyBEYXRhYmFzZVRlc3RIZWxwZXIgfSBmcm9tICcuL2hlbHBlcnMvZGF0YWJhc2UuaGVscGVyJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMS4gREVTQUJJTElUQVIgTU9DS1MgREUgVEVTVEUgVU5JVMOBUklPXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBOw4NPIG1vY2thciBvIGxvZ2dlciBlbSB0ZXN0ZXMgZGUgaW50ZWdyYcOnw6NvXG4vLyAocXVlcmVtb3MgdmVyIGxvZ3MgcmVhaXMgZGUgY29uZXjDo28pXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDIuIENPTkZJR1VSQVIgVElNRU9VVCBNQUlPUlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVGVzdGVzIGRlIGludGVncmHDp8OjbyBwb2RlbSBzZXIgbWFpcyBsZW50b3Ncbmplc3Quc2V0VGltZW91dCgzMDAwMCk7IC8vIDMwIHNlZ3VuZG9zXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDMuIElOSUNJQUxJWkFSIEJBTkNPIEFOVEVTIERFIFRPRE9TIE9TIFRFU1RFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgY29uc29sZS5sb2coJ/CflKcgSW5pY2lhbGl6YW5kbyB0ZXN0ZXMgZGUgaW50ZWdyYcOnw6NvLi4uJyk7XG4gIFxuICBhd2FpdCBEYXRhYmFzZVRlc3RIZWxwZXIuaW5pdGlhbGl6ZSgpO1xuICBcbiAgaWYgKERhdGFiYXNlVGVzdEhlbHBlci5pc1VzaW5nUmVhbERhdGFiYXNlKCkpIHtcbiAgICBjb25zb2xlLmxvZygn4pyFIFVzYW5kbyBiYW5jbyBSRUFMIC0gVGVzdGVzIGRlIGludGVncmHDp8OjbyBjb21wbGV0b3MnKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZygn4pqg77iPICBVc2FuZG8gTU9DSyAtIFRlc3RlcyBkZSBpbnRlZ3Jhw6fDo28gbGltaXRhZG9zJyk7XG4gIH1cbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA0LiBDTEVBTlVQIEFQw5NTIFRPRE9TIE9TIFRFU1RFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICBjb25zb2xlLmxvZygn8J+nuSBMaW1wYW5kbyByZWN1cnNvcyBkZSB0ZXN0ZXMuLi4nKTtcbiAgYXdhaXQgRGF0YWJhc2VUZXN0SGVscGVyLmNsZWFudXAoKTtcbiAgXG4gIC8vIEFndWFyZGEgcHJvY2Vzc29zIGFzc8OtbmNyb25vcyBmaW5hbGl6YXJlbVxuICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpO1xufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIDUuIFJFU0VUIEVOVFJFIFRFU1RFUyAoc2UgbmVjZXNzw6FyaW8pXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5hZnRlckVhY2goKCkgPT4ge1xuICAvLyBMaW1wYXIgbW9ja3Mgc2UgYWxndW0gdGVzdGUgY3JpYXJcbiAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG59KTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gNi4gTUFUQ0hFUlMgQ1VTVE9NSVpBRE9TIFBBUkEgSU5URUdSQcOHw4NPXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5leHBlY3QuZXh0ZW5kKHtcbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIHJlc3Bvc3RhIHZlaW8gZG8gYmFuY28gcmVhbFxuICAgKi9cbiAgdG9CZVJlYWxEYXRhYmFzZVJlc3BvbnNlKHJlY2VpdmVkOiBhbnkpIHtcbiAgICAvLyBTZSBlc3RhbW9zIHVzYW5kbyBtb2NrLCBhY2VpdGEgcXVhbHF1ZXIgY29pc2FcbiAgICBpZiAoIURhdGFiYXNlVGVzdEhlbHBlci5pc1VzaW5nUmVhbERhdGFiYXNlKCkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICgpID0+ICdVc2FuZG8gbW9jaywgdGVzdGUgcHVsYWRvJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYSBzZSB0ZW0gZXN0cnV0dXJhIGRlIGRhZG9zIHJlYWxcbiAgICBjb25zdCBoYXNSZWFsRGF0YSA9IHJlY2VpdmVkICYmIFxuICAgICAgKEFycmF5LmlzQXJyYXkocmVjZWl2ZWQpIHx8IHR5cGVvZiByZWNlaXZlZCA9PT0gJ29iamVjdCcpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHBhc3M6IGhhc1JlYWxEYXRhLFxuICAgICAgbWVzc2FnZTogKCkgPT4gaGFzUmVhbERhdGFcbiAgICAgICAgPyAnUmVzcG9zdGEgY29udMOpbSBkYWRvcyByZWFpcyBkbyBiYW5jbydcbiAgICAgICAgOiAnUmVzcG9zdGEgbsOjbyBwYXJlY2UgdmlyIGRvIGJhbmNvIHJlYWwnXG4gICAgfTtcbiAgfSxcblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgdGVtcG8gZGUgcmVzcG9zdGEgw6kgYWNlaXTDoXZlbFxuICAgKi9cbiAgdG9SZXNwb25kV2l0aGluKHJlY2VpdmVkOiBudW1iZXIsIG1heE1zOiBudW1iZXIpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgPD0gbWF4TXM7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHBhc3MsXG4gICAgICBtZXNzYWdlOiAoKSA9PiBwYXNzXG4gICAgICAgID8gYFJlc3BvbmRldSBlbSAke3JlY2VpdmVkfW1zIChkZW50cm8gZGUgJHttYXhNc31tcylgXG4gICAgICAgIDogYFJlc3BvbmRldSBlbSAke3JlY2VpdmVkfW1zIChlc3BlcmFkbyBtYXggJHttYXhNc31tcylgXG4gICAgfTtcbiAgfSxcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA3LiBERUNMQVJBw4fDg08gREUgVElQT1Ncbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIGplc3Qge1xuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XG4gICAgICB0b0JlUmVhbERhdGFiYXNlUmVzcG9uc2UoKTogUjtcbiAgICAgIHRvUmVzcG9uZFdpdGhpbihtYXhNczogbnVtYmVyKTogUjtcbiAgICB9XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gOC4gVVRJTElUw4FSSU9TIEdMT0JBSVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERpc3BvbmliaWxpemFyIGhlbHBlciBnbG9iYWxtZW50ZVxuKGdsb2JhbCBhcyBhbnkpLkRhdGFiYXNlVGVzdEhlbHBlciA9IERhdGFiYXNlVGVzdEhlbHBlcjtcblxuY29uc29sZS5sb2coJ/Cfp6ogU2V0dXAgZGUgdGVzdGVzIGRlIGludGVncmHDp8OjbyBjYXJyZWdhZG8nKTtcblxuZXhwb3J0IHt9OyJdLCJ2ZXJzaW9uIjozfQ==