0a60c2f5b3cf3a1f7b204e06dca77cb8
"use strict";
// tests/e2e/api/informacoesGerais.e2e.test.ts
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock do DatabaseManager para E2E
jest.mock('@infrastructure/database/DatabaseManager');
const supertest_1 = __importDefault(require("supertest"));
const app_1 = __importDefault(require("../../../src/app")); // Express app
const DatabaseManager_1 = require("@infrastructure/database/DatabaseManager");
const item_factory_1 = require("../../factories/item.factory");
describe('E2E - API InformacoesGerais', () => {
    beforeAll(async () => {
        // Inicializar DatabaseManager se necessário
        DatabaseManager_1.DatabaseManager.initialize.mockResolvedValue(undefined);
        DatabaseManager_1.DatabaseManager.isReady.mockReturnValue(true);
        // Mock para health check
        DatabaseManager_1.DatabaseManager.getConnection.mockReturnValue({
            query: jest.fn().mockResolvedValue([{ test: 1 }])
        });
        DatabaseManager_1.DatabaseManager.getConnectionStatus.mockReturnValue({
            type: 'sqlserver',
            mode: 'REAL_DATABASE',
            error: undefined
        });
    });
    afterAll(async () => {
        // Cleanup
        await DatabaseManager_1.DatabaseManager.close();
    });
    beforeEach(() => {
        jest.clearAllMocks();
        // Re-aplicar mocks que são usados em todos os testes
        DatabaseManager_1.DatabaseManager.getConnection.mockReturnValue({
            query: jest.fn().mockResolvedValue([{ test: 1 }])
        });
    });
    // ========================================
    // CASOS DE SUCESSO
    // ========================================
    describe('GET /api/lor0138/item/dadosCadastrais/informacoesGerais/:itemCodigo', () => {
        it('deve retornar 200 com dados do item', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            // Mock do DatabaseManager retornando dados
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'VALVULA DE ESFERA 1/2" BRONZE',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .expect(200);
            expect(response.body).toHaveProperty('success', true);
            expect(response.body).toHaveProperty('data');
        });
        it('deve retornar headers corretos', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110');
            expect(response.headers['content-type']).toMatch(/application\/json/);
            expect(response.headers['x-correlation-id']).toBeDefined();
        });
        it('deve aceitar Correlation ID customizado', async () => {
            const customCorrelationId = 'test-correlation-123';
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .set('X-Correlation-ID', customCorrelationId);
            expect(response.headers['x-correlation-id']).toBe(customCorrelationId);
        });
    });
    // ========================================
    // VALIDAÇÃO DE ENTRADA
    // ========================================
    describe('Validação de Parâmetros', () => {
        it('deve retornar 400 para itemCodigo inválido (muito longo)', async () => {
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/12345678901234567')
                .expect(400);
            expect(response.body).toHaveProperty('error');
            expect(response.body.error).toMatch(/ValidationError/);
        });
        it('deve retornar 400 para itemCodigo vazio', async () => {
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/ ')
                .expect(404); // Express trata ' ' como rota não encontrada
            expect(response.body).toHaveProperty('error');
        });
    });
    // ========================================
    // ITEM NÃO ENCONTRADO
    // ========================================
    describe('Item Não Encontrado', () => {
        it('deve retornar 404 quando item não existe', async () => {
            // Mock retornando vazio
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/INEXISTENTE')
                .expect(404);
            expect(response.body).toHaveProperty('error');
            expect(response.body.message).toMatch(/não encontrado/i);
        });
        it('deve incluir Correlation ID no erro 404', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/INEXISTENTE');
            expect(response.headers['x-correlation-id']).toBeDefined();
        });
    });
    // ========================================
    // ERROS DO SERVIDOR
    // ========================================
    describe('Erros do Servidor', () => {
        it('deve retornar 500 em caso de erro no banco', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockRejectedValue(new Error('Conexão perdida'));
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .expect(500);
            expect(response.body).toHaveProperty('error');
        });
    });
    // ========================================
    // MIDDLEWARES
    // ========================================
    describe('Middlewares', () => {
        it('deve aplicar CORS headers', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .set('Origin', 'http://localhost:3000');
            expect(response.headers['access-control-allow-origin']).toBeDefined();
        });
        it('deve comprimir resposta (gzip)', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .set('Accept-Encoding', 'gzip');
            // Compression middleware pode adicionar vary header
            expect(response.headers).toBeDefined();
        });
    });
    // ========================================
    // CACHE (se implementado)
    // ========================================
    describe('Cache HTTP', () => {
        it('deve retornar Cache-Control header', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110');
            // Se cache middleware estiver ativo
            if (response.headers['cache-control']) {
                expect(response.headers['cache-control']).toBeDefined();
            }
        });
    });
    // ========================================
    // AUTENTICAÇÃO (API Key opcional)
    // ========================================
    describe('API Key (Opcional)', () => {
        it('deve aceitar requisição sem API Key', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .expect(200);
            expect(response.body.success).toBe(true);
        });
        it('deve aceitar API Key válida se fornecida', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .set('X-API-Key', 'free-demo-key-123456')
                .expect(200);
            expect(response.body.success).toBe(true);
        });
    });
    // ========================================
    // PERFORMANCE
    // ========================================
    describe('Performance', () => {
        it('deve responder em menos de 1 segundo', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: '7530110',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const start = Date.now();
            await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/7530110')
                .expect(200);
            const duration = Date.now() - start;
            expect(duration).toBeLessThan(1000);
        });
    });
    // ========================================
    // EDGE CASES
    // ========================================
    describe('Edge Cases', () => {
        it('deve aceitar código alfanumérico', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: 'ABC123',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/ABC123')
                .expect(200);
            expect(response.body.success).toBe(true);
        });
        it('deve aceitar código de 1 caractere', async () => {
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: 'A',
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/api/lor0138/item/dadosCadastrais/informacoesGerais/A')
                .expect(200);
            expect(response.body.success).toBe(true);
        });
        it('deve aceitar código de 16 caracteres (máximo)', async () => {
            const codigo16 = '1234567890123456';
            DatabaseManager_1.DatabaseManager.queryEmpWithParams.mockResolvedValue([{
                    itemCodigo: codigo16,
                    itemDescricao: 'Test',
                    itemUnidade: 'UN'
                }]);
            const response = await (0, supertest_1.default)(app_1.default)
                .get(`/api/lor0138/item/dadosCadastrais/informacoesGerais/${codigo16}`)
                .expect(200);
            expect(response.body.success).toBe(true);
        });
    });
    // ========================================
    // ROTAS ESPECIAIS
    // ========================================
    describe('Rotas do Sistema', () => {
        it('GET / - deve retornar informações da API', async () => {
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/')
                .expect(200);
            expect(response.body).toHaveProperty('message');
            expect(response.body).toHaveProperty('version');
            expect(response.body).toHaveProperty('documentation');
        });
        it('GET /health - deve retornar status de saúde', async () => {
            // Garantir que o mock está configurado
            DatabaseManager_1.DatabaseManager.getConnection.mockReturnValue({
                query: jest.fn().mockResolvedValue([{ test: 1 }])
            });
            DatabaseManager_1.DatabaseManager.getConnectionStatus.mockReturnValue({
                type: 'sqlserver',
                mode: 'REAL_DATABASE',
                error: undefined
            });
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/health');
            // Health check pode retornar 200 (healthy) ou 503 (unhealthy)
            // Verifica que retornou uma resposta válida
            expect([200, 503]).toContain(response.status);
            expect(response.body).toHaveProperty('status');
            expect(response.body).toHaveProperty('database');
        });
        it('GET /metrics - deve retornar métricas Prometheus', async () => {
            const response = await (0, supertest_1.default)(app_1.default)
                .get('/metrics');
            // Métricas retornam texto, não JSON
            expect(response.text).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvdGVzdHMvZTJlL2FwaS9pbmZvcm1hY29lc0dlcmFpcy5lMmUudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUEsOENBQThDOzs7OztBQU85QyxtQ0FBbUM7QUFDbkMsSUFBSSxDQUFDLElBQUksQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO0FBTnRELDBEQUFnQztBQUNoQywyREFBbUMsQ0FBQyxjQUFjO0FBQ2xELDhFQUEyRTtBQUMzRSwrREFBdUU7QUFLdkUsUUFBUSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtJQUUzQyxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsNENBQTRDO1FBQzNDLGlDQUFlLENBQUMsVUFBd0IsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN0RSxpQ0FBZSxDQUFDLE9BQXFCLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTdELHlCQUF5QjtRQUN4QixpQ0FBZSxDQUFDLGFBQTJCLENBQUMsZUFBZSxDQUFDO1lBQzNELEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2xELENBQUMsQ0FBQztRQUVGLGlDQUFlLENBQUMsbUJBQWlDLENBQUMsZUFBZSxDQUFDO1lBQ2pFLElBQUksRUFBRSxXQUFXO1lBQ2pCLElBQUksRUFBRSxlQUFlO1lBQ3JCLEtBQUssRUFBRSxTQUFTO1NBQ2pCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2xCLFVBQVU7UUFDVixNQUFNLGlDQUFlLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLHFEQUFxRDtRQUNwRCxpQ0FB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bmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL21hbm8vcHJvamV0b3MvZGF0YXN1bC9sb3IwMTM4L3Rlc3RzL2UyZS9hcGkvaW5mb3JtYWNvZXNHZXJhaXMuZTJlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gdGVzdHMvZTJlL2FwaS9pbmZvcm1hY29lc0dlcmFpcy5lMmUudGVzdC50c1xuXG5pbXBvcnQgcmVxdWVzdCBmcm9tICdzdXBlcnRlc3QnO1xuaW1wb3J0IGFwcCBmcm9tICcuLi8uLi8uLi9zcmMvYXBwJzsgLy8gRXhwcmVzcyBhcHBcbmltcG9ydCB7IERhdGFiYXNlTWFuYWdlciB9IGZyb20gJ0BpbmZyYXN0cnVjdHVyZS9kYXRhYmFzZS9EYXRhYmFzZU1hbmFnZXInO1xuaW1wb3J0IHsgY3JlYXRlSW5mb3JtYWNvZXNHZXJhaXMgfSBmcm9tICcuLi8uLi9mYWN0b3JpZXMvaXRlbS5mYWN0b3J5JztcblxuLy8gTW9jayBkbyBEYXRhYmFzZU1hbmFnZXIgcGFyYSBFMkVcbmplc3QubW9jaygnQGluZnJhc3RydWN0dXJlL2RhdGFiYXNlL0RhdGFiYXNlTWFuYWdlcicpO1xuXG5kZXNjcmliZSgnRTJFIC0gQVBJIEluZm9ybWFjb2VzR2VyYWlzJywgKCkgPT4ge1xuICBcbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBJbmljaWFsaXphciBEYXRhYmFzZU1hbmFnZXIgc2UgbmVjZXNzw6FyaW9cbiAgICAoRGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgIChEYXRhYmFzZU1hbmFnZXIuaXNSZWFkeSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICBcbiAgICAvLyBNb2NrIHBhcmEgaGVhbHRoIGNoZWNrXG4gICAgKERhdGFiYXNlTWFuYWdlci5nZXRDb25uZWN0aW9uIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIHF1ZXJ5OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW3sgdGVzdDogMSB9XSlcbiAgICB9KTtcbiAgICBcbiAgICAoRGF0YWJhc2VNYW5hZ2VyLmdldENvbm5lY3Rpb25TdGF0dXMgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgdHlwZTogJ3NxbHNlcnZlcicsXG4gICAgICBtb2RlOiAnUkVBTF9EQVRBQkFTRScsXG4gICAgICBlcnJvcjogdW5kZWZpbmVkXG4gICAgfSk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbnVwXG4gICAgYXdhaXQgRGF0YWJhc2VNYW5hZ2VyLmNsb3NlKCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIFJlLWFwbGljYXIgbW9ja3MgcXVlIHPDo28gdXNhZG9zIGVtIHRvZG9zIG9zIHRlc3Rlc1xuICAgIChEYXRhYmFzZU1hbmFnZXIuZ2V0Q29ubmVjdGlvbiBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBxdWVyeTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFt7IHRlc3Q6IDEgfV0pXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQ0FTT1MgREUgU1VDRVNTT1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdHRVQgL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzLzppdGVtQ29kaWdvJywgKCkgPT4ge1xuICAgIFxuICAgIGl0KCdkZXZlIHJldG9ybmFyIDIwMCBjb20gZGFkb3MgZG8gaXRlbScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tEYXRhID0gY3JlYXRlSW5mb3JtYWNvZXNHZXJhaXMoKTtcbiAgICAgIFxuICAgICAgLy8gTW9jayBkbyBEYXRhYmFzZU1hbmFnZXIgcmV0b3JuYW5kbyBkYWRvc1xuICAgICAgKERhdGFiYXNlTWFuYWdlci5xdWVyeUVtcFdpdGhQYXJhbXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbe1xuICAgICAgICBpdGVtQ29kaWdvOiAnNzUzMDExMCcsXG4gICAgICAgIGl0ZW1EZXNjcmljYW86ICdWQUxWVUxBIERFIEVTRkVSQSAxLzJcIiBCUk9OWkUnLFxuICAgICAgICBpdGVtVW5pZGFkZTogJ1VOJ1xuICAgICAgfV0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvNzUzMDExMCcpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdzdWNjZXNzJywgdHJ1ZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2RhdGEnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIGhlYWRlcnMgY29ycmV0b3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAoRGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5RW1wV2l0aFBhcmFtcyBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFt7XG4gICAgICAgIGl0ZW1Db2RpZ286ICc3NTMwMTEwJyxcbiAgICAgICAgaXRlbURlc2NyaWNhbzogJ1Rlc3QnLFxuICAgICAgICBpdGVtVW5pZGFkZTogJ1VOJ1xuICAgICAgfV0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvNzUzMDExMCcpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVyc1snY29udGVudC10eXBlJ10pLnRvTWF0Y2goL2FwcGxpY2F0aW9uXFwvanNvbi8pO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnNbJ3gtY29ycmVsYXRpb24taWQnXSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGFjZWl0YXIgQ29ycmVsYXRpb24gSUQgY3VzdG9taXphZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21Db3JyZWxhdGlvbklkID0gJ3Rlc3QtY29ycmVsYXRpb24tMTIzJztcbiAgICAgIFxuICAgICAgKERhdGFiYXNlTWFuYWdlci5xdWVyeUVtcFdpdGhQYXJhbXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbe1xuICAgICAgICBpdGVtQ29kaWdvOiAnNzUzMDExMCcsXG4gICAgICAgIGl0ZW1EZXNjcmljYW86ICdUZXN0JyxcbiAgICAgICAgaXRlbVVuaWRhZGU6ICdVTidcbiAgICAgIH1dKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzLzc1MzAxMTAnKVxuICAgICAgICAuc2V0KCdYLUNvcnJlbGF0aW9uLUlEJywgY3VzdG9tQ29ycmVsYXRpb25JZCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzWyd4LWNvcnJlbGF0aW9uLWlkJ10pLnRvQmUoY3VzdG9tQ29ycmVsYXRpb25JZCk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBWQUxJREHDh8ODTyBERSBFTlRSQURBXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgZGVzY3JpYmUoJ1ZhbGlkYcOnw6NvIGRlIFBhcsOibWV0cm9zJywgKCkgPT4ge1xuICAgIFxuICAgIGl0KCdkZXZlIHJldG9ybmFyIDQwMCBwYXJhIGl0ZW1Db2RpZ28gaW52w6FsaWRvIChtdWl0byBsb25nbyknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvMTIzNDU2Nzg5MDEyMzQ1NjcnKVxuICAgICAgICAuZXhwZWN0KDQwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnZXJyb3InKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b01hdGNoKC9WYWxpZGF0aW9uRXJyb3IvKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIDQwMCBwYXJhIGl0ZW1Db2RpZ28gdmF6aW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvICcpXG4gICAgICAgIC5leHBlY3QoNDA0KTsgLy8gRXhwcmVzcyB0cmF0YSAnICcgY29tbyByb3RhIG7Do28gZW5jb250cmFkYVxuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2Vycm9yJyk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBJVEVNIE7Dg08gRU5DT05UUkFET1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdJdGVtIE7Do28gRW5jb250cmFkbycsICgpID0+IHtcbiAgICBcbiAgICBpdCgnZGV2ZSByZXRvcm5hciA0MDQgcXVhbmRvIGl0ZW0gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHJldG9ybmFuZG8gdmF6aW9cbiAgICAgIChEYXRhYmFzZU1hbmFnZXIucXVlcnlFbXBXaXRoUGFyYW1zIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvSU5FWElTVEVOVEUnKVxuICAgICAgICAuZXhwZWN0KDQwNCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnZXJyb3InKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvTWF0Y2goL27Do28gZW5jb250cmFkby9pKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGluY2x1aXIgQ29ycmVsYXRpb24gSUQgbm8gZXJybyA0MDQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAoRGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5RW1wV2l0aFBhcmFtcyBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzL0lORVhJU1RFTlRFJyk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzWyd4LWNvcnJlbGF0aW9uLWlkJ10pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBFUlJPUyBETyBTRVJWSURPUlxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdFcnJvcyBkbyBTZXJ2aWRvcicsICgpID0+IHtcbiAgICBcbiAgICBpdCgnZGV2ZSByZXRvcm5hciA1MDAgZW0gY2FzbyBkZSBlcnJvIG5vIGJhbmNvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKERhdGFiYXNlTWFuYWdlci5xdWVyeUVtcFdpdGhQYXJhbXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdDb25leMOjbyBwZXJkaWRhJylcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy83NTMwMTEwJylcbiAgICAgICAgLmV4cGVjdCg1MDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2Vycm9yJyk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBNSURETEVXQVJFU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdNaWRkbGV3YXJlcycsICgpID0+IHtcbiAgICBcbiAgICBpdCgnZGV2ZSBhcGxpY2FyIENPUlMgaGVhZGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIChEYXRhYmFzZU1hbmFnZXIucXVlcnlFbXBXaXRoUGFyYW1zIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW3tcbiAgICAgICAgaXRlbUNvZGlnbzogJzc1MzAxMTAnLFxuICAgICAgICBpdGVtRGVzY3JpY2FvOiAnVGVzdCcsXG4gICAgICAgIGl0ZW1VbmlkYWRlOiAnVU4nXG4gICAgICB9XSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy83NTMwMTEwJylcbiAgICAgICAgLnNldCgnT3JpZ2luJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVyc1snYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luJ10pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBjb21wcmltaXIgcmVzcG9zdGEgKGd6aXApJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKERhdGFiYXNlTWFuYWdlci5xdWVyeUVtcFdpdGhQYXJhbXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbe1xuICAgICAgICBpdGVtQ29kaWdvOiAnNzUzMDExMCcsXG4gICAgICAgIGl0ZW1EZXNjcmljYW86ICdUZXN0JyxcbiAgICAgICAgaXRlbVVuaWRhZGU6ICdVTidcbiAgICAgIH1dKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzLzc1MzAxMTAnKVxuICAgICAgICAuc2V0KCdBY2NlcHQtRW5jb2RpbmcnLCAnZ3ppcCcpO1xuXG4gICAgICAvLyBDb21wcmVzc2lvbiBtaWRkbGV3YXJlIHBvZGUgYWRpY2lvbmFyIHZhcnkgaGVhZGVyXG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVycykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENBQ0hFIChzZSBpbXBsZW1lbnRhZG8pXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgZGVzY3JpYmUoJ0NhY2hlIEhUVFAnLCAoKSA9PiB7XG4gICAgXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgQ2FjaGUtQ29udHJvbCBoZWFkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAoRGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5RW1wV2l0aFBhcmFtcyBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFt7XG4gICAgICAgIGl0ZW1Db2RpZ286ICc3NTMwMTEwJyxcbiAgICAgICAgaXRlbURlc2NyaWNhbzogJ1Rlc3QnLFxuICAgICAgICBpdGVtVW5pZGFkZTogJ1VOJ1xuICAgICAgfV0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvNzUzMDExMCcpO1xuXG4gICAgICAvLyBTZSBjYWNoZSBtaWRkbGV3YXJlIGVzdGl2ZXIgYXRpdm9cbiAgICAgIGlmIChyZXNwb25zZS5oZWFkZXJzWydjYWNoZS1jb250cm9sJ10pIHtcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnNbJ2NhY2hlLWNvbnRyb2wnXSkudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIEFVVEVOVElDQcOHw4NPIChBUEkgS2V5IG9wY2lvbmFsKVxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdBUEkgS2V5IChPcGNpb25hbCknLCAoKSA9PiB7XG4gICAgXG4gICAgaXQoJ2RldmUgYWNlaXRhciByZXF1aXNpw6fDo28gc2VtIEFQSSBLZXknLCBhc3luYyAoKSA9PiB7XG4gICAgICAoRGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5RW1wV2l0aFBhcmFtcyBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFt7XG4gICAgICAgIGl0ZW1Db2RpZ286ICc3NTMwMTEwJyxcbiAgICAgICAgaXRlbURlc2NyaWNhbzogJ1Rlc3QnLFxuICAgICAgICBpdGVtVW5pZGFkZTogJ1VOJ1xuICAgICAgfV0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvNzUzMDExMCcpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGFjZWl0YXIgQVBJIEtleSB2w6FsaWRhIHNlIGZvcm5lY2lkYScsIGFzeW5jICgpID0+IHtcbiAgICAgIChEYXRhYmFzZU1hbmFnZXIucXVlcnlFbXBXaXRoUGFyYW1zIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW3tcbiAgICAgICAgaXRlbUNvZGlnbzogJzc1MzAxMTAnLFxuICAgICAgICBpdGVtRGVzY3JpY2FvOiAnVGVzdCcsXG4gICAgICAgIGl0ZW1VbmlkYWRlOiAnVU4nXG4gICAgICB9XSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy83NTMwMTEwJylcbiAgICAgICAgLnNldCgnWC1BUEktS2V5JywgJ2ZyZWUtZGVtby1rZXktMTIzNDU2JylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gUEVSRk9STUFOQ0VcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UnLCAoKSA9PiB7XG4gICAgXG4gICAgaXQoJ2RldmUgcmVzcG9uZGVyIGVtIG1lbm9zIGRlIDEgc2VndW5kbycsIGFzeW5jICgpID0+IHtcbiAgICAgIChEYXRhYmFzZU1hbmFnZXIucXVlcnlFbXBXaXRoUGFyYW1zIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW3tcbiAgICAgICAgaXRlbUNvZGlnbzogJzc1MzAxMTAnLFxuICAgICAgICBpdGVtRGVzY3JpY2FvOiAnVGVzdCcsXG4gICAgICAgIGl0ZW1VbmlkYWRlOiAnVU4nXG4gICAgICB9XSk7XG5cbiAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy83NTMwMTEwJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydDtcbiAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDEwMDApO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gRURHRSBDQVNFU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIFxuICAgIGl0KCdkZXZlIGFjZWl0YXIgY8OzZGlnbyBhbGZhbnVtw6lyaWNvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKERhdGFiYXNlTWFuYWdlci5xdWVyeUVtcFdpdGhQYXJhbXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbe1xuICAgICAgICBpdGVtQ29kaWdvOiAnQUJDMTIzJyxcbiAgICAgICAgaXRlbURlc2NyaWNhbzogJ1Rlc3QnLFxuICAgICAgICBpdGVtVW5pZGFkZTogJ1VOJ1xuICAgICAgfV0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvQUJDMTIzJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYWNlaXRhciBjw7NkaWdvIGRlIDEgY2FyYWN0ZXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKERhdGFiYXNlTWFuYWdlci5xdWVyeUVtcFdpdGhQYXJhbXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbe1xuICAgICAgICBpdGVtQ29kaWdvOiAnQScsXG4gICAgICAgIGl0ZW1EZXNjcmljYW86ICdUZXN0JyxcbiAgICAgICAgaXRlbVVuaWRhZGU6ICdVTidcbiAgICAgIH1dKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzL0EnKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBhY2VpdGFyIGPDs2RpZ28gZGUgMTYgY2FyYWN0ZXJlcyAobcOheGltbyknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb2RpZ28xNiA9ICcxMjM0NTY3ODkwMTIzNDU2JztcbiAgICAgIFxuICAgICAgKERhdGFiYXNlTWFuYWdlci5xdWVyeUVtcFdpdGhQYXJhbXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbe1xuICAgICAgICBpdGVtQ29kaWdvOiBjb2RpZ28xNixcbiAgICAgICAgaXRlbURlc2NyaWNhbzogJ1Rlc3QnLFxuICAgICAgICBpdGVtVW5pZGFkZTogJ1VOJ1xuICAgICAgfV0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KGAvYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvJHtjb2RpZ28xNn1gKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBST1RBUyBFU1BFQ0lBSVNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBkZXNjcmliZSgnUm90YXMgZG8gU2lzdGVtYScsICgpID0+IHtcbiAgICBcbiAgICBpdCgnR0VUIC8gLSBkZXZlIHJldG9ybmFyIGluZm9ybWHDp8O1ZXMgZGEgQVBJJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnLycpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3ZlcnNpb24nKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnZG9jdW1lbnRhdGlvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ0dFVCAvaGVhbHRoIC0gZGV2ZSByZXRvcm5hciBzdGF0dXMgZGUgc2HDumRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR2FyYW50aXIgcXVlIG8gbW9jayBlc3TDoSBjb25maWd1cmFkb1xuICAgICAgKERhdGFiYXNlTWFuYWdlci5nZXRDb25uZWN0aW9uIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgcXVlcnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbeyB0ZXN0OiAxIH1dKVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIChEYXRhYmFzZU1hbmFnZXIuZ2V0Q29ubmVjdGlvblN0YXR1cyBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHR5cGU6ICdzcWxzZXJ2ZXInLFxuICAgICAgICBtb2RlOiAnUkVBTF9EQVRBQkFTRScsXG4gICAgICAgIGVycm9yOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvaGVhbHRoJyk7XG5cbiAgICAgIC8vIEhlYWx0aCBjaGVjayBwb2RlIHJldG9ybmFyIDIwMCAoaGVhbHRoeSkgb3UgNTAzICh1bmhlYWx0aHkpXG4gICAgICAvLyBWZXJpZmljYSBxdWUgcmV0b3Jub3UgdW1hIHJlc3Bvc3RhIHbDoWxpZGFcbiAgICAgIGV4cGVjdChbMjAwLCA1MDNdKS50b0NvbnRhaW4ocmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2RhdGFiYXNlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnR0VUIC9tZXRyaWNzIC0gZGV2ZSByZXRvcm5hciBtw6l0cmljYXMgUHJvbWV0aGV1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9tZXRyaWNzJyk7XG5cbiAgICAgIC8vIE3DqXRyaWNhcyByZXRvcm5hbSB0ZXh0bywgbsOjbyBKU09OXG4gICAgICBleHBlY3QocmVzcG9uc2UudGV4dCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICB9KTtcblxufSk7Il0sInZlcnNpb24iOjN9