76b341a876f6316854529761bc96489b
"use strict";
// tests/unit/controllers/informacoesGerais.controller.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
// Mock do Service
jest.mock('@api/lor0138/item/dadosCadastrais/informacoesGerais/service/informacoesGerais.service');
const informacoesGerais_controller_1 = require("@api/lor0138/item/dadosCadastrais/informacoesGerais/controller/informacoesGerais.controller");
const informacoesGerais_service_1 = require("@api/lor0138/item/dadosCadastrais/informacoesGerais/service/informacoesGerais.service");
const CustomErrors_1 = require("@shared/errors/CustomErrors");
const item_factory_1 = require("../../factories/item.factory");
describe('Controller - InformacoesGeraisController', () => {
    let mockRequest;
    let mockResponse;
    let mockNext;
    beforeEach(() => {
        // Reset mocks
        jest.clearAllMocks();
        // Mock Request
        mockRequest = {
            params: {},
            query: {},
            body: {},
        };
        // Mock Response
        mockResponse = {
            json: jest.fn().mockReturnThis(),
            status: jest.fn().mockReturnThis(),
            send: jest.fn().mockReturnThis(),
        };
        // Mock Next
        mockNext = jest.fn();
    });
    // ========================================
    // CASOS DE SUCESSO
    // ========================================
    describe('getInformacoesGerais - Sucesso', () => {
        it('deve retornar 200 com dados do item', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: '7530110' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: true,
                data: mockData,
            });
            expect(mockNext).not.toHaveBeenCalled();
        });
        it('deve chamar Service com código correto', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: 'ABC123' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais).toHaveBeenCalledWith('ABC123');
        });
        it('deve retornar estrutura de resposta correta', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: '7530110' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockResponse.json).toHaveBeenCalledWith(expect.objectContaining({
                success: true,
                data: expect.any(Object),
            }));
        });
    });
    // ========================================
    // VALIDAÇÃO DE ENTRADA
    // ========================================
    describe('getInformacoesGerais - Validação', () => {
        it('deve lançar ValidationError se itemCodigo ausente', async () => {
            mockRequest.params = {};
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalledWith(expect.any(CustomErrors_1.ValidationError));
        });
        it('deve lançar ValidationError se itemCodigo vazio', async () => {
            mockRequest.params = { itemCodigo: '' };
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalledWith(expect.any(CustomErrors_1.ValidationError));
        });
        it('deve lançar ValidationError se itemCodigo só espaços', async () => {
            mockRequest.params = { itemCodigo: '   ' };
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalledWith(expect.any(CustomErrors_1.ValidationError));
        });
        it('deve lançar ValidationError se itemCodigo > 16 caracteres', async () => {
            mockRequest.params = { itemCodigo: '12345678901234567' }; // 17 chars
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalledWith(expect.any(CustomErrors_1.ValidationError));
        });
        it('deve incluir mensagem descritiva no ValidationError', async () => {
            mockRequest.params = { itemCodigo: '' };
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            const error = mockNext.mock.calls[0][0];
            expect(error).toBeInstanceOf(CustomErrors_1.ValidationError);
            expect(error.message).toContain('obrigatório');
        });
        it('deve aceitar itemCodigo válido com 16 caracteres', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: '1234567890123456' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockResponse.json).toHaveBeenCalled();
            expect(mockNext).not.toHaveBeenCalled();
        });
    });
    // ========================================
    // ITEM NÃO ENCONTRADO
    // ========================================
    describe('getInformacoesGerais - Item Não Encontrado', () => {
        it('deve lançar ItemNotFoundError quando Service retorna null', async () => {
            mockRequest.params = { itemCodigo: 'INEXISTENTE' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(null);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalledWith(expect.objectContaining({
                message: expect.stringContaining('INEXISTENTE')
            }));
        });
        it('deve incluir código do item no erro', async () => {
            mockRequest.params = { itemCodigo: 'ABC123' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(null);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalled();
            const error = mockNext.mock.calls[0][0];
            expect(error.message).toContain('ABC123');
        });
    });
    // ========================================
    // TRATAMENTO DE ERROS
    // ========================================
    describe('getInformacoesGerais - Erros do Service', () => {
        it('deve propagar erros do Service para middleware via asyncHandler', async () => {
            const serviceError = new Error('Erro no Service');
            mockRequest.params = { itemCodigo: '7530110' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockRejectedValue(serviceError);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalled();
            const error = mockNext.mock.calls[0][0];
            expect(error.message).toBe('Erro no Service');
        });
        it('não deve retornar resposta em caso de erro', async () => {
            const serviceError = new Error('Erro');
            mockRequest.params = { itemCodigo: '7530110' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockRejectedValue(serviceError);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockResponse.json).not.toHaveBeenCalled();
            expect(mockNext).toHaveBeenCalled();
        });
    });
    // ========================================
    // ASYNC HANDLER
    // ========================================
    describe('AsyncHandler Behavior', () => {
        it('deve usar asyncHandler para capturar erros assíncronos', async () => {
            const asyncError = new Error('Async error');
            mockRequest.params = { itemCodigo: '7530110' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockRejectedValue(asyncError);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalled();
            const error = mockNext.mock.calls[0][0];
            expect(error.message).toBe('Async error');
        });
        it('deve permitir que erros síncronos sejam capturados', async () => {
            mockRequest.params = { itemCodigo: '' };
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockNext).toHaveBeenCalledWith(expect.any(CustomErrors_1.ValidationError));
        });
    });
    // ========================================
    // EDGE CASES
    // ========================================
    describe('Edge Cases', () => {
        it('deve aceitar itemCodigo com espaços nas extremidades após trim', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: '  7530110  ' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            // Trim torna '  7530110  ' em '7530110' que é válido
            expect(mockResponse.json).toHaveBeenCalled();
            expect(mockNext).not.toHaveBeenCalled();
        });
        it('deve aceitar códigos alfanuméricos', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: 'ABC123' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockResponse.json).toHaveBeenCalled();
        });
        it('deve aceitar código de 1 caractere', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: 'A' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(mockResponse.json).toHaveBeenCalled();
        });
        it('deve tratar undefined params com TypeError', async () => {
            mockRequest.params = undefined;
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            // Destructuring de undefined gera TypeError, não ValidationError
            expect(mockNext).toHaveBeenCalledWith(expect.any(TypeError));
        });
    });
    // ========================================
    // INTEGRAÇÃO
    // ========================================
    describe('Integração com Service', () => {
        it('deve chamar Service apenas se validação passar', async () => {
            mockRequest.params = { itemCodigo: '' };
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais).not.toHaveBeenCalled();
        });
        it('deve passar itemCodigo exatamente como recebido (sem trim)', async () => {
            const mockData = (0, item_factory_1.createInformacoesGerais)();
            mockRequest.params = { itemCodigo: '7530110' };
            informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais.mockResolvedValue(mockData);
            await informacoesGerais_controller_1.InformacoesGeraisController.getInformacoesGerais(mockRequest, mockResponse, mockNext);
            expect(informacoesGerais_service_1.InformacoesGeraisService.getInformacoesGerais).toHaveBeenCalledWith('7530110');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWFuby9wcm9qZXRvcy9kYXRhc3VsL2xvcjAxMzgvdGVzdHMvaW50ZWdyYXRpb24vY29udHJvbGxlcnMvaW5mb3JtYWNvZXNHZXJhaXMuY29udHJvbGxlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQSw4REFBOEQ7O0FBUTlELGtCQUFrQjtBQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLHVGQUF1RixDQUFDLENBQUM7QUFObkcsOElBQTBJO0FBQzFJLHFJQUFpSTtBQUNqSSw4REFBaUY7QUFDakYsK0RBQXVFO0FBS3ZFLFFBQVEsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7SUFFeEQsSUFBSSxXQUE2QixDQUFDO0lBQ2xDLElBQUksWUFBK0IsQ0FBQztJQUNwQyxJQUFJLFFBQXNCLENBQUM7SUFFM0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGNBQWM7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsZUFBZTtRQUNmLFdBQVcsR0FBRztZQUNaLE1BQU0sRUFBRSxFQUFFO1lBQ1YsS0FBSyxFQUFFLEVBQUU7WUFDVCxJQUFJLEVBQUUsRUFBRTtTQUNULENBQUM7UUFFRixnQkFBZ0I7UUFDaEIsWUFBWSxHQUFHO1lBQ2IsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDaEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7U0FDakMsQ0FBQztRQUVGLFlBQVk7UUFDWixRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsMkNBQTJDO0lBQzNDLG1CQUFtQjtJQUNuQiwyQ0FBMkM7SUFDM0MsUUFBUSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtRQUU5QyxFQUFFLENBQUMscUNBQXFDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbkQs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QztZQUV6RixNQUFNLDBEQUEyQixDQUFDLG9CQUFvQixDQUNwRCxXQUFzQixFQUN0QixZQUF3QixFQUN4QixRQUFRLENBQ1QsQ0FBQztZQUVGLE1BQU0sQ0FBQyxvREFBd0IsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hGLENBQUMsQ0FBQyxDQUFDO0lBRUwsQ0FBQyxDQUFDLENBQUM7QUFFTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9tYW5vL3Byb2pldG9zL2RhdGFzdWwvbG9yMDEzOC90ZXN0cy9pbnRlZ3JhdGlvbi9jb250cm9sbGVycy9pbmZvcm1hY29lc0dlcmFpcy5jb250cm9sbGVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gdGVzdHMvdW5pdC9jb250cm9sbGVycy9pbmZvcm1hY29lc0dlcmFpcy5jb250cm9sbGVyLnRlc3QudHNcblxuaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgSW5mb3JtYWNvZXNHZXJhaXNDb250cm9sbGVyIH0gZnJvbSAnQGFwaS9sb3IwMTM4L2l0ZW0vZGFkb3NDYWRhc3RyYWlzL2luZm9ybWFjb2VzR2VyYWlzL2NvbnRyb2xsZXIvaW5mb3JtYWNvZXNHZXJhaXMuY29udHJvbGxlcic7XG5pbXBvcnQgeyBJbmZvcm1hY29lc0dlcmFpc1NlcnZpY2UgfSBmcm9tICdAYXBpL2xvcjAxMzgvaXRlbS9kYWRvc0NhZGFzdHJhaXMvaW5mb3JtYWNvZXNHZXJhaXMvc2VydmljZS9pbmZvcm1hY29lc0dlcmFpcy5zZXJ2aWNlJztcbmltcG9ydCB7IEl0ZW1Ob3RGb3VuZEVycm9yLCBWYWxpZGF0aW9uRXJyb3IgfSBmcm9tICdAc2hhcmVkL2Vycm9ycy9DdXN0b21FcnJvcnMnO1xuaW1wb3J0IHsgY3JlYXRlSW5mb3JtYWNvZXNHZXJhaXMgfSBmcm9tICcuLi8uLi9mYWN0b3JpZXMvaXRlbS5mYWN0b3J5JztcblxuLy8gTW9jayBkbyBTZXJ2aWNlXG5qZXN0Lm1vY2soJ0BhcGkvbG9yMDEzOC9pdGVtL2RhZG9zQ2FkYXN0cmFpcy9pbmZvcm1hY29lc0dlcmFpcy9zZXJ2aWNlL2luZm9ybWFjb2VzR2VyYWlzLnNlcnZpY2UnKTtcblxuZGVzY3JpYmUoJ0NvbnRyb2xsZXIgLSBJbmZvcm1hY29lc0dlcmFpc0NvbnRyb2xsZXInLCAoKSA9PiB7XG4gIFxuICBsZXQgbW9ja1JlcXVlc3Q6IFBhcnRpYWw8UmVxdWVzdD47XG4gIGxldCBtb2NrUmVzcG9uc2U6IFBhcnRpYWw8UmVzcG9uc2U+O1xuICBsZXQgbW9ja05leHQ6IE5leHRGdW5jdGlvbjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBSZXNldCBtb2Nrc1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuXG4gICAgLy8gTW9jayBSZXF1ZXN0XG4gICAgbW9ja1JlcXVlc3QgPSB7XG4gICAgICBwYXJhbXM6IHt9LFxuICAgICAgcXVlcnk6IHt9LFxuICAgICAgYm9keToge30sXG4gICAgfTtcblxuICAgIC8vIE1vY2sgUmVzcG9uc2VcbiAgICBtb2NrUmVzcG9uc2UgPSB7XG4gICAgICBqc29uOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIHN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBzZW5kOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICB9O1xuXG4gICAgLy8gTW9jayBOZXh0XG4gICAgbW9ja05leHQgPSBqZXN0LmZuKCk7XG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQ0FTT1MgREUgU1VDRVNTT1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdnZXRJbmZvcm1hY29lc0dlcmFpcyAtIFN1Y2Vzc28nLCAoKSA9PiB7XG4gICAgXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgMjAwIGNvbSBkYWRvcyBkbyBpdGVtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0RhdGEgPSBjcmVhdGVJbmZvcm1hY29lc0dlcmFpcygpO1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnNzUzMDExMCcgfTtcblxuICAgICAgKEluZm9ybWFjb2VzR2VyYWlzU2VydmljZS5nZXRJbmZvcm1hY29lc0dlcmFpcyBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEYXRhKTtcblxuICAgICAgYXdhaXQgSW5mb3JtYWNvZXNHZXJhaXNDb250cm9sbGVyLmdldEluZm9ybWFjb2VzR2VyYWlzKFxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LFxuICAgICAgICBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsXG4gICAgICAgIG1vY2tOZXh0XG4gICAgICApO1xuXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogbW9ja0RhdGEsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrTmV4dCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGNoYW1hciBTZXJ2aWNlIGNvbSBjw7NkaWdvIGNvcnJldG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRGF0YSA9IGNyZWF0ZUluZm9ybWFjb2VzR2VyYWlzKCk7XG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGl0ZW1Db2RpZ286ICdBQkMxMjMnIH07XG5cbiAgICAgIChJbmZvcm1hY29lc0dlcmFpc1NlcnZpY2UuZ2V0SW5mb3JtYWNvZXNHZXJhaXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGF0YSk7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KEluZm9ybWFjb2VzR2VyYWlzU2VydmljZS5nZXRJbmZvcm1hY29lc0dlcmFpcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0FCQzEyMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZXN0cnV0dXJhIGRlIHJlc3Bvc3RhIGNvcnJldGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRGF0YSA9IGNyZWF0ZUluZm9ybWFjb2VzR2VyYWlzKCk7XG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGl0ZW1Db2RpZ286ICc3NTMwMTEwJyB9O1xuXG4gICAgICAoSW5mb3JtYWNvZXNHZXJhaXNTZXJ2aWNlLmdldEluZm9ybWFjb2VzR2VyYWlzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RhdGEpO1xuXG4gICAgICBhd2FpdCBJbmZvcm1hY29lc0dlcmFpc0NvbnRyb2xsZXIuZ2V0SW5mb3JtYWNvZXNHZXJhaXMoXG4gICAgICAgIG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsXG4gICAgICAgIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSxcbiAgICAgICAgbW9ja05leHRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGRhdGE6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBWQUxJREHDh8ODTyBERSBFTlRSQURBXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgZGVzY3JpYmUoJ2dldEluZm9ybWFjb2VzR2VyYWlzIC0gVmFsaWRhw6fDo28nLCAoKSA9PiB7XG4gICAgXG4gICAgaXQoJ2RldmUgbGFuw6dhciBWYWxpZGF0aW9uRXJyb3Igc2UgaXRlbUNvZGlnbyBhdXNlbnRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0ge307XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFueShWYWxpZGF0aW9uRXJyb3IpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbGFuw6dhciBWYWxpZGF0aW9uRXJyb3Igc2UgaXRlbUNvZGlnbyB2YXppbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tSZXF1ZXN0LnBhcmFtcyA9IHsgaXRlbUNvZGlnbzogJycgfTtcblxuICAgICAgYXdhaXQgSW5mb3JtYWNvZXNHZXJhaXNDb250cm9sbGVyLmdldEluZm9ybWFjb2VzR2VyYWlzKFxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LFxuICAgICAgICBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsXG4gICAgICAgIG1vY2tOZXh0XG4gICAgICApO1xuXG4gICAgICBleHBlY3QobW9ja05leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3QuYW55KFZhbGlkYXRpb25FcnJvcilcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIFZhbGlkYXRpb25FcnJvciBzZSBpdGVtQ29kaWdvIHPDsyBlc3Bhw6dvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tSZXF1ZXN0LnBhcmFtcyA9IHsgaXRlbUNvZGlnbzogJyAgICcgfTtcblxuICAgICAgYXdhaXQgSW5mb3JtYWNvZXNHZXJhaXNDb250cm9sbGVyLmdldEluZm9ybWFjb2VzR2VyYWlzKFxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LFxuICAgICAgICBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsXG4gICAgICAgIG1vY2tOZXh0XG4gICAgICApO1xuXG4gICAgICBleHBlY3QobW9ja05leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3QuYW55KFZhbGlkYXRpb25FcnJvcilcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIFZhbGlkYXRpb25FcnJvciBzZSBpdGVtQ29kaWdvID4gMTYgY2FyYWN0ZXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tSZXF1ZXN0LnBhcmFtcyA9IHsgaXRlbUNvZGlnbzogJzEyMzQ1Njc4OTAxMjM0NTY3JyB9OyAvLyAxNyBjaGFyc1xuXG4gICAgICBhd2FpdCBJbmZvcm1hY29lc0dlcmFpc0NvbnRyb2xsZXIuZ2V0SW5mb3JtYWNvZXNHZXJhaXMoXG4gICAgICAgIG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsXG4gICAgICAgIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSxcbiAgICAgICAgbW9ja05leHRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtb2NrTmV4dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5hbnkoVmFsaWRhdGlvbkVycm9yKVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGluY2x1aXIgbWVuc2FnZW0gZGVzY3JpdGl2YSBubyBWYWxpZGF0aW9uRXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGl0ZW1Db2RpZ286ICcnIH07XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgY29uc3QgZXJyb3IgPSAobW9ja05leHQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihWYWxpZGF0aW9uRXJyb3IpO1xuICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQ29udGFpbignb2JyaWdhdMOzcmlvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBhY2VpdGFyIGl0ZW1Db2RpZ28gdsOhbGlkbyBjb20gMTYgY2FyYWN0ZXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tEYXRhID0gY3JlYXRlSW5mb3JtYWNvZXNHZXJhaXMoKTtcbiAgICAgIG1vY2tSZXF1ZXN0LnBhcmFtcyA9IHsgaXRlbUNvZGlnbzogJzEyMzQ1Njc4OTAxMjM0NTYnIH07XG5cbiAgICAgIChJbmZvcm1hY29lc0dlcmFpc1NlcnZpY2UuZ2V0SW5mb3JtYWNvZXNHZXJhaXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGF0YSk7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja05leHQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBJVEVNIE7Dg08gRU5DT05UUkFET1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdnZXRJbmZvcm1hY29lc0dlcmFpcyAtIEl0ZW0gTsOjbyBFbmNvbnRyYWRvJywgKCkgPT4ge1xuICAgIFxuICAgIGl0KCdkZXZlIGxhbsOnYXIgSXRlbU5vdEZvdW5kRXJyb3IgcXVhbmRvIFNlcnZpY2UgcmV0b3JuYSBudWxsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnSU5FWElTVEVOVEUnIH07XG5cbiAgICAgIChJbmZvcm1hY29lc0dlcmFpc1NlcnZpY2UuZ2V0SW5mb3JtYWNvZXNHZXJhaXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgSW5mb3JtYWNvZXNHZXJhaXNDb250cm9sbGVyLmdldEluZm9ybWFjb2VzR2VyYWlzKFxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LFxuICAgICAgICBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsXG4gICAgICAgIG1vY2tOZXh0XG4gICAgICApO1xuXG4gICAgICBleHBlY3QobW9ja05leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgbWVzc2FnZTogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ0lORVhJU1RFTlRFJylcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBpbmNsdWlyIGPDs2RpZ28gZG8gaXRlbSBubyBlcnJvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnQUJDMTIzJyB9O1xuXG4gICAgICAoSW5mb3JtYWNvZXNHZXJhaXNTZXJ2aWNlLmdldEluZm9ybWFjb2VzR2VyYWlzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBjb25zdCBlcnJvciA9IChtb2NrTmV4dCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdBQkMxMjMnKTtcbiAgICB9KTtcblxuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFRSQVRBTUVOVE8gREUgRVJST1NcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBkZXNjcmliZSgnZ2V0SW5mb3JtYWNvZXNHZXJhaXMgLSBFcnJvcyBkbyBTZXJ2aWNlJywgKCkgPT4ge1xuICAgIFxuICAgIGl0KCdkZXZlIHByb3BhZ2FyIGVycm9zIGRvIFNlcnZpY2UgcGFyYSBtaWRkbGV3YXJlIHZpYSBhc3luY0hhbmRsZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0Vycm8gbm8gU2VydmljZScpO1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnNzUzMDExMCcgfTtcblxuICAgICAgKEluZm9ybWFjb2VzR2VyYWlzU2VydmljZS5nZXRJbmZvcm1hY29lc0dlcmFpcyBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBjb25zdCBlcnJvciA9IChtb2NrTmV4dCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnRXJybyBubyBTZXJ2aWNlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnbsOjbyBkZXZlIHJldG9ybmFyIHJlc3Bvc3RhIGVtIGNhc28gZGUgZXJybycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRXJybycpO1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnNzUzMDExMCcgfTtcblxuICAgICAgKEluZm9ybWFjb2VzR2VyYWlzU2VydmljZS5nZXRJbmZvcm1hY29lc0dlcmFpcyBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBBU1lOQyBIQU5ETEVSXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgZGVzY3JpYmUoJ0FzeW5jSGFuZGxlciBCZWhhdmlvcicsICgpID0+IHtcbiAgICBcbiAgICBpdCgnZGV2ZSB1c2FyIGFzeW5jSGFuZGxlciBwYXJhIGNhcHR1cmFyIGVycm9zIGFzc8OtbmNyb25vcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jRXJyb3IgPSBuZXcgRXJyb3IoJ0FzeW5jIGVycm9yJyk7XG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGl0ZW1Db2RpZ286ICc3NTMwMTEwJyB9O1xuXG4gICAgICAoSW5mb3JtYWNvZXNHZXJhaXNTZXJ2aWNlLmdldEluZm9ybWFjb2VzR2VyYWlzIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoYXN5bmNFcnJvcik7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBjb25zdCBlcnJvciA9IChtb2NrTmV4dCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnQXN5bmMgZXJyb3InKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHBlcm1pdGlyIHF1ZSBlcnJvcyBzw61uY3Jvbm9zIHNlamFtIGNhcHR1cmFkb3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGl0ZW1Db2RpZ286ICcnIH07XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFZhbGlkYXRpb25FcnJvcikpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gRURHRSBDQVNFU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIFxuICAgIGl0KCdkZXZlIGFjZWl0YXIgaXRlbUNvZGlnbyBjb20gZXNwYcOnb3MgbmFzIGV4dHJlbWlkYWRlcyBhcMOzcyB0cmltJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0RhdGEgPSBjcmVhdGVJbmZvcm1hY29lc0dlcmFpcygpO1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnICA3NTMwMTEwICAnIH07XG5cbiAgICAgIChJbmZvcm1hY29lc0dlcmFpc1NlcnZpY2UuZ2V0SW5mb3JtYWNvZXNHZXJhaXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGF0YSk7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgLy8gVHJpbSB0b3JuYSAnICA3NTMwMTEwICAnIGVtICc3NTMwMTEwJyBxdWUgw6kgdsOhbGlkb1xuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja05leHQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBhY2VpdGFyIGPDs2RpZ29zIGFsZmFudW3DqXJpY29zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0RhdGEgPSBjcmVhdGVJbmZvcm1hY29lc0dlcmFpcygpO1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnQUJDMTIzJyB9O1xuXG4gICAgICAoSW5mb3JtYWNvZXNHZXJhaXNTZXJ2aWNlLmdldEluZm9ybWFjb2VzR2VyYWlzIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RhdGEpO1xuXG4gICAgICBhd2FpdCBJbmZvcm1hY29lc0dlcmFpc0NvbnRyb2xsZXIuZ2V0SW5mb3JtYWNvZXNHZXJhaXMoXG4gICAgICAgIG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsXG4gICAgICAgIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSxcbiAgICAgICAgbW9ja05leHRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYWNlaXRhciBjw7NkaWdvIGRlIDEgY2FyYWN0ZXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0RhdGEgPSBjcmVhdGVJbmZvcm1hY29lc0dlcmFpcygpO1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnQScgfTtcblxuICAgICAgKEluZm9ybWFjb2VzR2VyYWlzU2VydmljZS5nZXRJbmZvcm1hY29lc0dlcmFpcyBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEYXRhKTtcblxuICAgICAgYXdhaXQgSW5mb3JtYWNvZXNHZXJhaXNDb250cm9sbGVyLmdldEluZm9ybWFjb2VzR2VyYWlzKFxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LFxuICAgICAgICBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UsXG4gICAgICAgIG1vY2tOZXh0XG4gICAgICApO1xuXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHRyYXRhciB1bmRlZmluZWQgcGFyYW1zIGNvbSBUeXBlRXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB1bmRlZmluZWQgYXMgYW55O1xuXG4gICAgICBhd2FpdCBJbmZvcm1hY29lc0dlcmFpc0NvbnRyb2xsZXIuZ2V0SW5mb3JtYWNvZXNHZXJhaXMoXG4gICAgICAgIG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsXG4gICAgICAgIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSxcbiAgICAgICAgbW9ja05leHRcbiAgICAgICk7XG5cbiAgICAgIC8vIERlc3RydWN0dXJpbmcgZGUgdW5kZWZpbmVkIGdlcmEgVHlwZUVycm9yLCBuw6NvIFZhbGlkYXRpb25FcnJvclxuICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFR5cGVFcnJvcikpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gSU5URUdSQcOHw4NPXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgZGVzY3JpYmUoJ0ludGVncmHDp8OjbyBjb20gU2VydmljZScsICgpID0+IHtcbiAgICBcbiAgICBpdCgnZGV2ZSBjaGFtYXIgU2VydmljZSBhcGVuYXMgc2UgdmFsaWRhw6fDo28gcGFzc2FyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpdGVtQ29kaWdvOiAnJyB9O1xuXG4gICAgICBhd2FpdCBJbmZvcm1hY29lc0dlcmFpc0NvbnRyb2xsZXIuZ2V0SW5mb3JtYWNvZXNHZXJhaXMoXG4gICAgICAgIG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsXG4gICAgICAgIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSxcbiAgICAgICAgbW9ja05leHRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChJbmZvcm1hY29lc0dlcmFpc1NlcnZpY2UuZ2V0SW5mb3JtYWNvZXNHZXJhaXMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBwYXNzYXIgaXRlbUNvZGlnbyBleGF0YW1lbnRlIGNvbW8gcmVjZWJpZG8gKHNlbSB0cmltKScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tEYXRhID0gY3JlYXRlSW5mb3JtYWNvZXNHZXJhaXMoKTtcbiAgICAgIG1vY2tSZXF1ZXN0LnBhcmFtcyA9IHsgaXRlbUNvZGlnbzogJzc1MzAxMTAnIH07XG5cbiAgICAgIChJbmZvcm1hY29lc0dlcmFpc1NlcnZpY2UuZ2V0SW5mb3JtYWNvZXNHZXJhaXMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGF0YSk7XG5cbiAgICAgIGF3YWl0IEluZm9ybWFjb2VzR2VyYWlzQ29udHJvbGxlci5nZXRJbmZvcm1hY29lc0dlcmFpcyhcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgUmVxdWVzdCxcbiAgICAgICAgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlLFxuICAgICAgICBtb2NrTmV4dFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KEluZm9ybWFjb2VzR2VyYWlzU2VydmljZS5nZXRJbmZvcm1hY29lc0dlcmFpcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJzc1MzAxMTAnKTtcbiAgICB9KTtcblxuICB9KTtcblxufSk7Il0sInZlcnNpb24iOjN9